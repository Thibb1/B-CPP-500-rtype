\hypertarget{par__shapes_8h_source}{}\doxysection{par\+\_\+shapes.\+h}
\label{par__shapes_8h_source}\index{build/\_deps/raylib-\/src/src/external/par\_shapes.h@{build/\_deps/raylib-\/src/src/external/par\_shapes.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// SHAPES :: https://github.com/prideout/par}}
\DoxyCodeLine{2 \textcolor{comment}{// Simple C library for creation and manipulation of triangle meshes.}}
\DoxyCodeLine{3 \textcolor{comment}{//}}
\DoxyCodeLine{4 \textcolor{comment}{// The API is divided into three sections:}}
\DoxyCodeLine{5 \textcolor{comment}{//}}
\DoxyCodeLine{6 \textcolor{comment}{//   -\/ Generators.  Create parametric surfaces, platonic solids, etc.}}
\DoxyCodeLine{7 \textcolor{comment}{//   -\/ Queries.     Ask a mesh for its axis-\/aligned bounding box, etc.}}
\DoxyCodeLine{8 \textcolor{comment}{//   -\/ Transforms.  Rotate a mesh, merge it with another, add normals, etc.}}
\DoxyCodeLine{9 \textcolor{comment}{//}}
\DoxyCodeLine{10 \textcolor{comment}{// In addition to the comment block above each function declaration, the API}}
\DoxyCodeLine{11 \textcolor{comment}{// has informal documentation here:}}
\DoxyCodeLine{12 \textcolor{comment}{//}}
\DoxyCodeLine{13 \textcolor{comment}{//     https://prideout.net/shapes}}
\DoxyCodeLine{14 \textcolor{comment}{//}}
\DoxyCodeLine{15 \textcolor{comment}{// For our purposes, a "{}mesh"{} is a list of points and a list of triangles; the}}
\DoxyCodeLine{16 \textcolor{comment}{// former is a flattened list of three-\/tuples (32-\/bit floats) and the latter is}}
\DoxyCodeLine{17 \textcolor{comment}{// also a flattened list of three-\/tuples (16-\/bit uints).  Triangles are always}}
\DoxyCodeLine{18 \textcolor{comment}{// oriented such that their front face winds counter-\/clockwise.}}
\DoxyCodeLine{19 \textcolor{comment}{//}}
\DoxyCodeLine{20 \textcolor{comment}{// Optionally, meshes can contain 3D normals (one per vertex), and 2D texture}}
\DoxyCodeLine{21 \textcolor{comment}{// coordinates (one per vertex).  That's it!  If you need something fancier,}}
\DoxyCodeLine{22 \textcolor{comment}{// look elsewhere.}}
\DoxyCodeLine{23 \textcolor{comment}{//}}
\DoxyCodeLine{24 \textcolor{comment}{// Distributed under the MIT License, see bottom of file.}}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#ifndef PAR\_SHAPES\_H}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#define PAR\_SHAPES\_H}}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{30 \textcolor{keyword}{extern} \textcolor{stringliteral}{"{}C"{}} \{}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{32 }
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include <stdint.h>}}
\DoxyCodeLine{34 \textcolor{comment}{// Ray (@raysan5): Commented to avoid conflict with raylib bool}}
\DoxyCodeLine{35 \textcolor{comment}{/*}}
\DoxyCodeLine{36 \textcolor{comment}{\#if !defined(\_MSC\_VER)}}
\DoxyCodeLine{37 \textcolor{comment}{\# include <stdbool.h>}}
\DoxyCodeLine{38 \textcolor{comment}{\#else // MSVC}}
\DoxyCodeLine{39 \textcolor{comment}{\# if \_MSC\_VER >= 1800}}
\DoxyCodeLine{40 \textcolor{comment}{\#  include <stdbool.h>}}
\DoxyCodeLine{41 \textcolor{comment}{\# else // stdbool.h missing prior to MSVC++ 12.0 (VS2013)}}
\DoxyCodeLine{42 \textcolor{comment}{\#  define bool int}}
\DoxyCodeLine{43 \textcolor{comment}{\#  define true 1}}
\DoxyCodeLine{44 \textcolor{comment}{\#  define false 0}}
\DoxyCodeLine{45 \textcolor{comment}{\# endif}}
\DoxyCodeLine{46 \textcolor{comment}{\#endif}}
\DoxyCodeLine{47 \textcolor{comment}{*/}}
\DoxyCodeLine{48 }
\DoxyCodeLine{49 \textcolor{preprocessor}{\#ifndef PAR\_SHAPES\_T}}
\DoxyCodeLine{50 \textcolor{preprocessor}{\#define PAR\_SHAPES\_T uint16\_t}}
\DoxyCodeLine{51 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{52 }
\DoxyCodeLine{53 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh\_s}} \{}
\DoxyCodeLine{54     \textcolor{keywordtype}{float}* points;           \textcolor{comment}{// Flat list of 3-\/tuples (X Y Z X Y Z...)}}
\DoxyCodeLine{55     \textcolor{keywordtype}{int} npoints;             \textcolor{comment}{// Number of points}}
\DoxyCodeLine{56     PAR\_SHAPES\_T* triangles; \textcolor{comment}{// Flat list of 3-\/tuples (I J K I J K...)}}
\DoxyCodeLine{57     \textcolor{keywordtype}{int} ntriangles;          \textcolor{comment}{// Number of triangles}}
\DoxyCodeLine{58     \textcolor{keywordtype}{float}* normals;          \textcolor{comment}{// Optional list of 3-\/tuples (X Y Z X Y Z...)}}
\DoxyCodeLine{59     \textcolor{keywordtype}{float}* tcoords;          \textcolor{comment}{// Optional list of 2-\/tuples (U V U V U V...)}}
\DoxyCodeLine{60 \} \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}};}
\DoxyCodeLine{61 }
\DoxyCodeLine{62 \textcolor{keywordtype}{void} par\_shapes\_free\_mesh(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}*);}
\DoxyCodeLine{63 }
\DoxyCodeLine{64 \textcolor{comment}{// Generators -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{65 }
\DoxyCodeLine{66 \textcolor{comment}{// Instance a cylinder that sits on the Z=0 plane using the given tessellation}}
\DoxyCodeLine{67 \textcolor{comment}{// levels across the UV domain.  Think of "{}slices"{} like a number of pizza}}
\DoxyCodeLine{68 \textcolor{comment}{// slices, and "{}stacks"{} like a number of stacked rings.  Height and radius are}}
\DoxyCodeLine{69 \textcolor{comment}{// both 1.0, but they can easily be changed with par\_shapes\_scale.}}
\DoxyCodeLine{70 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_cylinder(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks);}
\DoxyCodeLine{71 }
\DoxyCodeLine{72 \textcolor{comment}{// Cone is similar to cylinder but the radius diminishes to zero as Z increases.}}
\DoxyCodeLine{73 \textcolor{comment}{// Again, height and radius are 1.0, but can be changed with par\_shapes\_scale.}}
\DoxyCodeLine{74 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_cone(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks);}
\DoxyCodeLine{75 }
\DoxyCodeLine{76 \textcolor{comment}{// Create a disk of radius 1.0 with texture coordinates and normals by squashing}}
\DoxyCodeLine{77 \textcolor{comment}{// a cone flat on the Z=0 plane.}}
\DoxyCodeLine{78 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_parametric\_disk(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks);}
\DoxyCodeLine{79 }
\DoxyCodeLine{80 \textcolor{comment}{// Create a donut that sits on the Z=0 plane with the specified inner radius.}}
\DoxyCodeLine{81 \textcolor{comment}{// The outer radius can be controlled with par\_shapes\_scale.}}
\DoxyCodeLine{82 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_torus(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks, \textcolor{keywordtype}{float} radius);}
\DoxyCodeLine{83 }
\DoxyCodeLine{84 \textcolor{comment}{// Create a sphere with texture coordinates and small triangles near the poles.}}
\DoxyCodeLine{85 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_parametric\_sphere(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks);}
\DoxyCodeLine{86 }
\DoxyCodeLine{87 \textcolor{comment}{// Approximate a sphere with a subdivided icosahedron, which produces a nice}}
\DoxyCodeLine{88 \textcolor{comment}{// distribution of triangles, but no texture coordinates.  Each subdivision}}
\DoxyCodeLine{89 \textcolor{comment}{// level scales the number of triangles by four, so use a very low number.}}
\DoxyCodeLine{90 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_subdivided\_sphere(\textcolor{keywordtype}{int} nsubdivisions);}
\DoxyCodeLine{91 }
\DoxyCodeLine{92 \textcolor{comment}{// More parametric surfaces.}}
\DoxyCodeLine{93 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_klein\_bottle(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks);}
\DoxyCodeLine{94 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_trefoil\_knot(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks,}
\DoxyCodeLine{95     \textcolor{keywordtype}{float} radius);}
\DoxyCodeLine{96 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_hemisphere(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks);}
\DoxyCodeLine{97 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_plane(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks);}
\DoxyCodeLine{98 }
\DoxyCodeLine{99 \textcolor{comment}{// Create a parametric surface from a callback function that consumes a 2D}}
\DoxyCodeLine{100 \textcolor{comment}{// point in [0,1] and produces a 3D point.}}
\DoxyCodeLine{101 \textcolor{keyword}{typedef} void (*par\_shapes\_fn)(\textcolor{keywordtype}{float} \textcolor{keyword}{const}*, \textcolor{keywordtype}{float}*, \textcolor{keywordtype}{void}*);}
\DoxyCodeLine{102 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_parametric(par\_shapes\_fn, \textcolor{keywordtype}{int} slices,}
\DoxyCodeLine{103     \textcolor{keywordtype}{int} stacks, \textcolor{keywordtype}{void}* userdata);}
\DoxyCodeLine{104 }
\DoxyCodeLine{105 \textcolor{comment}{// Generate points for a 20-\/sided polyhedron that fits in the unit sphere.}}
\DoxyCodeLine{106 \textcolor{comment}{// Texture coordinates and normals are not generated.}}
\DoxyCodeLine{107 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_icosahedron();}
\DoxyCodeLine{108 }
\DoxyCodeLine{109 \textcolor{comment}{// Generate points for a 12-\/sided polyhedron that fits in the unit sphere.}}
\DoxyCodeLine{110 \textcolor{comment}{// Again, texture coordinates and normals are not generated.}}
\DoxyCodeLine{111 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_dodecahedron();}
\DoxyCodeLine{112 }
\DoxyCodeLine{113 \textcolor{comment}{// More platonic solids.}}
\DoxyCodeLine{114 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_octahedron();}
\DoxyCodeLine{115 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_tetrahedron();}
\DoxyCodeLine{116 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_cube();}
\DoxyCodeLine{117 }
\DoxyCodeLine{118 \textcolor{comment}{// Generate an orientable disk shape in 3-\/space.  Does not include normals or}}
\DoxyCodeLine{119 \textcolor{comment}{// texture coordinates.}}
\DoxyCodeLine{120 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_disk(\textcolor{keywordtype}{float} radius, \textcolor{keywordtype}{int} slices,}
\DoxyCodeLine{121     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* center, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* normal);}
\DoxyCodeLine{122 }
\DoxyCodeLine{123 \textcolor{comment}{// Create an empty shape.  Useful for building scenes with merge\_and\_free.}}
\DoxyCodeLine{124 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_empty();}
\DoxyCodeLine{125 }
\DoxyCodeLine{126 \textcolor{comment}{// Generate a rock shape that sits on the Y=0 plane, and sinks into it a bit.}}
\DoxyCodeLine{127 \textcolor{comment}{// This includes smooth normals but no texture coordinates.  Each subdivision}}
\DoxyCodeLine{128 \textcolor{comment}{// level scales the number of triangles by four, so use a very low number.}}
\DoxyCodeLine{129 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_rock(\textcolor{keywordtype}{int} seed, \textcolor{keywordtype}{int} nsubdivisions);}
\DoxyCodeLine{130 }
\DoxyCodeLine{131 \textcolor{comment}{// Create trees or vegetation by executing a recursive turtle graphics program.}}
\DoxyCodeLine{132 \textcolor{comment}{// The program is a list of command-\/argument pairs.  See the unit test for}}
\DoxyCodeLine{133 \textcolor{comment}{// an example.  Texture coordinates and normals are not generated.}}
\DoxyCodeLine{134 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_lsystem(\textcolor{keywordtype}{char} \textcolor{keyword}{const}* program, \textcolor{keywordtype}{int} slices,}
\DoxyCodeLine{135     \textcolor{keywordtype}{int} maxdepth);}
\DoxyCodeLine{136 }
\DoxyCodeLine{137 \textcolor{comment}{// Queries -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{138 }
\DoxyCodeLine{139 \textcolor{comment}{// Dump out a text file conforming to the venerable OBJ format.}}
\DoxyCodeLine{140 \textcolor{keywordtype}{void} par\_shapes\_export(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}} \textcolor{keyword}{const}*, \textcolor{keywordtype}{char} \textcolor{keyword}{const}* objfile);}
\DoxyCodeLine{141 }
\DoxyCodeLine{142 \textcolor{comment}{// Take a pointer to 6 floats and set them to min xyz, max xyz.}}
\DoxyCodeLine{143 \textcolor{keywordtype}{void} par\_shapes\_compute\_aabb(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}} \textcolor{keyword}{const}* mesh, \textcolor{keywordtype}{float}* aabb);}
\DoxyCodeLine{144 }
\DoxyCodeLine{145 \textcolor{comment}{// Make a deep copy of a mesh.  To make a brand new copy, pass null to "{}target"{}.}}
\DoxyCodeLine{146 \textcolor{comment}{// To avoid memory churn, pass an existing mesh to "{}target"{}.}}
\DoxyCodeLine{147 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_clone(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}} \textcolor{keyword}{const}* mesh,}
\DoxyCodeLine{148     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* target);}
\DoxyCodeLine{149 }
\DoxyCodeLine{150 \textcolor{comment}{// Transformations -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{151 }
\DoxyCodeLine{152 \textcolor{keywordtype}{void} par\_shapes\_merge(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* dst, \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}} \textcolor{keyword}{const}* src);}
\DoxyCodeLine{153 \textcolor{keywordtype}{void} par\_shapes\_translate(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}*, \textcolor{keywordtype}{float} x, \textcolor{keywordtype}{float} y, \textcolor{keywordtype}{float} z);}
\DoxyCodeLine{154 \textcolor{keywordtype}{void} par\_shapes\_rotate(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}*, \textcolor{keywordtype}{float} radians, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* axis);}
\DoxyCodeLine{155 \textcolor{keywordtype}{void} par\_shapes\_scale(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}*, \textcolor{keywordtype}{float} x, \textcolor{keywordtype}{float} y, \textcolor{keywordtype}{float} z);}
\DoxyCodeLine{156 \textcolor{keywordtype}{void} par\_shapes\_merge\_and\_free(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* dst, \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* src);}
\DoxyCodeLine{157 }
\DoxyCodeLine{158 \textcolor{comment}{// Reverse the winding of a run of faces.  Useful when drawing the inside of}}
\DoxyCodeLine{159 \textcolor{comment}{// a Cornell Box.  Pass 0 for nfaces to reverse every face in the mesh.}}
\DoxyCodeLine{160 \textcolor{keywordtype}{void} par\_shapes\_invert(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}*, \textcolor{keywordtype}{int} startface, \textcolor{keywordtype}{int} nfaces);}
\DoxyCodeLine{161 }
\DoxyCodeLine{162 \textcolor{comment}{// Remove all triangles whose area is less than minarea.}}
\DoxyCodeLine{163 \textcolor{keywordtype}{void} par\_shapes\_remove\_degenerate(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}*, \textcolor{keywordtype}{float} minarea);}
\DoxyCodeLine{164 }
\DoxyCodeLine{165 \textcolor{comment}{// Dereference the entire index buffer and replace the point list.}}
\DoxyCodeLine{166 \textcolor{comment}{// This creates an inefficient structure, but is useful for drawing facets.}}
\DoxyCodeLine{167 \textcolor{comment}{// If create\_indices is true, a trivial "{}0 1 2 3..."{} index buffer is generated.}}
\DoxyCodeLine{168 \textcolor{keywordtype}{void} par\_shapes\_unweld(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh, \textcolor{keywordtype}{bool} create\_indices);}
\DoxyCodeLine{169 }
\DoxyCodeLine{170 \textcolor{comment}{// Merge colocated verts, build a new index buffer, and return the}}
\DoxyCodeLine{171 \textcolor{comment}{// optimized mesh.  Epsilon is the maximum distance to consider when}}
\DoxyCodeLine{172 \textcolor{comment}{// welding vertices. The mapping argument can be null, or a pointer to}}
\DoxyCodeLine{173 \textcolor{comment}{// npoints integers, which gets filled with the mapping from old vertex}}
\DoxyCodeLine{174 \textcolor{comment}{// indices to new indices.}}
\DoxyCodeLine{175 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_weld(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}} \textcolor{keyword}{const}*, \textcolor{keywordtype}{float} epsilon,}
\DoxyCodeLine{176     PAR\_SHAPES\_T* mapping);}
\DoxyCodeLine{177 }
\DoxyCodeLine{178 \textcolor{comment}{// Compute smooth normals by averaging adjacent facet normals.}}
\DoxyCodeLine{179 \textcolor{keywordtype}{void} par\_shapes\_compute\_normals(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* m);}
\DoxyCodeLine{180 }
\DoxyCodeLine{181 \textcolor{comment}{// Global Config -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{182 }
\DoxyCodeLine{183 \textcolor{keywordtype}{void} par\_shapes\_set\_epsilon\_welded\_normals(\textcolor{keywordtype}{float} epsilon);}
\DoxyCodeLine{184 \textcolor{keywordtype}{void} par\_shapes\_set\_epsilon\_degenerate\_sphere(\textcolor{keywordtype}{float} epsilon);}
\DoxyCodeLine{185 }
\DoxyCodeLine{186 \textcolor{comment}{// Advanced -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{187 }
\DoxyCodeLine{188 \textcolor{keywordtype}{void} par\_shapes\_\_compute\_welded\_normals(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* m);}
\DoxyCodeLine{189 \textcolor{keywordtype}{void} par\_shapes\_\_connect(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* scene, \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* cylinder,}
\DoxyCodeLine{190     \textcolor{keywordtype}{int} slices);}
\DoxyCodeLine{191 }
\DoxyCodeLine{192 \textcolor{preprocessor}{\#ifndef PAR\_PI}}
\DoxyCodeLine{193 \textcolor{preprocessor}{\#define PAR\_PI (3.14159265359)}}
\DoxyCodeLine{194 \textcolor{preprocessor}{\#define PAR\_MIN(a, b) (a > b ? b : a)}}
\DoxyCodeLine{195 \textcolor{preprocessor}{\#define PAR\_MAX(a, b) (a > b ? a : b)}}
\DoxyCodeLine{196 \textcolor{preprocessor}{\#define PAR\_CLAMP(v, lo, hi) PAR\_MAX(lo, PAR\_MIN(hi, v))}}
\DoxyCodeLine{197 \textcolor{preprocessor}{\#define PAR\_SWAP(T, A, B) \{ T tmp = B; B = A; A = tmp; \}}}
\DoxyCodeLine{198 \textcolor{preprocessor}{\#define PAR\_SQR(a) ((a) * (a))}}
\DoxyCodeLine{199 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{200 }
\DoxyCodeLine{201 \textcolor{preprocessor}{\#ifndef PAR\_MALLOC}}
\DoxyCodeLine{202 \textcolor{preprocessor}{\#define PAR\_MALLOC(T, N) ((T*) malloc(N * sizeof(T)))}}
\DoxyCodeLine{203 \textcolor{preprocessor}{\#define PAR\_CALLOC(T, N) ((T*) calloc(N * sizeof(T), 1))}}
\DoxyCodeLine{204 \textcolor{preprocessor}{\#define PAR\_REALLOC(T, BUF, N) ((T*) realloc(BUF, sizeof(T) * (N)))}}
\DoxyCodeLine{205 \textcolor{preprocessor}{\#define PAR\_FREE(BUF) free(BUF)}}
\DoxyCodeLine{206 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{207 }
\DoxyCodeLine{208 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{209 \}}
\DoxyCodeLine{210 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{211 }
\DoxyCodeLine{212 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{213 \textcolor{comment}{// END PUBLIC API}}
\DoxyCodeLine{214 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{215 }
\DoxyCodeLine{216 \textcolor{preprocessor}{\#ifdef PAR\_SHAPES\_IMPLEMENTATION}}
\DoxyCodeLine{217 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{218 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{219 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{220 \textcolor{preprocessor}{\#include <float.h>}}
\DoxyCodeLine{221 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{222 \textcolor{preprocessor}{\#include <math.h>}}
\DoxyCodeLine{223 \textcolor{preprocessor}{\#include <errno.h>}}
\DoxyCodeLine{224 }
\DoxyCodeLine{225 \textcolor{keyword}{static} \textcolor{keywordtype}{float} par\_shapes\_\_epsilon\_welded\_normals = 0.001;}
\DoxyCodeLine{226 \textcolor{keyword}{static} \textcolor{keywordtype}{float} par\_shapes\_\_epsilon\_degenerate\_sphere = 0.0001;}
\DoxyCodeLine{227 }
\DoxyCodeLine{228 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_sphere(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}*);}
\DoxyCodeLine{229 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_hemisphere(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}*);}
\DoxyCodeLine{230 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_plane(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}*);}
\DoxyCodeLine{231 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_klein(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}*);}
\DoxyCodeLine{232 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_cylinder(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}*);}
\DoxyCodeLine{233 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_cone(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}*);}
\DoxyCodeLine{234 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_torus(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}*);}
\DoxyCodeLine{235 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_trefoil(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}*);}
\DoxyCodeLine{236 }
\DoxyCodeLine{237 \textcolor{keyword}{struct }osn\_context;}
\DoxyCodeLine{238 \textcolor{keyword}{static} \textcolor{keywordtype}{int} par\_\_simplex\_noise(int64\_t seed, \textcolor{keyword}{struct} osn\_context** ctx);}
\DoxyCodeLine{239 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_\_simplex\_noise\_free(\textcolor{keyword}{struct} osn\_context* ctx);}
\DoxyCodeLine{240 \textcolor{keyword}{static} \textcolor{keywordtype}{double} par\_\_simplex\_noise2(\textcolor{keyword}{struct} osn\_context* ctx, \textcolor{keywordtype}{double} x, \textcolor{keywordtype}{double} y);}
\DoxyCodeLine{241 }
\DoxyCodeLine{242 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_copy3(\textcolor{keywordtype}{float}* result, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* a)}
\DoxyCodeLine{243 \{}
\DoxyCodeLine{244     result[0] = a[0];}
\DoxyCodeLine{245     result[1] = a[1];}
\DoxyCodeLine{246     result[2] = a[2];}
\DoxyCodeLine{247 \}}
\DoxyCodeLine{248 }
\DoxyCodeLine{249 \textcolor{keyword}{static} \textcolor{keywordtype}{float} par\_shapes\_\_dot3(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* a, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* b)}
\DoxyCodeLine{250 \{}
\DoxyCodeLine{251     \textcolor{keywordflow}{return} b[0] * a[0] + b[1] * a[1] + b[2] * a[2];}
\DoxyCodeLine{252 \}}
\DoxyCodeLine{253 }
\DoxyCodeLine{254 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_transform3(\textcolor{keywordtype}{float}* p, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* x, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* y,}
\DoxyCodeLine{255     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* z)}
\DoxyCodeLine{256 \{}
\DoxyCodeLine{257     \textcolor{keywordtype}{float} px = par\_shapes\_\_dot3(p, x);}
\DoxyCodeLine{258     \textcolor{keywordtype}{float} py = par\_shapes\_\_dot3(p, y);}
\DoxyCodeLine{259     \textcolor{keywordtype}{float} pz = par\_shapes\_\_dot3(p, z);}
\DoxyCodeLine{260     p[0] = px;}
\DoxyCodeLine{261     p[1] = py;}
\DoxyCodeLine{262     p[2] = pz;}
\DoxyCodeLine{263 \}}
\DoxyCodeLine{264 }
\DoxyCodeLine{265 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_cross3(\textcolor{keywordtype}{float}* result, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* a, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* b)}
\DoxyCodeLine{266 \{}
\DoxyCodeLine{267     \textcolor{keywordtype}{float} x = (a[1] * b[2]) -\/ (a[2] * b[1]);}
\DoxyCodeLine{268     \textcolor{keywordtype}{float} y = (a[2] * b[0]) -\/ (a[0] * b[2]);}
\DoxyCodeLine{269     \textcolor{keywordtype}{float} z = (a[0] * b[1]) -\/ (a[1] * b[0]);}
\DoxyCodeLine{270     result[0] = x;}
\DoxyCodeLine{271     result[1] = y;}
\DoxyCodeLine{272     result[2] = z;}
\DoxyCodeLine{273 \}}
\DoxyCodeLine{274 }
\DoxyCodeLine{275 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_mix3(\textcolor{keywordtype}{float}* d, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* a, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* b, \textcolor{keywordtype}{float} t)}
\DoxyCodeLine{276 \{}
\DoxyCodeLine{277     \textcolor{keywordtype}{float} x = b[0] * t + a[0] * (1 -\/ t);}
\DoxyCodeLine{278     \textcolor{keywordtype}{float} y = b[1] * t + a[1] * (1 -\/ t);}
\DoxyCodeLine{279     \textcolor{keywordtype}{float} z = b[2] * t + a[2] * (1 -\/ t);}
\DoxyCodeLine{280     d[0] = x;}
\DoxyCodeLine{281     d[1] = y;}
\DoxyCodeLine{282     d[2] = z;}
\DoxyCodeLine{283 \}}
\DoxyCodeLine{284 }
\DoxyCodeLine{285 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_scale3(\textcolor{keywordtype}{float}* result, \textcolor{keywordtype}{float} a)}
\DoxyCodeLine{286 \{}
\DoxyCodeLine{287     result[0] *= a;}
\DoxyCodeLine{288     result[1] *= a;}
\DoxyCodeLine{289     result[2] *= a;}
\DoxyCodeLine{290 \}}
\DoxyCodeLine{291 }
\DoxyCodeLine{292 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_normalize3(\textcolor{keywordtype}{float}* v)}
\DoxyCodeLine{293 \{}
\DoxyCodeLine{294     \textcolor{keywordtype}{float} lsqr = sqrt(v[0]*v[0] + v[1]*v[1] + v[2]*v[2]);}
\DoxyCodeLine{295     \textcolor{keywordflow}{if} (lsqr > 0) \{}
\DoxyCodeLine{296         par\_shapes\_\_scale3(v, 1.0f / lsqr);}
\DoxyCodeLine{297     \}}
\DoxyCodeLine{298 \}}
\DoxyCodeLine{299 }
\DoxyCodeLine{300 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_subtract3(\textcolor{keywordtype}{float}* result, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* a)}
\DoxyCodeLine{301 \{}
\DoxyCodeLine{302     result[0] -\/= a[0];}
\DoxyCodeLine{303     result[1] -\/= a[1];}
\DoxyCodeLine{304     result[2] -\/= a[2];}
\DoxyCodeLine{305 \}}
\DoxyCodeLine{306 }
\DoxyCodeLine{307 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_add3(\textcolor{keywordtype}{float}* result, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* a)}
\DoxyCodeLine{308 \{}
\DoxyCodeLine{309     result[0] += a[0];}
\DoxyCodeLine{310     result[1] += a[1];}
\DoxyCodeLine{311     result[2] += a[2];}
\DoxyCodeLine{312 \}}
\DoxyCodeLine{313 }
\DoxyCodeLine{314 \textcolor{keyword}{static} \textcolor{keywordtype}{float} par\_shapes\_\_sqrdist3(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* a, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* b)}
\DoxyCodeLine{315 \{}
\DoxyCodeLine{316     \textcolor{keywordtype}{float} dx = a[0] -\/ b[0];}
\DoxyCodeLine{317     \textcolor{keywordtype}{float} dy = a[1] -\/ b[1];}
\DoxyCodeLine{318     \textcolor{keywordtype}{float} dz = a[2] -\/ b[2];}
\DoxyCodeLine{319     \textcolor{keywordflow}{return} dx * dx + dy * dy + dz * dz;}
\DoxyCodeLine{320 \}}
\DoxyCodeLine{321 }
\DoxyCodeLine{322 \textcolor{keywordtype}{void} par\_shapes\_\_compute\_welded\_normals(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* m)}
\DoxyCodeLine{323 \{}
\DoxyCodeLine{324     \textcolor{keyword}{const} \textcolor{keywordtype}{float} epsilon = par\_shapes\_\_epsilon\_welded\_normals;}
\DoxyCodeLine{325     m-\/>normals = PAR\_MALLOC(\textcolor{keywordtype}{float}, m-\/>npoints * 3);}
\DoxyCodeLine{326     PAR\_SHAPES\_T* weldmap = PAR\_MALLOC(PAR\_SHAPES\_T, m-\/>npoints);}
\DoxyCodeLine{327     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* welded = par\_shapes\_weld(m, epsilon, weldmap);}
\DoxyCodeLine{328     par\_shapes\_compute\_normals(welded);}
\DoxyCodeLine{329     \textcolor{keywordtype}{float}* pdst = m-\/>normals;}
\DoxyCodeLine{330     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < m-\/>npoints; i++, pdst += 3) \{}
\DoxyCodeLine{331         \textcolor{keywordtype}{int} d = weldmap[i];}
\DoxyCodeLine{332         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* pnormal = welded-\/>normals + d * 3;}
\DoxyCodeLine{333         pdst[0] = pnormal[0];}
\DoxyCodeLine{334         pdst[1] = pnormal[1];}
\DoxyCodeLine{335         pdst[2] = pnormal[2];}
\DoxyCodeLine{336     \}}
\DoxyCodeLine{337     PAR\_FREE(weldmap);}
\DoxyCodeLine{338     par\_shapes\_free\_mesh(welded);}
\DoxyCodeLine{339 \}}
\DoxyCodeLine{340 }
\DoxyCodeLine{341 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_cylinder(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks)}
\DoxyCodeLine{342 \{}
\DoxyCodeLine{343     \textcolor{keywordflow}{if} (slices < 3 || stacks < 1) \{}
\DoxyCodeLine{344         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{345     \}}
\DoxyCodeLine{346     \textcolor{keywordflow}{return} par\_shapes\_create\_parametric(par\_shapes\_\_cylinder, slices,}
\DoxyCodeLine{347         stacks, 0);}
\DoxyCodeLine{348 \}}
\DoxyCodeLine{349 }
\DoxyCodeLine{350 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_cone(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks)}
\DoxyCodeLine{351 \{}
\DoxyCodeLine{352     \textcolor{keywordflow}{if} (slices < 3 || stacks < 1) \{}
\DoxyCodeLine{353         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{354     \}}
\DoxyCodeLine{355     \textcolor{keywordflow}{return} par\_shapes\_create\_parametric(par\_shapes\_\_cone, slices,}
\DoxyCodeLine{356         stacks, 0);}
\DoxyCodeLine{357 \}}
\DoxyCodeLine{358 }
\DoxyCodeLine{359 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_parametric\_disk(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks)}
\DoxyCodeLine{360 \{}
\DoxyCodeLine{361     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* m = par\_shapes\_create\_cone(slices, stacks);}
\DoxyCodeLine{362     \textcolor{keywordflow}{if} (m) \{}
\DoxyCodeLine{363         par\_shapes\_scale(m, 1.0f, 1.0f, 0.0f);}
\DoxyCodeLine{364     \}}
\DoxyCodeLine{365     \textcolor{keywordflow}{return} m;}
\DoxyCodeLine{366 \}}
\DoxyCodeLine{367 }
\DoxyCodeLine{368 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_parametric\_sphere(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks)}
\DoxyCodeLine{369 \{}
\DoxyCodeLine{370     \textcolor{keywordflow}{if} (slices < 3 || stacks < 3) \{}
\DoxyCodeLine{371         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{372     \}}
\DoxyCodeLine{373     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* m = par\_shapes\_create\_parametric(par\_shapes\_\_sphere,}
\DoxyCodeLine{374         slices, stacks, 0);}
\DoxyCodeLine{375     par\_shapes\_remove\_degenerate(m, par\_shapes\_\_epsilon\_degenerate\_sphere);}
\DoxyCodeLine{376     \textcolor{keywordflow}{return} m;}
\DoxyCodeLine{377 \}}
\DoxyCodeLine{378 }
\DoxyCodeLine{379 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_hemisphere(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks)}
\DoxyCodeLine{380 \{}
\DoxyCodeLine{381     \textcolor{keywordflow}{if} (slices < 3 || stacks < 3) \{}
\DoxyCodeLine{382         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{383     \}}
\DoxyCodeLine{384     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* m = par\_shapes\_create\_parametric(par\_shapes\_\_hemisphere,}
\DoxyCodeLine{385         slices, stacks, 0);}
\DoxyCodeLine{386     par\_shapes\_remove\_degenerate(m, par\_shapes\_\_epsilon\_degenerate\_sphere);}
\DoxyCodeLine{387     \textcolor{keywordflow}{return} m;}
\DoxyCodeLine{388 \}}
\DoxyCodeLine{389 }
\DoxyCodeLine{390 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_torus(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks, \textcolor{keywordtype}{float} radius)}
\DoxyCodeLine{391 \{}
\DoxyCodeLine{392     \textcolor{keywordflow}{if} (slices < 3 || stacks < 3) \{}
\DoxyCodeLine{393         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{394     \}}
\DoxyCodeLine{395     assert(radius <= 1.0 \&\& \textcolor{stringliteral}{"{}Use smaller radius to avoid self-\/intersection."{}});}
\DoxyCodeLine{396     assert(radius >= 0.1 \&\& \textcolor{stringliteral}{"{}Use larger radius to avoid self-\/intersection."{}});}
\DoxyCodeLine{397     \textcolor{keywordtype}{void}* userdata = (\textcolor{keywordtype}{void}*) \&radius;}
\DoxyCodeLine{398     \textcolor{keywordflow}{return} par\_shapes\_create\_parametric(par\_shapes\_\_torus, slices,}
\DoxyCodeLine{399         stacks, userdata);}
\DoxyCodeLine{400 \}}
\DoxyCodeLine{401 }
\DoxyCodeLine{402 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_klein\_bottle(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks)}
\DoxyCodeLine{403 \{}
\DoxyCodeLine{404     \textcolor{keywordflow}{if} (slices < 3 || stacks < 3) \{}
\DoxyCodeLine{405         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{406     \}}
\DoxyCodeLine{407     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh = par\_shapes\_create\_parametric(}
\DoxyCodeLine{408         par\_shapes\_\_klein, slices, stacks, 0);}
\DoxyCodeLine{409     \textcolor{keywordtype}{int} face = 0;}
\DoxyCodeLine{410     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} stack = 0; stack < stacks; stack++) \{}
\DoxyCodeLine{411         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} slice = 0; slice < slices; slice++, face += 2) \{}
\DoxyCodeLine{412             \textcolor{keywordflow}{if} (stack < 27 * stacks / 32) \{}
\DoxyCodeLine{413                 par\_shapes\_invert(mesh, face, 2);}
\DoxyCodeLine{414             \}}
\DoxyCodeLine{415         \}}
\DoxyCodeLine{416     \}}
\DoxyCodeLine{417     par\_shapes\_\_compute\_welded\_normals(mesh);}
\DoxyCodeLine{418     \textcolor{keywordflow}{return} mesh;}
\DoxyCodeLine{419 \}}
\DoxyCodeLine{420 }
\DoxyCodeLine{421 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_trefoil\_knot(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks,}
\DoxyCodeLine{422     \textcolor{keywordtype}{float} radius)}
\DoxyCodeLine{423 \{}
\DoxyCodeLine{424     \textcolor{keywordflow}{if} (slices < 3 || stacks < 3) \{}
\DoxyCodeLine{425         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{426     \}}
\DoxyCodeLine{427     assert(radius <= 3.0 \&\& \textcolor{stringliteral}{"{}Use smaller radius to avoid self-\/intersection."{}});}
\DoxyCodeLine{428     assert(radius >= 0.5 \&\& \textcolor{stringliteral}{"{}Use larger radius to avoid self-\/intersection."{}});}
\DoxyCodeLine{429     \textcolor{keywordtype}{void}* userdata = (\textcolor{keywordtype}{void}*) \&radius;}
\DoxyCodeLine{430     \textcolor{keywordflow}{return} par\_shapes\_create\_parametric(par\_shapes\_\_trefoil, slices,}
\DoxyCodeLine{431         stacks, userdata);}
\DoxyCodeLine{432 \}}
\DoxyCodeLine{433 }
\DoxyCodeLine{434 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_plane(\textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks)}
\DoxyCodeLine{435 \{}
\DoxyCodeLine{436     \textcolor{keywordflow}{if} (slices < 1 || stacks < 1) \{}
\DoxyCodeLine{437         \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{438     \}}
\DoxyCodeLine{439     \textcolor{keywordflow}{return} par\_shapes\_create\_parametric(par\_shapes\_\_plane, slices,}
\DoxyCodeLine{440         stacks, 0);}
\DoxyCodeLine{441 \}}
\DoxyCodeLine{442 }
\DoxyCodeLine{443 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_parametric(par\_shapes\_fn fn,}
\DoxyCodeLine{444     \textcolor{keywordtype}{int} slices, \textcolor{keywordtype}{int} stacks, \textcolor{keywordtype}{void}* userdata)}
\DoxyCodeLine{445 \{}
\DoxyCodeLine{446     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh = PAR\_CALLOC(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}, 1);}
\DoxyCodeLine{447 }
\DoxyCodeLine{448     \textcolor{comment}{// Generate verts.}}
\DoxyCodeLine{449     mesh-\/>npoints = (slices + 1) * (stacks + 1);}
\DoxyCodeLine{450     mesh-\/>points = PAR\_CALLOC(\textcolor{keywordtype}{float}, 3 * mesh-\/>npoints);}
\DoxyCodeLine{451     \textcolor{keywordtype}{float} uv[2];}
\DoxyCodeLine{452     \textcolor{keywordtype}{float} xyz[3];}
\DoxyCodeLine{453     \textcolor{keywordtype}{float}* points = mesh-\/>points;}
\DoxyCodeLine{454     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} stack = 0; stack < stacks + 1; stack++) \{}
\DoxyCodeLine{455         uv[0] = (float) stack / stacks;}
\DoxyCodeLine{456         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} slice = 0; slice < slices + 1; slice++) \{}
\DoxyCodeLine{457             uv[1] = (float) slice / slices;}
\DoxyCodeLine{458             fn(uv, xyz, userdata);}
\DoxyCodeLine{459             *points++ = xyz[0];}
\DoxyCodeLine{460             *points++ = xyz[1];}
\DoxyCodeLine{461             *points++ = xyz[2];}
\DoxyCodeLine{462         \}}
\DoxyCodeLine{463     \}}
\DoxyCodeLine{464 }
\DoxyCodeLine{465     \textcolor{comment}{// Generate texture coordinates.}}
\DoxyCodeLine{466     mesh-\/>tcoords = PAR\_CALLOC(\textcolor{keywordtype}{float}, 2 * mesh-\/>npoints);}
\DoxyCodeLine{467     \textcolor{keywordtype}{float}* uvs = mesh-\/>tcoords;}
\DoxyCodeLine{468     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} stack = 0; stack < stacks + 1; stack++) \{}
\DoxyCodeLine{469         uv[0] = (float) stack / stacks;}
\DoxyCodeLine{470         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} slice = 0; slice < slices + 1; slice++) \{}
\DoxyCodeLine{471             uv[1] = (float) slice / slices;}
\DoxyCodeLine{472             *uvs++ = uv[0];}
\DoxyCodeLine{473             *uvs++ = uv[1];}
\DoxyCodeLine{474         \}}
\DoxyCodeLine{475     \}}
\DoxyCodeLine{476 }
\DoxyCodeLine{477     \textcolor{comment}{// Generate faces.}}
\DoxyCodeLine{478     mesh-\/>ntriangles = 2 * slices * stacks;}
\DoxyCodeLine{479     mesh-\/>triangles = PAR\_CALLOC(PAR\_SHAPES\_T, 3 * mesh-\/>ntriangles);}
\DoxyCodeLine{480     \textcolor{keywordtype}{int} v = 0;}
\DoxyCodeLine{481     PAR\_SHAPES\_T* face = mesh-\/>triangles;}
\DoxyCodeLine{482     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} stack = 0; stack < stacks; stack++) \{}
\DoxyCodeLine{483         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} slice = 0; slice < slices; slice++) \{}
\DoxyCodeLine{484             \textcolor{keywordtype}{int} next = slice + 1;}
\DoxyCodeLine{485             *face++ = v + slice + slices + 1;}
\DoxyCodeLine{486             *face++ = v + next;}
\DoxyCodeLine{487             *face++ = v + slice;}
\DoxyCodeLine{488             *face++ = v + slice + slices + 1;}
\DoxyCodeLine{489             *face++ = v + next + slices + 1;}
\DoxyCodeLine{490             *face++ = v + next;}
\DoxyCodeLine{491         \}}
\DoxyCodeLine{492         v += slices + 1;}
\DoxyCodeLine{493     \}}
\DoxyCodeLine{494 }
\DoxyCodeLine{495     par\_shapes\_\_compute\_welded\_normals(mesh);}
\DoxyCodeLine{496     \textcolor{keywordflow}{return} mesh;}
\DoxyCodeLine{497 \}}
\DoxyCodeLine{498 }
\DoxyCodeLine{499 \textcolor{keywordtype}{void} par\_shapes\_free\_mesh(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh)}
\DoxyCodeLine{500 \{}
\DoxyCodeLine{501     PAR\_FREE(mesh-\/>points);}
\DoxyCodeLine{502     PAR\_FREE(mesh-\/>triangles);}
\DoxyCodeLine{503     PAR\_FREE(mesh-\/>normals);}
\DoxyCodeLine{504     PAR\_FREE(mesh-\/>tcoords);}
\DoxyCodeLine{505     PAR\_FREE(mesh);}
\DoxyCodeLine{506 \}}
\DoxyCodeLine{507 }
\DoxyCodeLine{508 \textcolor{keywordtype}{void} par\_shapes\_export(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}} \textcolor{keyword}{const}* mesh, \textcolor{keywordtype}{char} \textcolor{keyword}{const}* filename)}
\DoxyCodeLine{509 \{}
\DoxyCodeLine{510     FILE* objfile = fopen(filename, \textcolor{stringliteral}{"{}wt"{}});}
\DoxyCodeLine{511     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* points = mesh-\/>points;}
\DoxyCodeLine{512     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* tcoords = mesh-\/>tcoords;}
\DoxyCodeLine{513     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* norms = mesh-\/>normals;}
\DoxyCodeLine{514     PAR\_SHAPES\_T \textcolor{keyword}{const}* indices = mesh-\/>triangles;}
\DoxyCodeLine{515     \textcolor{keywordflow}{if} (tcoords \&\& norms) \{}
\DoxyCodeLine{516         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} nvert = 0; nvert < mesh-\/>npoints; nvert++) \{}
\DoxyCodeLine{517             fprintf(objfile, \textcolor{stringliteral}{"{}v \%f \%f \%f\(\backslash\)n"{}}, points[0], points[1], points[2]);}
\DoxyCodeLine{518             fprintf(objfile, \textcolor{stringliteral}{"{}vt \%f \%f\(\backslash\)n"{}}, tcoords[0], tcoords[1]);}
\DoxyCodeLine{519             fprintf(objfile, \textcolor{stringliteral}{"{}vn \%f \%f \%f\(\backslash\)n"{}}, norms[0], norms[1], norms[2]);}
\DoxyCodeLine{520             points += 3;}
\DoxyCodeLine{521             norms += 3;}
\DoxyCodeLine{522             tcoords += 2;}
\DoxyCodeLine{523         \}}
\DoxyCodeLine{524         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} nface = 0; nface < mesh-\/>ntriangles; nface++) \{}
\DoxyCodeLine{525             \textcolor{keywordtype}{int} a = 1 + *indices++;}
\DoxyCodeLine{526             \textcolor{keywordtype}{int} b = 1 + *indices++;}
\DoxyCodeLine{527             \textcolor{keywordtype}{int} c = 1 + *indices++;}
\DoxyCodeLine{528             fprintf(objfile, \textcolor{stringliteral}{"{}f \%d/\%d/\%d \%d/\%d/\%d \%d/\%d/\%d\(\backslash\)n"{}},}
\DoxyCodeLine{529                 a, a, a, b, b, b, c, c, c);}
\DoxyCodeLine{530         \}}
\DoxyCodeLine{531     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (norms) \{}
\DoxyCodeLine{532         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} nvert = 0; nvert < mesh-\/>npoints; nvert++) \{}
\DoxyCodeLine{533             fprintf(objfile, \textcolor{stringliteral}{"{}v \%f \%f \%f\(\backslash\)n"{}}, points[0], points[1], points[2]);}
\DoxyCodeLine{534             fprintf(objfile, \textcolor{stringliteral}{"{}vn \%f \%f \%f\(\backslash\)n"{}}, norms[0], norms[1], norms[2]);}
\DoxyCodeLine{535             points += 3;}
\DoxyCodeLine{536             norms += 3;}
\DoxyCodeLine{537         \}}
\DoxyCodeLine{538         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} nface = 0; nface < mesh-\/>ntriangles; nface++) \{}
\DoxyCodeLine{539             \textcolor{keywordtype}{int} a = 1 + *indices++;}
\DoxyCodeLine{540             \textcolor{keywordtype}{int} b = 1 + *indices++;}
\DoxyCodeLine{541             \textcolor{keywordtype}{int} c = 1 + *indices++;}
\DoxyCodeLine{542             fprintf(objfile, \textcolor{stringliteral}{"{}f \%d//\%d \%d//\%d \%d//\%d\(\backslash\)n"{}}, a, a, b, b, c, c);}
\DoxyCodeLine{543         \}}
\DoxyCodeLine{544     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (tcoords) \{}
\DoxyCodeLine{545         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} nvert = 0; nvert < mesh-\/>npoints; nvert++) \{}
\DoxyCodeLine{546             fprintf(objfile, \textcolor{stringliteral}{"{}v \%f \%f \%f\(\backslash\)n"{}}, points[0], points[1], points[2]);}
\DoxyCodeLine{547             fprintf(objfile, \textcolor{stringliteral}{"{}vt \%f \%f\(\backslash\)n"{}}, tcoords[0], tcoords[1]);}
\DoxyCodeLine{548             points += 3;}
\DoxyCodeLine{549             tcoords += 2;}
\DoxyCodeLine{550         \}}
\DoxyCodeLine{551         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} nface = 0; nface < mesh-\/>ntriangles; nface++) \{}
\DoxyCodeLine{552             \textcolor{keywordtype}{int} a = 1 + *indices++;}
\DoxyCodeLine{553             \textcolor{keywordtype}{int} b = 1 + *indices++;}
\DoxyCodeLine{554             \textcolor{keywordtype}{int} c = 1 + *indices++;}
\DoxyCodeLine{555             fprintf(objfile, \textcolor{stringliteral}{"{}f \%d/\%d \%d/\%d \%d/\%d\(\backslash\)n"{}}, a, a, b, b, c, c);}
\DoxyCodeLine{556         \}}
\DoxyCodeLine{557     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{558         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} nvert = 0; nvert < mesh-\/>npoints; nvert++) \{}
\DoxyCodeLine{559             fprintf(objfile, \textcolor{stringliteral}{"{}v \%f \%f \%f\(\backslash\)n"{}}, points[0], points[1], points[2]);}
\DoxyCodeLine{560             points += 3;}
\DoxyCodeLine{561         \}}
\DoxyCodeLine{562         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} nface = 0; nface < mesh-\/>ntriangles; nface++) \{}
\DoxyCodeLine{563             \textcolor{keywordtype}{int} a = 1 + *indices++;}
\DoxyCodeLine{564             \textcolor{keywordtype}{int} b = 1 + *indices++;}
\DoxyCodeLine{565             \textcolor{keywordtype}{int} c = 1 + *indices++;}
\DoxyCodeLine{566             fprintf(objfile, \textcolor{stringliteral}{"{}f \%d \%d \%d\(\backslash\)n"{}}, a, b, c);}
\DoxyCodeLine{567         \}}
\DoxyCodeLine{568     \}}
\DoxyCodeLine{569     fclose(objfile);}
\DoxyCodeLine{570 \}}
\DoxyCodeLine{571 }
\DoxyCodeLine{572 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_sphere(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}* userdata)}
\DoxyCodeLine{573 \{}
\DoxyCodeLine{574     \textcolor{keywordtype}{float} phi = uv[0] * PAR\_PI;}
\DoxyCodeLine{575     \textcolor{keywordtype}{float} theta = uv[1] * 2 * PAR\_PI;}
\DoxyCodeLine{576     xyz[0] = cosf(theta) * sinf(phi);}
\DoxyCodeLine{577     xyz[1] = sinf(theta) * sinf(phi);}
\DoxyCodeLine{578     xyz[2] = cosf(phi);}
\DoxyCodeLine{579 \}}
\DoxyCodeLine{580 }
\DoxyCodeLine{581 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_hemisphere(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}* userdata)}
\DoxyCodeLine{582 \{}
\DoxyCodeLine{583     \textcolor{keywordtype}{float} phi = uv[0] * PAR\_PI;}
\DoxyCodeLine{584     \textcolor{keywordtype}{float} theta = uv[1] * PAR\_PI;}
\DoxyCodeLine{585     xyz[0] = cosf(theta) * sinf(phi);}
\DoxyCodeLine{586     xyz[1] = sinf(theta) * sinf(phi);}
\DoxyCodeLine{587     xyz[2] = cosf(phi);}
\DoxyCodeLine{588 \}}
\DoxyCodeLine{589 }
\DoxyCodeLine{590 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_plane(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}* userdata)}
\DoxyCodeLine{591 \{}
\DoxyCodeLine{592     xyz[0] = uv[0];}
\DoxyCodeLine{593     xyz[1] = uv[1];}
\DoxyCodeLine{594     xyz[2] = 0;}
\DoxyCodeLine{595 \}}
\DoxyCodeLine{596 }
\DoxyCodeLine{597 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_klein(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}* userdata)}
\DoxyCodeLine{598 \{}
\DoxyCodeLine{599     \textcolor{keywordtype}{float} u = uv[0] * PAR\_PI;}
\DoxyCodeLine{600     \textcolor{keywordtype}{float} v = uv[1] * 2 * PAR\_PI;}
\DoxyCodeLine{601     u = u * 2;}
\DoxyCodeLine{602     \textcolor{keywordflow}{if} (u < PAR\_PI) \{}
\DoxyCodeLine{603         xyz[0] = 3 * cosf(u) * (1 + sinf(u)) + (2 * (1 -\/ cosf(u) / 2)) *}
\DoxyCodeLine{604             cosf(u) * cosf(v);}
\DoxyCodeLine{605         xyz[2] = -\/8 * sinf(u) -\/ 2 * (1 -\/ cosf(u) / 2) * sinf(u) * cosf(v);}
\DoxyCodeLine{606     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{607         xyz[0] = 3 * cosf(u) * (1 + sinf(u)) + (2 * (1 -\/ cosf(u) / 2)) *}
\DoxyCodeLine{608             cosf(v + PAR\_PI);}
\DoxyCodeLine{609         xyz[2] = -\/8 * sinf(u);}
\DoxyCodeLine{610     \}}
\DoxyCodeLine{611     xyz[1] = -\/2 * (1 -\/ cosf(u) / 2) * sinf(v);}
\DoxyCodeLine{612 \}}
\DoxyCodeLine{613 }
\DoxyCodeLine{614 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_cylinder(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}* userdata)}
\DoxyCodeLine{615 \{}
\DoxyCodeLine{616     \textcolor{keywordtype}{float} theta = uv[1] * 2 * PAR\_PI;}
\DoxyCodeLine{617     xyz[0] = sinf(theta);}
\DoxyCodeLine{618     xyz[1] = cosf(theta);}
\DoxyCodeLine{619     xyz[2] = uv[0];}
\DoxyCodeLine{620 \}}
\DoxyCodeLine{621 }
\DoxyCodeLine{622 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_cone(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}* userdata)}
\DoxyCodeLine{623 \{}
\DoxyCodeLine{624     \textcolor{keywordtype}{float} r = 1.0f -\/ uv[0];}
\DoxyCodeLine{625     \textcolor{keywordtype}{float} theta = uv[1] * 2 * PAR\_PI;}
\DoxyCodeLine{626     xyz[0] = r * sinf(theta);}
\DoxyCodeLine{627     xyz[1] = r * cosf(theta);}
\DoxyCodeLine{628     xyz[2] = uv[0];}
\DoxyCodeLine{629 \}}
\DoxyCodeLine{630 }
\DoxyCodeLine{631 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_torus(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}* userdata)}
\DoxyCodeLine{632 \{}
\DoxyCodeLine{633     \textcolor{keywordtype}{float} major = 1;}
\DoxyCodeLine{634     \textcolor{keywordtype}{float} minor = *((\textcolor{keywordtype}{float}*) userdata);}
\DoxyCodeLine{635     \textcolor{keywordtype}{float} theta = uv[0] * 2 * PAR\_PI;}
\DoxyCodeLine{636     \textcolor{keywordtype}{float} phi = uv[1] * 2 * PAR\_PI;}
\DoxyCodeLine{637     \textcolor{keywordtype}{float} beta = major + minor * cosf(phi);}
\DoxyCodeLine{638     xyz[0] = cosf(theta) * beta;}
\DoxyCodeLine{639     xyz[1] = sinf(theta) * beta;}
\DoxyCodeLine{640     xyz[2] = sinf(phi) * minor;}
\DoxyCodeLine{641 \}}
\DoxyCodeLine{642 }
\DoxyCodeLine{643 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_trefoil(\textcolor{keywordtype}{float} \textcolor{keyword}{const}* uv, \textcolor{keywordtype}{float}* xyz, \textcolor{keywordtype}{void}* userdata)}
\DoxyCodeLine{644 \{}
\DoxyCodeLine{645     \textcolor{keywordtype}{float} minor = *((\textcolor{keywordtype}{float}*) userdata);}
\DoxyCodeLine{646     \textcolor{keyword}{const} \textcolor{keywordtype}{float} a = 0.5f;}
\DoxyCodeLine{647     \textcolor{keyword}{const} \textcolor{keywordtype}{float} b = 0.3f;}
\DoxyCodeLine{648     \textcolor{keyword}{const} \textcolor{keywordtype}{float} c = 0.5f;}
\DoxyCodeLine{649     \textcolor{keyword}{const} \textcolor{keywordtype}{float} d = minor * 0.1f;}
\DoxyCodeLine{650     \textcolor{keyword}{const} \textcolor{keywordtype}{float} u = (1 -\/ uv[0]) * 4 * PAR\_PI;}
\DoxyCodeLine{651     \textcolor{keyword}{const} \textcolor{keywordtype}{float} v = uv[1] * 2 * PAR\_PI;}
\DoxyCodeLine{652     \textcolor{keyword}{const} \textcolor{keywordtype}{float} r = a + b * cos(1.5f * u);}
\DoxyCodeLine{653     \textcolor{keyword}{const} \textcolor{keywordtype}{float} x = r * cos(u);}
\DoxyCodeLine{654     \textcolor{keyword}{const} \textcolor{keywordtype}{float} y = r * sin(u);}
\DoxyCodeLine{655     \textcolor{keyword}{const} \textcolor{keywordtype}{float} z = c * sin(1.5f * u);}
\DoxyCodeLine{656     \textcolor{keywordtype}{float} q[3];}
\DoxyCodeLine{657     q[0] =}
\DoxyCodeLine{658         -\/1.5f * b * sin(1.5f * u) * cos(u) -\/ (a + b * cos(1.5f * u)) * sin(u);}
\DoxyCodeLine{659     q[1] =}
\DoxyCodeLine{660         -\/1.5f * b * sin(1.5f * u) * sin(u) + (a + b * cos(1.5f * u)) * cos(u);}
\DoxyCodeLine{661     q[2] = 1.5f * c * cos(1.5f * u);}
\DoxyCodeLine{662     par\_shapes\_\_normalize3(q);}
\DoxyCodeLine{663     \textcolor{keywordtype}{float} qvn[3] = \{q[1], -\/q[0], 0\};}
\DoxyCodeLine{664     par\_shapes\_\_normalize3(qvn);}
\DoxyCodeLine{665     \textcolor{keywordtype}{float} ww[3];}
\DoxyCodeLine{666     par\_shapes\_\_cross3(ww, q, qvn);}
\DoxyCodeLine{667     xyz[0] = x + d * (qvn[0] * cos(v) + ww[0] * sin(v));}
\DoxyCodeLine{668     xyz[1] = y + d * (qvn[1] * cos(v) + ww[1] * sin(v));}
\DoxyCodeLine{669     xyz[2] = z + d * ww[2] * sin(v);}
\DoxyCodeLine{670 \}}
\DoxyCodeLine{671 }
\DoxyCodeLine{672 \textcolor{keywordtype}{void} par\_shapes\_set\_epsilon\_welded\_normals(\textcolor{keywordtype}{float} epsilon) \{}
\DoxyCodeLine{673     par\_shapes\_\_epsilon\_welded\_normals = epsilon;}
\DoxyCodeLine{674 \}}
\DoxyCodeLine{675 }
\DoxyCodeLine{676 \textcolor{keywordtype}{void} par\_shapes\_set\_epsilon\_degenerate\_sphere(\textcolor{keywordtype}{float} epsilon) \{}
\DoxyCodeLine{677     par\_shapes\_\_epsilon\_degenerate\_sphere = epsilon;}
\DoxyCodeLine{678 \}}
\DoxyCodeLine{679 }
\DoxyCodeLine{680 \textcolor{keywordtype}{void} par\_shapes\_merge(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* dst, \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}} \textcolor{keyword}{const}* src)}
\DoxyCodeLine{681 \{}
\DoxyCodeLine{682     PAR\_SHAPES\_T offset = dst-\/>npoints;}
\DoxyCodeLine{683     \textcolor{keywordtype}{int} npoints = dst-\/>npoints + src-\/>npoints;}
\DoxyCodeLine{684     \textcolor{keywordtype}{int} vecsize = \textcolor{keyword}{sizeof}(float) * 3;}
\DoxyCodeLine{685     dst-\/>points = PAR\_REALLOC(\textcolor{keywordtype}{float}, dst-\/>points, 3 * npoints);}
\DoxyCodeLine{686     memcpy(dst-\/>points + 3 * dst-\/>npoints, src-\/>points, vecsize * src-\/>npoints);}
\DoxyCodeLine{687     dst-\/>npoints = npoints;}
\DoxyCodeLine{688     \textcolor{keywordflow}{if} (src-\/>normals || dst-\/>normals) \{}
\DoxyCodeLine{689         dst-\/>normals = PAR\_REALLOC(\textcolor{keywordtype}{float}, dst-\/>normals, 3 * npoints);}
\DoxyCodeLine{690         \textcolor{keywordflow}{if} (src-\/>normals) \{}
\DoxyCodeLine{691             memcpy(dst-\/>normals + 3 * offset, src-\/>normals,}
\DoxyCodeLine{692                 vecsize * src-\/>npoints);}
\DoxyCodeLine{693         \}}
\DoxyCodeLine{694     \}}
\DoxyCodeLine{695     \textcolor{keywordflow}{if} (src-\/>tcoords || dst-\/>tcoords) \{}
\DoxyCodeLine{696         \textcolor{keywordtype}{int} uvsize = \textcolor{keyword}{sizeof}(float) * 2;}
\DoxyCodeLine{697         dst-\/>tcoords = PAR\_REALLOC(\textcolor{keywordtype}{float}, dst-\/>tcoords, 2 * npoints);}
\DoxyCodeLine{698         \textcolor{keywordflow}{if} (src-\/>tcoords) \{}
\DoxyCodeLine{699             memcpy(dst-\/>tcoords + 2 * offset, src-\/>tcoords,}
\DoxyCodeLine{700                 uvsize * src-\/>npoints);}
\DoxyCodeLine{701         \}}
\DoxyCodeLine{702     \}}
\DoxyCodeLine{703     \textcolor{keywordtype}{int} ntriangles = dst-\/>ntriangles + src-\/>ntriangles;}
\DoxyCodeLine{704     dst-\/>triangles = PAR\_REALLOC(PAR\_SHAPES\_T, dst-\/>triangles, 3 * ntriangles);}
\DoxyCodeLine{705     PAR\_SHAPES\_T* ptriangles = dst-\/>triangles + 3 * dst-\/>ntriangles;}
\DoxyCodeLine{706     PAR\_SHAPES\_T \textcolor{keyword}{const}* striangles = src-\/>triangles;}
\DoxyCodeLine{707     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < src-\/>ntriangles; i++) \{}
\DoxyCodeLine{708         *ptriangles++ = offset + *striangles++;}
\DoxyCodeLine{709         *ptriangles++ = offset + *striangles++;}
\DoxyCodeLine{710         *ptriangles++ = offset + *striangles++;}
\DoxyCodeLine{711     \}}
\DoxyCodeLine{712     dst-\/>ntriangles = ntriangles;}
\DoxyCodeLine{713 \}}
\DoxyCodeLine{714 }
\DoxyCodeLine{715 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_disk(\textcolor{keywordtype}{float} radius, \textcolor{keywordtype}{int} slices,}
\DoxyCodeLine{716     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* center, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* normal)}
\DoxyCodeLine{717 \{}
\DoxyCodeLine{718     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh = PAR\_CALLOC(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}, 1);}
\DoxyCodeLine{719     mesh-\/>npoints = slices + 1;}
\DoxyCodeLine{720     mesh-\/>points = PAR\_MALLOC(\textcolor{keywordtype}{float}, 3 * mesh-\/>npoints);}
\DoxyCodeLine{721     \textcolor{keywordtype}{float}* points = mesh-\/>points;}
\DoxyCodeLine{722     *points++ = 0;}
\DoxyCodeLine{723     *points++ = 0;}
\DoxyCodeLine{724     *points++ = 0;}
\DoxyCodeLine{725     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < slices; i++) \{}
\DoxyCodeLine{726         \textcolor{keywordtype}{float} theta = i * PAR\_PI * 2 / slices;}
\DoxyCodeLine{727         *points++ = radius * cos(theta);}
\DoxyCodeLine{728         *points++ = radius * sin(theta);}
\DoxyCodeLine{729         *points++ = 0;}
\DoxyCodeLine{730     \}}
\DoxyCodeLine{731     \textcolor{keywordtype}{float} nnormal[3] = \{normal[0], normal[1], normal[2]\};}
\DoxyCodeLine{732     par\_shapes\_\_normalize3(nnormal);}
\DoxyCodeLine{733     mesh-\/>normals = PAR\_MALLOC(\textcolor{keywordtype}{float}, 3 * mesh-\/>npoints);}
\DoxyCodeLine{734     \textcolor{keywordtype}{float}* norms = mesh-\/>normals;}
\DoxyCodeLine{735     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mesh-\/>npoints; i++) \{}
\DoxyCodeLine{736         *norms++ = nnormal[0];}
\DoxyCodeLine{737         *norms++ = nnormal[1];}
\DoxyCodeLine{738         *norms++ = nnormal[2];}
\DoxyCodeLine{739     \}}
\DoxyCodeLine{740     mesh-\/>ntriangles = slices;}
\DoxyCodeLine{741     mesh-\/>triangles = PAR\_MALLOC(PAR\_SHAPES\_T, 3 * mesh-\/>ntriangles);}
\DoxyCodeLine{742     PAR\_SHAPES\_T* triangles = mesh-\/>triangles;}
\DoxyCodeLine{743     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < slices; i++) \{}
\DoxyCodeLine{744         *triangles++ = 0;}
\DoxyCodeLine{745         *triangles++ = 1 + i;}
\DoxyCodeLine{746         *triangles++ = 1 + (i + 1) \% slices;}
\DoxyCodeLine{747     \}}
\DoxyCodeLine{748     \textcolor{keywordtype}{float} k[3] = \{0, 0, -\/1\};}
\DoxyCodeLine{749     \textcolor{keywordtype}{float} axis[3];}
\DoxyCodeLine{750     par\_shapes\_\_cross3(axis, nnormal, k);}
\DoxyCodeLine{751     par\_shapes\_\_normalize3(axis);}
\DoxyCodeLine{752     par\_shapes\_rotate(mesh, acos(nnormal[2]), axis);}
\DoxyCodeLine{753     par\_shapes\_translate(mesh, center[0], center[1], center[2]);}
\DoxyCodeLine{754     \textcolor{keywordflow}{return} mesh;}
\DoxyCodeLine{755 \}}
\DoxyCodeLine{756 }
\DoxyCodeLine{757 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_empty()}
\DoxyCodeLine{758 \{}
\DoxyCodeLine{759     \textcolor{keywordflow}{return} PAR\_CALLOC(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}, 1);}
\DoxyCodeLine{760 \}}
\DoxyCodeLine{761 }
\DoxyCodeLine{762 \textcolor{keywordtype}{void} par\_shapes\_translate(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* m, \textcolor{keywordtype}{float} x, \textcolor{keywordtype}{float} y, \textcolor{keywordtype}{float} z)}
\DoxyCodeLine{763 \{}
\DoxyCodeLine{764     \textcolor{keywordtype}{float}* points = m-\/>points;}
\DoxyCodeLine{765     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < m-\/>npoints; i++) \{}
\DoxyCodeLine{766         *points++ += x;}
\DoxyCodeLine{767         *points++ += y;}
\DoxyCodeLine{768         *points++ += z;}
\DoxyCodeLine{769     \}}
\DoxyCodeLine{770 \}}
\DoxyCodeLine{771 }
\DoxyCodeLine{772 \textcolor{keywordtype}{void} par\_shapes\_rotate(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh, \textcolor{keywordtype}{float} radians, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* axis)}
\DoxyCodeLine{773 \{}
\DoxyCodeLine{774     \textcolor{keywordtype}{float} s = sinf(radians);}
\DoxyCodeLine{775     \textcolor{keywordtype}{float} c = cosf(radians);}
\DoxyCodeLine{776     \textcolor{keywordtype}{float} x = axis[0];}
\DoxyCodeLine{777     \textcolor{keywordtype}{float} y = axis[1];}
\DoxyCodeLine{778     \textcolor{keywordtype}{float} z = axis[2];}
\DoxyCodeLine{779     \textcolor{keywordtype}{float} xy = x * y;}
\DoxyCodeLine{780     \textcolor{keywordtype}{float} yz = y * z;}
\DoxyCodeLine{781     \textcolor{keywordtype}{float} zx = z * x;}
\DoxyCodeLine{782     \textcolor{keywordtype}{float} oneMinusC = 1.0f -\/ c;}
\DoxyCodeLine{783     \textcolor{keywordtype}{float} col0[3] = \{}
\DoxyCodeLine{784         (((x * x) * oneMinusC) + c),}
\DoxyCodeLine{785         ((xy * oneMinusC) + (z * s)), ((zx * oneMinusC) -\/ (y * s))}
\DoxyCodeLine{786     \};}
\DoxyCodeLine{787     \textcolor{keywordtype}{float} col1[3] = \{}
\DoxyCodeLine{788         ((xy * oneMinusC) -\/ (z * s)),}
\DoxyCodeLine{789         (((y * y) * oneMinusC) + c), ((yz * oneMinusC) + (x * s))}
\DoxyCodeLine{790     \};}
\DoxyCodeLine{791     \textcolor{keywordtype}{float} col2[3] = \{}
\DoxyCodeLine{792         ((zx * oneMinusC) + (y * s)),}
\DoxyCodeLine{793         ((yz * oneMinusC) -\/ (x * s)), (((z * z) * oneMinusC) + c)}
\DoxyCodeLine{794     \};}
\DoxyCodeLine{795     \textcolor{keywordtype}{float}* p = mesh-\/>points;}
\DoxyCodeLine{796     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mesh-\/>npoints; i++, p += 3) \{}
\DoxyCodeLine{797         \textcolor{keywordtype}{float} x = col0[0] * p[0] + col1[0] * p[1] + col2[0] * p[2];}
\DoxyCodeLine{798         \textcolor{keywordtype}{float} y = col0[1] * p[0] + col1[1] * p[1] + col2[1] * p[2];}
\DoxyCodeLine{799         \textcolor{keywordtype}{float} z = col0[2] * p[0] + col1[2] * p[1] + col2[2] * p[2];}
\DoxyCodeLine{800         p[0] = x;}
\DoxyCodeLine{801         p[1] = y;}
\DoxyCodeLine{802         p[2] = z;}
\DoxyCodeLine{803     \}}
\DoxyCodeLine{804     \textcolor{keywordtype}{float}* n = mesh-\/>normals;}
\DoxyCodeLine{805     \textcolor{keywordflow}{if} (n) \{}
\DoxyCodeLine{806         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mesh-\/>npoints; i++, n += 3) \{}
\DoxyCodeLine{807             \textcolor{keywordtype}{float} x = col0[0] * n[0] + col1[0] * n[1] + col2[0] * n[2];}
\DoxyCodeLine{808             \textcolor{keywordtype}{float} y = col0[1] * n[0] + col1[1] * n[1] + col2[1] * n[2];}
\DoxyCodeLine{809             \textcolor{keywordtype}{float} z = col0[2] * n[0] + col1[2] * n[1] + col2[2] * n[2];}
\DoxyCodeLine{810             n[0] = x;}
\DoxyCodeLine{811             n[1] = y;}
\DoxyCodeLine{812             n[2] = z;}
\DoxyCodeLine{813         \}}
\DoxyCodeLine{814     \}}
\DoxyCodeLine{815 \}}
\DoxyCodeLine{816 }
\DoxyCodeLine{817 \textcolor{keywordtype}{void} par\_shapes\_scale(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* m, \textcolor{keywordtype}{float} x, \textcolor{keywordtype}{float} y, \textcolor{keywordtype}{float} z)}
\DoxyCodeLine{818 \{}
\DoxyCodeLine{819     \textcolor{keywordtype}{float}* points = m-\/>points;}
\DoxyCodeLine{820     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < m-\/>npoints; i++) \{}
\DoxyCodeLine{821         *points++ *= x;}
\DoxyCodeLine{822         *points++ *= y;}
\DoxyCodeLine{823         *points++ *= z;}
\DoxyCodeLine{824     \}}
\DoxyCodeLine{825     \textcolor{keywordtype}{float}* n = m-\/>normals;}
\DoxyCodeLine{826     \textcolor{keywordflow}{if} (n \&\& !(x == y \&\& y == z)) \{}
\DoxyCodeLine{827         \textcolor{keywordtype}{bool} x\_zero = x == 0;}
\DoxyCodeLine{828         \textcolor{keywordtype}{bool} y\_zero = y == 0;}
\DoxyCodeLine{829         \textcolor{keywordtype}{bool} z\_zero = z == 0;}
\DoxyCodeLine{830         \textcolor{keywordflow}{if} (!x\_zero \&\& !y\_zero \&\& !z\_zero) \{}
\DoxyCodeLine{831             x = 1.0f / x;}
\DoxyCodeLine{832             y = 1.0f / y;}
\DoxyCodeLine{833             z = 1.0f / z;}
\DoxyCodeLine{834         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{835             x = x\_zero \&\& !y\_zero \&\& !z\_zero;}
\DoxyCodeLine{836             y = y\_zero \&\& !x\_zero \&\& !z\_zero;}
\DoxyCodeLine{837             z = z\_zero \&\& !x\_zero \&\& !y\_zero;}
\DoxyCodeLine{838         \}}
\DoxyCodeLine{839         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < m-\/>npoints; i++, n += 3) \{}
\DoxyCodeLine{840             n[0] *= x;}
\DoxyCodeLine{841             n[1] *= y;}
\DoxyCodeLine{842             n[2] *= z;}
\DoxyCodeLine{843             par\_shapes\_\_normalize3(n);}
\DoxyCodeLine{844         \}}
\DoxyCodeLine{845     \}}
\DoxyCodeLine{846 \}}
\DoxyCodeLine{847 }
\DoxyCodeLine{848 \textcolor{keywordtype}{void} par\_shapes\_merge\_and\_free(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* dst, \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* src)}
\DoxyCodeLine{849 \{}
\DoxyCodeLine{850     par\_shapes\_merge(dst, src);}
\DoxyCodeLine{851     par\_shapes\_free\_mesh(src);}
\DoxyCodeLine{852 \}}
\DoxyCodeLine{853 }
\DoxyCodeLine{854 \textcolor{keywordtype}{void} par\_shapes\_compute\_aabb(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}} \textcolor{keyword}{const}* m, \textcolor{keywordtype}{float}* aabb)}
\DoxyCodeLine{855 \{}
\DoxyCodeLine{856     \textcolor{keywordtype}{float}* points = m-\/>points;}
\DoxyCodeLine{857     aabb[0] = aabb[3] = points[0];}
\DoxyCodeLine{858     aabb[1] = aabb[4] = points[1];}
\DoxyCodeLine{859     aabb[2] = aabb[5] = points[2];}
\DoxyCodeLine{860     points += 3;}
\DoxyCodeLine{861     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i < m-\/>npoints; i++, points += 3) \{}
\DoxyCodeLine{862         aabb[0] = PAR\_MIN(points[0], aabb[0]);}
\DoxyCodeLine{863         aabb[1] = PAR\_MIN(points[1], aabb[1]);}
\DoxyCodeLine{864         aabb[2] = PAR\_MIN(points[2], aabb[2]);}
\DoxyCodeLine{865         aabb[3] = PAR\_MAX(points[0], aabb[3]);}
\DoxyCodeLine{866         aabb[4] = PAR\_MAX(points[1], aabb[4]);}
\DoxyCodeLine{867         aabb[5] = PAR\_MAX(points[2], aabb[5]);}
\DoxyCodeLine{868     \}}
\DoxyCodeLine{869 \}}
\DoxyCodeLine{870 }
\DoxyCodeLine{871 \textcolor{keywordtype}{void} par\_shapes\_invert(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* m, \textcolor{keywordtype}{int} face, \textcolor{keywordtype}{int} nfaces)}
\DoxyCodeLine{872 \{}
\DoxyCodeLine{873     nfaces = nfaces ? nfaces : m-\/>ntriangles;}
\DoxyCodeLine{874     PAR\_SHAPES\_T* tri = m-\/>triangles + face * 3;}
\DoxyCodeLine{875     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < nfaces; i++) \{}
\DoxyCodeLine{876         PAR\_SWAP(PAR\_SHAPES\_T, tri[0], tri[2]);}
\DoxyCodeLine{877         tri += 3;}
\DoxyCodeLine{878     \}}
\DoxyCodeLine{879 \}}
\DoxyCodeLine{880 }
\DoxyCodeLine{881 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_icosahedron()}
\DoxyCodeLine{882 \{}
\DoxyCodeLine{883     \textcolor{keyword}{static} \textcolor{keywordtype}{float} verts[] = \{}
\DoxyCodeLine{884         0.000,  0.000,  1.000,}
\DoxyCodeLine{885         0.894,  0.000,  0.447,}
\DoxyCodeLine{886         0.276,  0.851,  0.447,}
\DoxyCodeLine{887         -\/0.724,  0.526,  0.447,}
\DoxyCodeLine{888         -\/0.724, -\/0.526,  0.447,}
\DoxyCodeLine{889         0.276, -\/0.851,  0.447,}
\DoxyCodeLine{890         0.724,  0.526, -\/0.447,}
\DoxyCodeLine{891         -\/0.276,  0.851, -\/0.447,}
\DoxyCodeLine{892         -\/0.894,  0.000, -\/0.447,}
\DoxyCodeLine{893         -\/0.276, -\/0.851, -\/0.447,}
\DoxyCodeLine{894         0.724, -\/0.526, -\/0.447,}
\DoxyCodeLine{895         0.000,  0.000, -\/1.000}
\DoxyCodeLine{896     \};}
\DoxyCodeLine{897     \textcolor{keyword}{static} PAR\_SHAPES\_T faces[] = \{}
\DoxyCodeLine{898         0,1,2,}
\DoxyCodeLine{899         0,2,3,}
\DoxyCodeLine{900         0,3,4,}
\DoxyCodeLine{901         0,4,5,}
\DoxyCodeLine{902         0,5,1,}
\DoxyCodeLine{903         7,6,11,}
\DoxyCodeLine{904         8,7,11,}
\DoxyCodeLine{905         9,8,11,}
\DoxyCodeLine{906         10,9,11,}
\DoxyCodeLine{907         6,10,11,}
\DoxyCodeLine{908         6,2,1,}
\DoxyCodeLine{909         7,3,2,}
\DoxyCodeLine{910         8,4,3,}
\DoxyCodeLine{911         9,5,4,}
\DoxyCodeLine{912         10,1,5,}
\DoxyCodeLine{913         6,7,2,}
\DoxyCodeLine{914         7,8,3,}
\DoxyCodeLine{915         8,9,4,}
\DoxyCodeLine{916         9,10,5,}
\DoxyCodeLine{917         10,6,1}
\DoxyCodeLine{918     \};}
\DoxyCodeLine{919     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh = PAR\_CALLOC(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}, 1);}
\DoxyCodeLine{920     mesh-\/>npoints = \textcolor{keyword}{sizeof}(verts) / \textcolor{keyword}{sizeof}(verts[0]) / 3;}
\DoxyCodeLine{921     mesh-\/>points = PAR\_MALLOC(\textcolor{keywordtype}{float}, \textcolor{keyword}{sizeof}(verts) / 4);}
\DoxyCodeLine{922     memcpy(mesh-\/>points, verts, \textcolor{keyword}{sizeof}(verts));}
\DoxyCodeLine{923     mesh-\/>ntriangles = \textcolor{keyword}{sizeof}(faces) / \textcolor{keyword}{sizeof}(faces[0]) / 3;}
\DoxyCodeLine{924     mesh-\/>triangles = PAR\_MALLOC(PAR\_SHAPES\_T, \textcolor{keyword}{sizeof}(faces) / 2);}
\DoxyCodeLine{925     memcpy(mesh-\/>triangles, faces, \textcolor{keyword}{sizeof}(faces));}
\DoxyCodeLine{926     \textcolor{keywordflow}{return} mesh;}
\DoxyCodeLine{927 \}}
\DoxyCodeLine{928 }
\DoxyCodeLine{929 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_dodecahedron()}
\DoxyCodeLine{930 \{}
\DoxyCodeLine{931     \textcolor{keyword}{static} \textcolor{keywordtype}{float} verts[20 * 3] = \{}
\DoxyCodeLine{932         0.607, 0.000, 0.795,}
\DoxyCodeLine{933         0.188, 0.577, 0.795,}
\DoxyCodeLine{934         -\/0.491, 0.357, 0.795,}
\DoxyCodeLine{935         -\/0.491, -\/0.357, 0.795,}
\DoxyCodeLine{936         0.188, -\/0.577, 0.795,}
\DoxyCodeLine{937         0.982, 0.000, 0.188,}
\DoxyCodeLine{938         0.304, 0.934, 0.188,}
\DoxyCodeLine{939         -\/0.795, 0.577, 0.188,}
\DoxyCodeLine{940         -\/0.795, -\/0.577, 0.188,}
\DoxyCodeLine{941         0.304, -\/0.934, 0.188,}
\DoxyCodeLine{942         0.795, 0.577, -\/0.188,}
\DoxyCodeLine{943         -\/0.304, 0.934, -\/0.188,}
\DoxyCodeLine{944         -\/0.982, 0.000, -\/0.188,}
\DoxyCodeLine{945         -\/0.304, -\/0.934, -\/0.188,}
\DoxyCodeLine{946         0.795, -\/0.577, -\/0.188,}
\DoxyCodeLine{947         0.491, 0.357, -\/0.795,}
\DoxyCodeLine{948         -\/0.188, 0.577, -\/0.795,}
\DoxyCodeLine{949         -\/0.607, 0.000, -\/0.795,}
\DoxyCodeLine{950         -\/0.188, -\/0.577, -\/0.795,}
\DoxyCodeLine{951         0.491, -\/0.357, -\/0.795,}
\DoxyCodeLine{952     \};}
\DoxyCodeLine{953     \textcolor{keyword}{static} PAR\_SHAPES\_T pentagons[12 * 5] = \{}
\DoxyCodeLine{954         0,1,2,3,4,}
\DoxyCodeLine{955         5,10,6,1,0,}
\DoxyCodeLine{956         6,11,7,2,1,}
\DoxyCodeLine{957         7,12,8,3,2,}
\DoxyCodeLine{958         8,13,9,4,3,}
\DoxyCodeLine{959         9,14,5,0,4,}
\DoxyCodeLine{960         15,16,11,6,10,}
\DoxyCodeLine{961         16,17,12,7,11,}
\DoxyCodeLine{962         17,18,13,8,12,}
\DoxyCodeLine{963         18,19,14,9,13,}
\DoxyCodeLine{964         19,15,10,5,14,}
\DoxyCodeLine{965         19,18,17,16,15}
\DoxyCodeLine{966     \};}
\DoxyCodeLine{967     \textcolor{keywordtype}{int} npentagons = \textcolor{keyword}{sizeof}(pentagons) / \textcolor{keyword}{sizeof}(pentagons[0]) / 5;}
\DoxyCodeLine{968     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh = PAR\_CALLOC(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}, 1);}
\DoxyCodeLine{969     \textcolor{keywordtype}{int} ncorners = \textcolor{keyword}{sizeof}(verts) / \textcolor{keyword}{sizeof}(verts[0]) / 3;}
\DoxyCodeLine{970     mesh-\/>npoints = ncorners;}
\DoxyCodeLine{971     mesh-\/>points = PAR\_MALLOC(\textcolor{keywordtype}{float}, mesh-\/>npoints * 3);}
\DoxyCodeLine{972     memcpy(mesh-\/>points, verts, \textcolor{keyword}{sizeof}(verts));}
\DoxyCodeLine{973     PAR\_SHAPES\_T \textcolor{keyword}{const}* pentagon = pentagons;}
\DoxyCodeLine{974     mesh-\/>ntriangles = npentagons * 3;}
\DoxyCodeLine{975     mesh-\/>triangles = PAR\_MALLOC(PAR\_SHAPES\_T, mesh-\/>ntriangles * 3);}
\DoxyCodeLine{976     PAR\_SHAPES\_T* tris = mesh-\/>triangles;}
\DoxyCodeLine{977     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < npentagons; p++, pentagon += 5) \{}
\DoxyCodeLine{978         *tris++ = pentagon[0];}
\DoxyCodeLine{979         *tris++ = pentagon[1];}
\DoxyCodeLine{980         *tris++ = pentagon[2];}
\DoxyCodeLine{981         *tris++ = pentagon[0];}
\DoxyCodeLine{982         *tris++ = pentagon[2];}
\DoxyCodeLine{983         *tris++ = pentagon[3];}
\DoxyCodeLine{984         *tris++ = pentagon[0];}
\DoxyCodeLine{985         *tris++ = pentagon[3];}
\DoxyCodeLine{986         *tris++ = pentagon[4];}
\DoxyCodeLine{987     \}}
\DoxyCodeLine{988     \textcolor{keywordflow}{return} mesh;}
\DoxyCodeLine{989 \}}
\DoxyCodeLine{990 }
\DoxyCodeLine{991 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_octahedron()}
\DoxyCodeLine{992 \{}
\DoxyCodeLine{993     \textcolor{keyword}{static} \textcolor{keywordtype}{float} verts[6 * 3] = \{}
\DoxyCodeLine{994         0.000, 0.000, 1.000,}
\DoxyCodeLine{995         1.000, 0.000, 0.000,}
\DoxyCodeLine{996         0.000, 1.000, 0.000,}
\DoxyCodeLine{997         -\/1.000, 0.000, 0.000,}
\DoxyCodeLine{998         0.000, -\/1.000, 0.000,}
\DoxyCodeLine{999         0.000, 0.000, -\/1.000}
\DoxyCodeLine{1000     \};}
\DoxyCodeLine{1001     \textcolor{keyword}{static} PAR\_SHAPES\_T triangles[8 * 3] = \{}
\DoxyCodeLine{1002         0,1,2,}
\DoxyCodeLine{1003         0,2,3,}
\DoxyCodeLine{1004         0,3,4,}
\DoxyCodeLine{1005         0,4,1,}
\DoxyCodeLine{1006         2,1,5,}
\DoxyCodeLine{1007         3,2,5,}
\DoxyCodeLine{1008         4,3,5,}
\DoxyCodeLine{1009         1,4,5,}
\DoxyCodeLine{1010     \};}
\DoxyCodeLine{1011     \textcolor{keywordtype}{int} ntris = \textcolor{keyword}{sizeof}(triangles) / \textcolor{keyword}{sizeof}(triangles[0]) / 3;}
\DoxyCodeLine{1012     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh = PAR\_CALLOC(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}, 1);}
\DoxyCodeLine{1013     \textcolor{keywordtype}{int} ncorners = \textcolor{keyword}{sizeof}(verts) / \textcolor{keyword}{sizeof}(verts[0]) / 3;}
\DoxyCodeLine{1014     mesh-\/>npoints = ncorners;}
\DoxyCodeLine{1015     mesh-\/>points = PAR\_MALLOC(\textcolor{keywordtype}{float}, mesh-\/>npoints * 3);}
\DoxyCodeLine{1016     memcpy(mesh-\/>points, verts, \textcolor{keyword}{sizeof}(verts));}
\DoxyCodeLine{1017     PAR\_SHAPES\_T \textcolor{keyword}{const}* triangle = triangles;}
\DoxyCodeLine{1018     mesh-\/>ntriangles = ntris;}
\DoxyCodeLine{1019     mesh-\/>triangles = PAR\_MALLOC(PAR\_SHAPES\_T, mesh-\/>ntriangles * 3);}
\DoxyCodeLine{1020     PAR\_SHAPES\_T* tris = mesh-\/>triangles;}
\DoxyCodeLine{1021     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < ntris; p++) \{}
\DoxyCodeLine{1022         *tris++ = *triangle++;}
\DoxyCodeLine{1023         *tris++ = *triangle++;}
\DoxyCodeLine{1024         *tris++ = *triangle++;}
\DoxyCodeLine{1025     \}}
\DoxyCodeLine{1026     \textcolor{keywordflow}{return} mesh;}
\DoxyCodeLine{1027 \}}
\DoxyCodeLine{1028 }
\DoxyCodeLine{1029 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_tetrahedron()}
\DoxyCodeLine{1030 \{}
\DoxyCodeLine{1031     \textcolor{keyword}{static} \textcolor{keywordtype}{float} verts[4 * 3] = \{}
\DoxyCodeLine{1032         0.000, 1.333, 0,}
\DoxyCodeLine{1033         0.943, 0, 0,}
\DoxyCodeLine{1034         -\/0.471, 0, 0.816,}
\DoxyCodeLine{1035         -\/0.471, 0, -\/0.816,}
\DoxyCodeLine{1036     \};}
\DoxyCodeLine{1037     \textcolor{keyword}{static} PAR\_SHAPES\_T triangles[4 * 3] = \{}
\DoxyCodeLine{1038         2,1,0,}
\DoxyCodeLine{1039         3,2,0,}
\DoxyCodeLine{1040         1,3,0,}
\DoxyCodeLine{1041         1,2,3,}
\DoxyCodeLine{1042     \};}
\DoxyCodeLine{1043     \textcolor{keywordtype}{int} ntris = \textcolor{keyword}{sizeof}(triangles) / \textcolor{keyword}{sizeof}(triangles[0]) / 3;}
\DoxyCodeLine{1044     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh = PAR\_CALLOC(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}, 1);}
\DoxyCodeLine{1045     \textcolor{keywordtype}{int} ncorners = \textcolor{keyword}{sizeof}(verts) / \textcolor{keyword}{sizeof}(verts[0]) / 3;}
\DoxyCodeLine{1046     mesh-\/>npoints = ncorners;}
\DoxyCodeLine{1047     mesh-\/>points = PAR\_MALLOC(\textcolor{keywordtype}{float}, mesh-\/>npoints * 3);}
\DoxyCodeLine{1048     memcpy(mesh-\/>points, verts, \textcolor{keyword}{sizeof}(verts));}
\DoxyCodeLine{1049     PAR\_SHAPES\_T \textcolor{keyword}{const}* triangle = triangles;}
\DoxyCodeLine{1050     mesh-\/>ntriangles = ntris;}
\DoxyCodeLine{1051     mesh-\/>triangles = PAR\_MALLOC(PAR\_SHAPES\_T, mesh-\/>ntriangles * 3);}
\DoxyCodeLine{1052     PAR\_SHAPES\_T* tris = mesh-\/>triangles;}
\DoxyCodeLine{1053     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < ntris; p++) \{}
\DoxyCodeLine{1054         *tris++ = *triangle++;}
\DoxyCodeLine{1055         *tris++ = *triangle++;}
\DoxyCodeLine{1056         *tris++ = *triangle++;}
\DoxyCodeLine{1057     \}}
\DoxyCodeLine{1058     \textcolor{keywordflow}{return} mesh;}
\DoxyCodeLine{1059 \}}
\DoxyCodeLine{1060 }
\DoxyCodeLine{1061 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_cube()}
\DoxyCodeLine{1062 \{}
\DoxyCodeLine{1063     \textcolor{keyword}{static} \textcolor{keywordtype}{float} verts[8 * 3] = \{}
\DoxyCodeLine{1064         0, 0, 0, \textcolor{comment}{// 0}}
\DoxyCodeLine{1065         0, 1, 0, \textcolor{comment}{// 1}}
\DoxyCodeLine{1066         1, 1, 0, \textcolor{comment}{// 2}}
\DoxyCodeLine{1067         1, 0, 0, \textcolor{comment}{// 3}}
\DoxyCodeLine{1068         0, 0, 1, \textcolor{comment}{// 4}}
\DoxyCodeLine{1069         0, 1, 1, \textcolor{comment}{// 5}}
\DoxyCodeLine{1070         1, 1, 1, \textcolor{comment}{// 6}}
\DoxyCodeLine{1071         1, 0, 1, \textcolor{comment}{// 7}}
\DoxyCodeLine{1072     \};}
\DoxyCodeLine{1073     \textcolor{keyword}{static} PAR\_SHAPES\_T quads[6 * 4] = \{}
\DoxyCodeLine{1074         7,6,5,4, \textcolor{comment}{// front}}
\DoxyCodeLine{1075         0,1,2,3, \textcolor{comment}{// back}}
\DoxyCodeLine{1076         6,7,3,2, \textcolor{comment}{// right}}
\DoxyCodeLine{1077         5,6,2,1, \textcolor{comment}{// top}}
\DoxyCodeLine{1078         4,5,1,0, \textcolor{comment}{// left}}
\DoxyCodeLine{1079         7,4,0,3, \textcolor{comment}{// bottom}}
\DoxyCodeLine{1080     \};}
\DoxyCodeLine{1081     \textcolor{keywordtype}{int} nquads = \textcolor{keyword}{sizeof}(quads) / \textcolor{keyword}{sizeof}(quads[0]) / 4;}
\DoxyCodeLine{1082     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh = PAR\_CALLOC(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}, 1);}
\DoxyCodeLine{1083     \textcolor{keywordtype}{int} ncorners = \textcolor{keyword}{sizeof}(verts) / \textcolor{keyword}{sizeof}(verts[0]) / 3;}
\DoxyCodeLine{1084     mesh-\/>npoints = ncorners;}
\DoxyCodeLine{1085     mesh-\/>points = PAR\_MALLOC(\textcolor{keywordtype}{float}, mesh-\/>npoints * 3);}
\DoxyCodeLine{1086     memcpy(mesh-\/>points, verts, \textcolor{keyword}{sizeof}(verts));}
\DoxyCodeLine{1087     PAR\_SHAPES\_T \textcolor{keyword}{const}* quad = quads;}
\DoxyCodeLine{1088     mesh-\/>ntriangles = nquads * 2;}
\DoxyCodeLine{1089     mesh-\/>triangles = PAR\_MALLOC(PAR\_SHAPES\_T, mesh-\/>ntriangles * 3);}
\DoxyCodeLine{1090     PAR\_SHAPES\_T* tris = mesh-\/>triangles;}
\DoxyCodeLine{1091     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < nquads; p++, quad += 4) \{}
\DoxyCodeLine{1092         *tris++ = quad[0];}
\DoxyCodeLine{1093         *tris++ = quad[1];}
\DoxyCodeLine{1094         *tris++ = quad[2];}
\DoxyCodeLine{1095         *tris++ = quad[2];}
\DoxyCodeLine{1096         *tris++ = quad[3];}
\DoxyCodeLine{1097         *tris++ = quad[0];}
\DoxyCodeLine{1098     \}}
\DoxyCodeLine{1099     \textcolor{keywordflow}{return} mesh;}
\DoxyCodeLine{1100 \}}
\DoxyCodeLine{1101 }
\DoxyCodeLine{1102 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{1103     \textcolor{keywordtype}{char}* cmd;}
\DoxyCodeLine{1104     \textcolor{keywordtype}{char}* arg;}
\DoxyCodeLine{1105 \} par\_shapes\_\_command;}
\DoxyCodeLine{1106 }
\DoxyCodeLine{1107 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{1108     \textcolor{keywordtype}{char} \textcolor{keyword}{const}* name;}
\DoxyCodeLine{1109     \textcolor{keywordtype}{int} weight;}
\DoxyCodeLine{1110     \textcolor{keywordtype}{int} ncommands;}
\DoxyCodeLine{1111     par\_shapes\_\_command* commands;}
\DoxyCodeLine{1112 \} par\_shapes\_\_rule;}
\DoxyCodeLine{1113 }
\DoxyCodeLine{1114 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{1115     \textcolor{keywordtype}{int} pc;}
\DoxyCodeLine{1116     \textcolor{keywordtype}{float} position[3];}
\DoxyCodeLine{1117     \textcolor{keywordtype}{float} scale[3];}
\DoxyCodeLine{1118     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* orientation;}
\DoxyCodeLine{1119     par\_shapes\_\_rule* rule;}
\DoxyCodeLine{1120 \} par\_shapes\_\_stackframe;}
\DoxyCodeLine{1121 }
\DoxyCodeLine{1122 \textcolor{keyword}{static} par\_shapes\_\_rule* par\_shapes\_\_pick\_rule(\textcolor{keyword}{const} \textcolor{keywordtype}{char}* name,}
\DoxyCodeLine{1123     par\_shapes\_\_rule* rules, \textcolor{keywordtype}{int} nrules)}
\DoxyCodeLine{1124 \{}
\DoxyCodeLine{1125     par\_shapes\_\_rule* rule = 0;}
\DoxyCodeLine{1126     \textcolor{keywordtype}{int} total = 0;}
\DoxyCodeLine{1127     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < nrules; i++) \{}
\DoxyCodeLine{1128         rule = rules + i;}
\DoxyCodeLine{1129         \textcolor{keywordflow}{if} (!strcmp(rule-\/>name, name)) \{}
\DoxyCodeLine{1130             total += rule-\/>weight;}
\DoxyCodeLine{1131         \}}
\DoxyCodeLine{1132     \}}
\DoxyCodeLine{1133     \textcolor{keywordtype}{float} r = (float) rand() / RAND\_MAX;}
\DoxyCodeLine{1134     \textcolor{keywordtype}{float} t = 0;}
\DoxyCodeLine{1135     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < nrules; i++) \{}
\DoxyCodeLine{1136         rule = rules + i;}
\DoxyCodeLine{1137         \textcolor{keywordflow}{if} (!strcmp(rule-\/>name, name)) \{}
\DoxyCodeLine{1138             t += (float) rule-\/>weight / total;}
\DoxyCodeLine{1139             if (t >= r) \{}
\DoxyCodeLine{1140                 \textcolor{keywordflow}{return} rule;}
\DoxyCodeLine{1141             \}}
\DoxyCodeLine{1142         \}}
\DoxyCodeLine{1143     \}}
\DoxyCodeLine{1144     \textcolor{keywordflow}{return} rule;}
\DoxyCodeLine{1145 \}}
\DoxyCodeLine{1146 }
\DoxyCodeLine{1147 \textcolor{keyword}{static} \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_\_create\_turtle()}
\DoxyCodeLine{1148 \{}
\DoxyCodeLine{1149     \textcolor{keyword}{const} \textcolor{keywordtype}{float} xaxis[] = \{1, 0, 0\};}
\DoxyCodeLine{1150     \textcolor{keyword}{const} \textcolor{keywordtype}{float} yaxis[] = \{0, 1, 0\};}
\DoxyCodeLine{1151     \textcolor{keyword}{const} \textcolor{keywordtype}{float} zaxis[] = \{0, 0, 1\};}
\DoxyCodeLine{1152     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* turtle = PAR\_CALLOC(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}, 1);}
\DoxyCodeLine{1153     turtle-\/>npoints = 3;}
\DoxyCodeLine{1154     turtle-\/>points = PAR\_CALLOC(\textcolor{keywordtype}{float}, turtle-\/>npoints * 3);}
\DoxyCodeLine{1155     par\_shapes\_\_copy3(turtle-\/>points + 0, xaxis);}
\DoxyCodeLine{1156     par\_shapes\_\_copy3(turtle-\/>points + 3, yaxis);}
\DoxyCodeLine{1157     par\_shapes\_\_copy3(turtle-\/>points + 6, zaxis);}
\DoxyCodeLine{1158     \textcolor{keywordflow}{return} turtle;}
\DoxyCodeLine{1159 \}}
\DoxyCodeLine{1160 }
\DoxyCodeLine{1161 \textcolor{keyword}{static} \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_\_apply\_turtle(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh,}
\DoxyCodeLine{1162     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* turtle, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* pos, \textcolor{keywordtype}{float} \textcolor{keyword}{const}* scale)}
\DoxyCodeLine{1163 \{}
\DoxyCodeLine{1164     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* m = par\_shapes\_clone(mesh, 0);}
\DoxyCodeLine{1165     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < m-\/>npoints; p++) \{}
\DoxyCodeLine{1166         \textcolor{keywordtype}{float}* pt = m-\/>points + p * 3;}
\DoxyCodeLine{1167         pt[0] *= scale[0];}
\DoxyCodeLine{1168         pt[1] *= scale[1];}
\DoxyCodeLine{1169         pt[2] *= scale[2];}
\DoxyCodeLine{1170         par\_shapes\_\_transform3(pt,}
\DoxyCodeLine{1171             turtle-\/>points + 0, turtle-\/>points + 3, turtle-\/>points + 6);}
\DoxyCodeLine{1172         pt[0] += pos[0];}
\DoxyCodeLine{1173         pt[1] += pos[1];}
\DoxyCodeLine{1174         pt[2] += pos[2];}
\DoxyCodeLine{1175     \}}
\DoxyCodeLine{1176     \textcolor{keywordflow}{return} m;}
\DoxyCodeLine{1177 \}}
\DoxyCodeLine{1178 }
\DoxyCodeLine{1179 \textcolor{keywordtype}{void} par\_shapes\_\_connect(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* scene, \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* cylinder,}
\DoxyCodeLine{1180     \textcolor{keywordtype}{int} slices)}
\DoxyCodeLine{1181 \{}
\DoxyCodeLine{1182     \textcolor{keywordtype}{int} stacks = 1;}
\DoxyCodeLine{1183     \textcolor{keywordtype}{int} npoints = (slices + 1) * (stacks + 1);}
\DoxyCodeLine{1184     assert(scene-\/>npoints >= npoints \&\& \textcolor{stringliteral}{"{}Cannot connect to empty scene."{}});}
\DoxyCodeLine{1185 }
\DoxyCodeLine{1186     \textcolor{comment}{// Create the new point list.}}
\DoxyCodeLine{1187     npoints = scene-\/>npoints + (slices + 1);}
\DoxyCodeLine{1188     \textcolor{keywordtype}{float}* points = PAR\_MALLOC(\textcolor{keywordtype}{float}, npoints * 3);}
\DoxyCodeLine{1189     memcpy(points, scene-\/>points, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}) * scene-\/>npoints * 3);}
\DoxyCodeLine{1190     \textcolor{keywordtype}{float}* newpts = points + scene-\/>npoints * 3;}
\DoxyCodeLine{1191     memcpy(newpts, cylinder-\/>points + (slices + 1) * 3,}
\DoxyCodeLine{1192         \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}) * (slices + 1) * 3);}
\DoxyCodeLine{1193     PAR\_FREE(scene-\/>points);}
\DoxyCodeLine{1194     scene-\/>points = points;}
\DoxyCodeLine{1195 }
\DoxyCodeLine{1196     \textcolor{comment}{// Create the new triangle list.}}
\DoxyCodeLine{1197     \textcolor{keywordtype}{int} ntriangles = scene-\/>ntriangles + 2 * slices * stacks;}
\DoxyCodeLine{1198     PAR\_SHAPES\_T* triangles = PAR\_MALLOC(PAR\_SHAPES\_T, ntriangles * 3);}
\DoxyCodeLine{1199     memcpy(triangles, scene-\/>triangles,}
\DoxyCodeLine{1200         \textcolor{keyword}{sizeof}(PAR\_SHAPES\_T) * scene-\/>ntriangles * 3);}
\DoxyCodeLine{1201     \textcolor{keywordtype}{int} v = scene-\/>npoints -\/ (slices + 1);}
\DoxyCodeLine{1202     PAR\_SHAPES\_T* face = triangles + scene-\/>ntriangles * 3;}
\DoxyCodeLine{1203     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} stack = 0; stack < stacks; stack++) \{}
\DoxyCodeLine{1204         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} slice = 0; slice < slices; slice++) \{}
\DoxyCodeLine{1205             \textcolor{keywordtype}{int} next = slice + 1;}
\DoxyCodeLine{1206             *face++ = v + slice + slices + 1;}
\DoxyCodeLine{1207             *face++ = v + next;}
\DoxyCodeLine{1208             *face++ = v + slice;}
\DoxyCodeLine{1209             *face++ = v + slice + slices + 1;}
\DoxyCodeLine{1210             *face++ = v + next + slices + 1;}
\DoxyCodeLine{1211             *face++ = v + next;}
\DoxyCodeLine{1212         \}}
\DoxyCodeLine{1213         v += slices + 1;}
\DoxyCodeLine{1214     \}}
\DoxyCodeLine{1215     PAR\_FREE(scene-\/>triangles);}
\DoxyCodeLine{1216     scene-\/>triangles = triangles;}
\DoxyCodeLine{1217 }
\DoxyCodeLine{1218     scene-\/>npoints = npoints;}
\DoxyCodeLine{1219     scene-\/>ntriangles = ntriangles;}
\DoxyCodeLine{1220 \}}
\DoxyCodeLine{1221 }
\DoxyCodeLine{1222 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_lsystem(\textcolor{keywordtype}{char} \textcolor{keyword}{const}* text, \textcolor{keywordtype}{int} slices,}
\DoxyCodeLine{1223     \textcolor{keywordtype}{int} maxdepth)}
\DoxyCodeLine{1224 \{}
\DoxyCodeLine{1225     \textcolor{keywordtype}{char}* program;}
\DoxyCodeLine{1226     program = PAR\_MALLOC(\textcolor{keywordtype}{char}, strlen(text) + 1);}
\DoxyCodeLine{1227 }
\DoxyCodeLine{1228     \textcolor{comment}{// The first pass counts the number of rules and commands.}}
\DoxyCodeLine{1229     strcpy(program, text);}
\DoxyCodeLine{1230     \textcolor{keywordtype}{char} *cmd = strtok(program, \textcolor{stringliteral}{"{} "{}});}
\DoxyCodeLine{1231     \textcolor{keywordtype}{int} nrules = 1;}
\DoxyCodeLine{1232     \textcolor{keywordtype}{int} ncommands = 0;}
\DoxyCodeLine{1233     \textcolor{keywordflow}{while} (cmd) \{}
\DoxyCodeLine{1234         \textcolor{keywordtype}{char} *arg = strtok(0, \textcolor{stringliteral}{"{} "{}});}
\DoxyCodeLine{1235         \textcolor{keywordflow}{if} (!arg) \{}
\DoxyCodeLine{1236             puts(\textcolor{stringliteral}{"{}lsystem error: unexpected end of program."{}});}
\DoxyCodeLine{1237             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1238         \}}
\DoxyCodeLine{1239         \textcolor{keywordflow}{if} (!strcmp(cmd, \textcolor{stringliteral}{"{}rule"{}})) \{}
\DoxyCodeLine{1240             nrules++;}
\DoxyCodeLine{1241         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1242             ncommands++;}
\DoxyCodeLine{1243         \}}
\DoxyCodeLine{1244         cmd = strtok(0, \textcolor{stringliteral}{"{} "{}});}
\DoxyCodeLine{1245     \}}
\DoxyCodeLine{1246 }
\DoxyCodeLine{1247     \textcolor{comment}{// Allocate space.}}
\DoxyCodeLine{1248     par\_shapes\_\_rule* rules = PAR\_MALLOC(par\_shapes\_\_rule, nrules);}
\DoxyCodeLine{1249     par\_shapes\_\_command* commands = PAR\_MALLOC(par\_shapes\_\_command, ncommands);}
\DoxyCodeLine{1250 }
\DoxyCodeLine{1251     \textcolor{comment}{// Initialize the entry rule.}}
\DoxyCodeLine{1252     par\_shapes\_\_rule* current\_rule = \&rules[0];}
\DoxyCodeLine{1253     par\_shapes\_\_command* current\_command = \&commands[0];}
\DoxyCodeLine{1254     current\_rule-\/>name = \textcolor{stringliteral}{"{}entry"{}};}
\DoxyCodeLine{1255     current\_rule-\/>weight = 1;}
\DoxyCodeLine{1256     current\_rule-\/>ncommands = 0;}
\DoxyCodeLine{1257     current\_rule-\/>commands = current\_command;}
\DoxyCodeLine{1258 }
\DoxyCodeLine{1259     \textcolor{comment}{// The second pass fills in the structures.}}
\DoxyCodeLine{1260     strcpy(program, text);}
\DoxyCodeLine{1261     cmd = strtok(program, \textcolor{stringliteral}{"{} "{}});}
\DoxyCodeLine{1262     \textcolor{keywordflow}{while} (cmd) \{}
\DoxyCodeLine{1263         \textcolor{keywordtype}{char} *arg = strtok(0, \textcolor{stringliteral}{"{} "{}});}
\DoxyCodeLine{1264         \textcolor{keywordflow}{if} (!strcmp(cmd, \textcolor{stringliteral}{"{}rule"{}})) \{}
\DoxyCodeLine{1265             current\_rule++;}
\DoxyCodeLine{1266 }
\DoxyCodeLine{1267             \textcolor{comment}{// Split the argument into a rule name and weight.}}
\DoxyCodeLine{1268             \textcolor{keywordtype}{char}* dot = strchr(arg, \textcolor{charliteral}{'.'});}
\DoxyCodeLine{1269             \textcolor{keywordflow}{if} (dot) \{}
\DoxyCodeLine{1270                 current\_rule-\/>weight = atoi(dot + 1);}
\DoxyCodeLine{1271                 *dot = 0;}
\DoxyCodeLine{1272             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1273                 current\_rule-\/>weight = 1;}
\DoxyCodeLine{1274             \}}
\DoxyCodeLine{1275 }
\DoxyCodeLine{1276             current\_rule-\/>name = arg;}
\DoxyCodeLine{1277             current\_rule-\/>ncommands = 0;}
\DoxyCodeLine{1278             current\_rule-\/>commands = current\_command;}
\DoxyCodeLine{1279         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1280             current\_rule-\/>ncommands++;}
\DoxyCodeLine{1281             current\_command-\/>cmd = cmd;}
\DoxyCodeLine{1282             current\_command-\/>arg = arg;}
\DoxyCodeLine{1283             current\_command++;}
\DoxyCodeLine{1284         \}}
\DoxyCodeLine{1285         cmd = strtok(0, \textcolor{stringliteral}{"{} "{}});}
\DoxyCodeLine{1286     \}}
\DoxyCodeLine{1287 }
\DoxyCodeLine{1288     \textcolor{comment}{// For testing purposes, dump out the parsed program.}}
\DoxyCodeLine{1289 \textcolor{preprocessor}{    \#ifdef TEST\_PARSE}}
\DoxyCodeLine{1290     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < nrules; i++) \{}
\DoxyCodeLine{1291         par\_shapes\_\_rule rule = rules[i];}
\DoxyCodeLine{1292         printf(\textcolor{stringliteral}{"{}rule \%s.\%d\(\backslash\)n"{}}, rule.name, rule.weight);}
\DoxyCodeLine{1293         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} c = 0; c < rule.ncommands; c++) \{}
\DoxyCodeLine{1294             par\_shapes\_\_command cmd = rule.commands[c];}
\DoxyCodeLine{1295             printf(\textcolor{stringliteral}{"{}\(\backslash\)t\%s \%s\(\backslash\)n"{}}, cmd.cmd, cmd.arg);}
\DoxyCodeLine{1296         \}}
\DoxyCodeLine{1297     \}}
\DoxyCodeLine{1298 \textcolor{preprocessor}{    \#endif}}
\DoxyCodeLine{1299 }
\DoxyCodeLine{1300     \textcolor{comment}{// Instantiate the aggregated shape and the template shapes.}}
\DoxyCodeLine{1301     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* scene = PAR\_CALLOC(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}, 1);}
\DoxyCodeLine{1302     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* tube = par\_shapes\_create\_cylinder(slices, 1);}
\DoxyCodeLine{1303     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* turtle = par\_shapes\_\_create\_turtle();}
\DoxyCodeLine{1304 }
\DoxyCodeLine{1305     \textcolor{comment}{// We're not attempting to support texture coordinates and normals}}
\DoxyCodeLine{1306     \textcolor{comment}{// with L-\/systems, so remove them from the template shape.}}
\DoxyCodeLine{1307     PAR\_FREE(tube-\/>normals);}
\DoxyCodeLine{1308     PAR\_FREE(tube-\/>tcoords);}
\DoxyCodeLine{1309     tube-\/>normals = 0;}
\DoxyCodeLine{1310     tube-\/>tcoords = 0;}
\DoxyCodeLine{1311 }
\DoxyCodeLine{1312     \textcolor{keyword}{const} \textcolor{keywordtype}{float} xaxis[] = \{1, 0, 0\};}
\DoxyCodeLine{1313     \textcolor{keyword}{const} \textcolor{keywordtype}{float} yaxis[] = \{0, 1, 0\};}
\DoxyCodeLine{1314     \textcolor{keyword}{const} \textcolor{keywordtype}{float} zaxis[] = \{0, 0, 1\};}
\DoxyCodeLine{1315     \textcolor{keyword}{const} \textcolor{keywordtype}{float} units[] = \{1, 1, 1\};}
\DoxyCodeLine{1316 }
\DoxyCodeLine{1317     \textcolor{comment}{// Execute the L-\/system program until the stack size is 0.}}
\DoxyCodeLine{1318     par\_shapes\_\_stackframe* stack =}
\DoxyCodeLine{1319         PAR\_CALLOC(par\_shapes\_\_stackframe, maxdepth);}
\DoxyCodeLine{1320     \textcolor{keywordtype}{int} stackptr = 0;}
\DoxyCodeLine{1321     stack[0].orientation = turtle;}
\DoxyCodeLine{1322     stack[0].rule = \&rules[0];}
\DoxyCodeLine{1323     par\_shapes\_\_copy3(stack[0].scale, units);}
\DoxyCodeLine{1324     \textcolor{keywordflow}{while} (stackptr >= 0) \{}
\DoxyCodeLine{1325         par\_shapes\_\_stackframe* frame = \&stack[stackptr];}
\DoxyCodeLine{1326         par\_shapes\_\_rule* rule = frame-\/>rule;}
\DoxyCodeLine{1327         \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* turtle = frame-\/>orientation;}
\DoxyCodeLine{1328         \textcolor{keywordtype}{float}* position = frame-\/>position;}
\DoxyCodeLine{1329         \textcolor{keywordtype}{float}* scale = frame-\/>scale;}
\DoxyCodeLine{1330         \textcolor{keywordflow}{if} (frame-\/>pc >= rule-\/>ncommands) \{}
\DoxyCodeLine{1331             par\_shapes\_free\_mesh(turtle);}
\DoxyCodeLine{1332             stackptr-\/-\/;}
\DoxyCodeLine{1333             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{1334         \}}
\DoxyCodeLine{1335 }
\DoxyCodeLine{1336         par\_shapes\_\_command* cmd = rule-\/>commands + (frame-\/>pc++);}
\DoxyCodeLine{1337 \textcolor{preprocessor}{        \#ifdef DUMP\_TRACE}}
\DoxyCodeLine{1338         printf(\textcolor{stringliteral}{"{}\%5s \%5s \%5s:\%d  \%03d\(\backslash\)n"{}}, cmd-\/>cmd, cmd-\/>arg, rule-\/>name,}
\DoxyCodeLine{1339             frame-\/>pc -\/ 1, stackptr);}
\DoxyCodeLine{1340 \textcolor{preprocessor}{        \#endif}}
\DoxyCodeLine{1341 }
\DoxyCodeLine{1342         \textcolor{keywordtype}{float} value;}
\DoxyCodeLine{1343         \textcolor{keywordflow}{if} (!strcmp(cmd-\/>cmd, \textcolor{stringliteral}{"{}shape"{}})) \{}
\DoxyCodeLine{1344             \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* m = par\_shapes\_\_apply\_turtle(tube, turtle,}
\DoxyCodeLine{1345                 position, scale);}
\DoxyCodeLine{1346             \textcolor{keywordflow}{if} (!strcmp(cmd-\/>arg, \textcolor{stringliteral}{"{}connect"{}})) \{}
\DoxyCodeLine{1347                 par\_shapes\_\_connect(scene, m, slices);}
\DoxyCodeLine{1348             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1349                 par\_shapes\_merge(scene, m);}
\DoxyCodeLine{1350             \}}
\DoxyCodeLine{1351             par\_shapes\_free\_mesh(m);}
\DoxyCodeLine{1352         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!strcmp(cmd-\/>cmd, \textcolor{stringliteral}{"{}call"{}}) \&\& stackptr < maxdepth -\/ 1) \{}
\DoxyCodeLine{1353             rule = par\_shapes\_\_pick\_rule(cmd-\/>arg, rules, nrules);}
\DoxyCodeLine{1354             frame = \&stack[++stackptr];}
\DoxyCodeLine{1355             frame-\/>rule = rule;}
\DoxyCodeLine{1356             frame-\/>orientation = par\_shapes\_clone(turtle, 0);}
\DoxyCodeLine{1357             frame-\/>pc = 0;}
\DoxyCodeLine{1358             par\_shapes\_\_copy3(frame-\/>scale, scale);}
\DoxyCodeLine{1359             par\_shapes\_\_copy3(frame-\/>position, position);}
\DoxyCodeLine{1360             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{1361         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1362             value = atof(cmd-\/>arg);}
\DoxyCodeLine{1363             \textcolor{keywordflow}{if} (!strcmp(cmd-\/>cmd, \textcolor{stringliteral}{"{}rx"{}})) \{}
\DoxyCodeLine{1364                 par\_shapes\_rotate(turtle, value * PAR\_PI / 180.0, xaxis);}
\DoxyCodeLine{1365             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!strcmp(cmd-\/>cmd, \textcolor{stringliteral}{"{}ry"{}})) \{}
\DoxyCodeLine{1366                 par\_shapes\_rotate(turtle, value * PAR\_PI / 180.0, yaxis);}
\DoxyCodeLine{1367             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!strcmp(cmd-\/>cmd, \textcolor{stringliteral}{"{}rz"{}})) \{}
\DoxyCodeLine{1368                 par\_shapes\_rotate(turtle, value * PAR\_PI / 180.0, zaxis);}
\DoxyCodeLine{1369             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!strcmp(cmd-\/>cmd, \textcolor{stringliteral}{"{}tx"{}})) \{}
\DoxyCodeLine{1370                 \textcolor{keywordtype}{float} vec[3] = \{value, 0, 0\};}
\DoxyCodeLine{1371                 \textcolor{keywordtype}{float} t[3] = \{}
\DoxyCodeLine{1372                     par\_shapes\_\_dot3(turtle-\/>points + 0, vec),}
\DoxyCodeLine{1373                     par\_shapes\_\_dot3(turtle-\/>points + 3, vec),}
\DoxyCodeLine{1374                     par\_shapes\_\_dot3(turtle-\/>points + 6, vec)}
\DoxyCodeLine{1375                 \};}
\DoxyCodeLine{1376                 par\_shapes\_\_add3(position, t);}
\DoxyCodeLine{1377             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!strcmp(cmd-\/>cmd, \textcolor{stringliteral}{"{}ty"{}})) \{}
\DoxyCodeLine{1378                 \textcolor{keywordtype}{float} vec[3] = \{0, value, 0\};}
\DoxyCodeLine{1379                 \textcolor{keywordtype}{float} t[3] = \{}
\DoxyCodeLine{1380                     par\_shapes\_\_dot3(turtle-\/>points + 0, vec),}
\DoxyCodeLine{1381                     par\_shapes\_\_dot3(turtle-\/>points + 3, vec),}
\DoxyCodeLine{1382                     par\_shapes\_\_dot3(turtle-\/>points + 6, vec)}
\DoxyCodeLine{1383                 \};}
\DoxyCodeLine{1384                 par\_shapes\_\_add3(position, t);}
\DoxyCodeLine{1385             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!strcmp(cmd-\/>cmd, \textcolor{stringliteral}{"{}tz"{}})) \{}
\DoxyCodeLine{1386                 \textcolor{keywordtype}{float} vec[3] = \{0, 0, value\};}
\DoxyCodeLine{1387                 \textcolor{keywordtype}{float} t[3] = \{}
\DoxyCodeLine{1388                     par\_shapes\_\_dot3(turtle-\/>points + 0, vec),}
\DoxyCodeLine{1389                     par\_shapes\_\_dot3(turtle-\/>points + 3, vec),}
\DoxyCodeLine{1390                     par\_shapes\_\_dot3(turtle-\/>points + 6, vec)}
\DoxyCodeLine{1391                 \};}
\DoxyCodeLine{1392                 par\_shapes\_\_add3(position, t);}
\DoxyCodeLine{1393             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!strcmp(cmd-\/>cmd, \textcolor{stringliteral}{"{}sx"{}})) \{}
\DoxyCodeLine{1394                 scale[0] *= value;}
\DoxyCodeLine{1395             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!strcmp(cmd-\/>cmd, \textcolor{stringliteral}{"{}sy"{}})) \{}
\DoxyCodeLine{1396                 scale[1] *= value;}
\DoxyCodeLine{1397             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!strcmp(cmd-\/>cmd, \textcolor{stringliteral}{"{}sz"{}})) \{}
\DoxyCodeLine{1398                 scale[2] *= value;}
\DoxyCodeLine{1399             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!strcmp(cmd-\/>cmd, \textcolor{stringliteral}{"{}sa"{}})) \{}
\DoxyCodeLine{1400                 scale[0] *= value;}
\DoxyCodeLine{1401                 scale[1] *= value;}
\DoxyCodeLine{1402                 scale[2] *= value;}
\DoxyCodeLine{1403             \}}
\DoxyCodeLine{1404         \}}
\DoxyCodeLine{1405     \}}
\DoxyCodeLine{1406     PAR\_FREE(stack);}
\DoxyCodeLine{1407     PAR\_FREE(program);}
\DoxyCodeLine{1408     PAR\_FREE(rules);}
\DoxyCodeLine{1409     PAR\_FREE(commands);}
\DoxyCodeLine{1410     \textcolor{keywordflow}{return} scene;}
\DoxyCodeLine{1411 \}}
\DoxyCodeLine{1412 }
\DoxyCodeLine{1413 \textcolor{keywordtype}{void} par\_shapes\_unweld(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh, \textcolor{keywordtype}{bool} create\_indices)}
\DoxyCodeLine{1414 \{}
\DoxyCodeLine{1415     \textcolor{keywordtype}{int} npoints = mesh-\/>ntriangles * 3;}
\DoxyCodeLine{1416     \textcolor{keywordtype}{float}* points = PAR\_MALLOC(\textcolor{keywordtype}{float}, 3 * npoints);}
\DoxyCodeLine{1417     \textcolor{keywordtype}{float}* dst = points;}
\DoxyCodeLine{1418     PAR\_SHAPES\_T \textcolor{keyword}{const}* index = mesh-\/>triangles;}
\DoxyCodeLine{1419     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < npoints; i++) \{}
\DoxyCodeLine{1420         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* src = mesh-\/>points + 3 * (*index++);}
\DoxyCodeLine{1421         *dst++ = src[0];}
\DoxyCodeLine{1422         *dst++ = src[1];}
\DoxyCodeLine{1423         *dst++ = src[2];}
\DoxyCodeLine{1424     \}}
\DoxyCodeLine{1425     PAR\_FREE(mesh-\/>points);}
\DoxyCodeLine{1426     mesh-\/>points = points;}
\DoxyCodeLine{1427     mesh-\/>npoints = npoints;}
\DoxyCodeLine{1428     \textcolor{keywordflow}{if} (create\_indices) \{}
\DoxyCodeLine{1429         PAR\_SHAPES\_T* tris = PAR\_MALLOC(PAR\_SHAPES\_T, 3 * mesh-\/>ntriangles);}
\DoxyCodeLine{1430         PAR\_SHAPES\_T* index = tris;}
\DoxyCodeLine{1431         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mesh-\/>ntriangles * 3; i++) \{}
\DoxyCodeLine{1432             *index++ = i;}
\DoxyCodeLine{1433         \}}
\DoxyCodeLine{1434         PAR\_FREE(mesh-\/>triangles);}
\DoxyCodeLine{1435         mesh-\/>triangles = tris;}
\DoxyCodeLine{1436     \}}
\DoxyCodeLine{1437 \}}
\DoxyCodeLine{1438 }
\DoxyCodeLine{1439 \textcolor{keywordtype}{void} par\_shapes\_compute\_normals(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* m)}
\DoxyCodeLine{1440 \{}
\DoxyCodeLine{1441     PAR\_FREE(m-\/>normals);}
\DoxyCodeLine{1442     m-\/>normals = PAR\_CALLOC(\textcolor{keywordtype}{float}, m-\/>npoints * 3);}
\DoxyCodeLine{1443     PAR\_SHAPES\_T \textcolor{keyword}{const}* triangle = m-\/>triangles;}
\DoxyCodeLine{1444     \textcolor{keywordtype}{float} next[3], prev[3], cp[3];}
\DoxyCodeLine{1445     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} f = 0; f < m-\/>ntriangles; f++, triangle += 3) \{}
\DoxyCodeLine{1446         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* pa = m-\/>points + 3 * triangle[0];}
\DoxyCodeLine{1447         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* pb = m-\/>points + 3 * triangle[1];}
\DoxyCodeLine{1448         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* pc = m-\/>points + 3 * triangle[2];}
\DoxyCodeLine{1449         par\_shapes\_\_copy3(next, pb);}
\DoxyCodeLine{1450         par\_shapes\_\_subtract3(next, pa);}
\DoxyCodeLine{1451         par\_shapes\_\_copy3(prev, pc);}
\DoxyCodeLine{1452         par\_shapes\_\_subtract3(prev, pa);}
\DoxyCodeLine{1453         par\_shapes\_\_cross3(cp, next, prev);}
\DoxyCodeLine{1454         par\_shapes\_\_add3(m-\/>normals + 3 * triangle[0], cp);}
\DoxyCodeLine{1455         par\_shapes\_\_copy3(next, pc);}
\DoxyCodeLine{1456         par\_shapes\_\_subtract3(next, pb);}
\DoxyCodeLine{1457         par\_shapes\_\_copy3(prev, pa);}
\DoxyCodeLine{1458         par\_shapes\_\_subtract3(prev, pb);}
\DoxyCodeLine{1459         par\_shapes\_\_cross3(cp, next, prev);}
\DoxyCodeLine{1460         par\_shapes\_\_add3(m-\/>normals + 3 * triangle[1], cp);}
\DoxyCodeLine{1461         par\_shapes\_\_copy3(next, pa);}
\DoxyCodeLine{1462         par\_shapes\_\_subtract3(next, pc);}
\DoxyCodeLine{1463         par\_shapes\_\_copy3(prev, pb);}
\DoxyCodeLine{1464         par\_shapes\_\_subtract3(prev, pc);}
\DoxyCodeLine{1465         par\_shapes\_\_cross3(cp, next, prev);}
\DoxyCodeLine{1466         par\_shapes\_\_add3(m-\/>normals + 3 * triangle[2], cp);}
\DoxyCodeLine{1467     \}}
\DoxyCodeLine{1468     \textcolor{keywordtype}{float}* normal = m-\/>normals;}
\DoxyCodeLine{1469     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < m-\/>npoints; p++, normal += 3) \{}
\DoxyCodeLine{1470         par\_shapes\_\_normalize3(normal);}
\DoxyCodeLine{1471     \}}
\DoxyCodeLine{1472 \}}
\DoxyCodeLine{1473 }
\DoxyCodeLine{1474 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_subdivide(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh)}
\DoxyCodeLine{1475 \{}
\DoxyCodeLine{1476     assert(mesh-\/>npoints == mesh-\/>ntriangles * 3 \&\& \textcolor{stringliteral}{"{}Must be unwelded."{}});}
\DoxyCodeLine{1477     \textcolor{keywordtype}{int} ntriangles = mesh-\/>ntriangles * 4;}
\DoxyCodeLine{1478     \textcolor{keywordtype}{int} npoints = ntriangles * 3;}
\DoxyCodeLine{1479     \textcolor{keywordtype}{float}* points = PAR\_CALLOC(\textcolor{keywordtype}{float}, npoints * 3);}
\DoxyCodeLine{1480     \textcolor{keywordtype}{float}* dpoint = points;}
\DoxyCodeLine{1481     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* spoint = mesh-\/>points;}
\DoxyCodeLine{1482     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} t = 0; t < mesh-\/>ntriangles; t++, spoint += 9, dpoint += 3) \{}
\DoxyCodeLine{1483         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* a = spoint;}
\DoxyCodeLine{1484         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* b = spoint + 3;}
\DoxyCodeLine{1485         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* c = spoint + 6;}
\DoxyCodeLine{1486         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* p0 = dpoint;}
\DoxyCodeLine{1487         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* p1 = dpoint + 3;}
\DoxyCodeLine{1488         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* p2 = dpoint + 6;}
\DoxyCodeLine{1489         par\_shapes\_\_mix3(dpoint, a, b, 0.5);}
\DoxyCodeLine{1490         par\_shapes\_\_mix3(dpoint += 3, b, c, 0.5);}
\DoxyCodeLine{1491         par\_shapes\_\_mix3(dpoint += 3, a, c, 0.5);}
\DoxyCodeLine{1492         par\_shapes\_\_add3(dpoint += 3, a);}
\DoxyCodeLine{1493         par\_shapes\_\_add3(dpoint += 3, p0);}
\DoxyCodeLine{1494         par\_shapes\_\_add3(dpoint += 3, p2);}
\DoxyCodeLine{1495         par\_shapes\_\_add3(dpoint += 3, p0);}
\DoxyCodeLine{1496         par\_shapes\_\_add3(dpoint += 3, b);}
\DoxyCodeLine{1497         par\_shapes\_\_add3(dpoint += 3, p1);}
\DoxyCodeLine{1498         par\_shapes\_\_add3(dpoint += 3, p2);}
\DoxyCodeLine{1499         par\_shapes\_\_add3(dpoint += 3, p1);}
\DoxyCodeLine{1500         par\_shapes\_\_add3(dpoint += 3, c);}
\DoxyCodeLine{1501     \}}
\DoxyCodeLine{1502     PAR\_FREE(mesh-\/>points);}
\DoxyCodeLine{1503     mesh-\/>points = points;}
\DoxyCodeLine{1504     mesh-\/>npoints = npoints;}
\DoxyCodeLine{1505     mesh-\/>ntriangles = ntriangles;}
\DoxyCodeLine{1506 \}}
\DoxyCodeLine{1507 }
\DoxyCodeLine{1508 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_subdivided\_sphere(\textcolor{keywordtype}{int} nsubd)}
\DoxyCodeLine{1509 \{}
\DoxyCodeLine{1510     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh = par\_shapes\_create\_icosahedron();}
\DoxyCodeLine{1511     par\_shapes\_unweld(mesh, \textcolor{keyword}{false});}
\DoxyCodeLine{1512     PAR\_FREE(mesh-\/>triangles);}
\DoxyCodeLine{1513     mesh-\/>triangles = 0;}
\DoxyCodeLine{1514     \textcolor{keywordflow}{while} (nsubd-\/-\/) \{}
\DoxyCodeLine{1515         par\_shapes\_\_subdivide(mesh);}
\DoxyCodeLine{1516     \}}
\DoxyCodeLine{1517     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mesh-\/>npoints; i++) \{}
\DoxyCodeLine{1518         par\_shapes\_\_normalize3(mesh-\/>points + i * 3);}
\DoxyCodeLine{1519     \}}
\DoxyCodeLine{1520     mesh-\/>triangles = PAR\_MALLOC(PAR\_SHAPES\_T, 3 * mesh-\/>ntriangles);}
\DoxyCodeLine{1521     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mesh-\/>ntriangles * 3; i++) \{}
\DoxyCodeLine{1522         mesh-\/>triangles[i] = i;}
\DoxyCodeLine{1523     \}}
\DoxyCodeLine{1524     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* tmp = mesh;}
\DoxyCodeLine{1525     mesh = par\_shapes\_weld(mesh, 0.01, 0);}
\DoxyCodeLine{1526     par\_shapes\_free\_mesh(tmp);}
\DoxyCodeLine{1527     par\_shapes\_compute\_normals(mesh);}
\DoxyCodeLine{1528     \textcolor{keywordflow}{return} mesh;}
\DoxyCodeLine{1529 \}}
\DoxyCodeLine{1530 }
\DoxyCodeLine{1531 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_create\_rock(\textcolor{keywordtype}{int} seed, \textcolor{keywordtype}{int} subd)}
\DoxyCodeLine{1532 \{}
\DoxyCodeLine{1533     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh = par\_shapes\_create\_subdivided\_sphere(subd);}
\DoxyCodeLine{1534     \textcolor{keyword}{struct }osn\_context* ctx;}
\DoxyCodeLine{1535     par\_\_simplex\_noise(seed, \&ctx);}
\DoxyCodeLine{1536     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < mesh-\/>npoints; p++) \{}
\DoxyCodeLine{1537         \textcolor{keywordtype}{float}* pt = mesh-\/>points + p * 3;}
\DoxyCodeLine{1538         \textcolor{keywordtype}{float} a = 0.25, f = 1.0;}
\DoxyCodeLine{1539         \textcolor{keywordtype}{double} n = a * par\_\_simplex\_noise2(ctx, f * pt[0], f * pt[2]);}
\DoxyCodeLine{1540         a *= 0.5; f *= 2;}
\DoxyCodeLine{1541         n += a * par\_\_simplex\_noise2(ctx, f * pt[0], f * pt[2]);}
\DoxyCodeLine{1542         pt[0] *= 1 + 2 * n;}
\DoxyCodeLine{1543         pt[1] *= 1 + n;}
\DoxyCodeLine{1544         pt[2] *= 1 + 2 * n;}
\DoxyCodeLine{1545         \textcolor{keywordflow}{if} (pt[1] < 0) \{}
\DoxyCodeLine{1546             pt[1] = -\/pow(-\/pt[1], 0.5) / 2;}
\DoxyCodeLine{1547         \}}
\DoxyCodeLine{1548     \}}
\DoxyCodeLine{1549     par\_\_simplex\_noise\_free(ctx);}
\DoxyCodeLine{1550     par\_shapes\_compute\_normals(mesh);}
\DoxyCodeLine{1551     \textcolor{keywordflow}{return} mesh;}
\DoxyCodeLine{1552 \}}
\DoxyCodeLine{1553 }
\DoxyCodeLine{1554 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_clone(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}} \textcolor{keyword}{const}* mesh,}
\DoxyCodeLine{1555     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* clone)}
\DoxyCodeLine{1556 \{}
\DoxyCodeLine{1557     \textcolor{keywordflow}{if} (!clone) \{}
\DoxyCodeLine{1558         clone = PAR\_CALLOC(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}, 1);}
\DoxyCodeLine{1559     \}}
\DoxyCodeLine{1560     clone-\/>npoints = mesh-\/>npoints;}
\DoxyCodeLine{1561     clone-\/>points = PAR\_REALLOC(\textcolor{keywordtype}{float}, clone-\/>points, 3 * clone-\/>npoints);}
\DoxyCodeLine{1562     memcpy(clone-\/>points, mesh-\/>points, \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}) * 3 * clone-\/>npoints);}
\DoxyCodeLine{1563     clone-\/>ntriangles = mesh-\/>ntriangles;}
\DoxyCodeLine{1564     clone-\/>triangles = PAR\_REALLOC(PAR\_SHAPES\_T, clone-\/>triangles, 3 *}
\DoxyCodeLine{1565         clone-\/>ntriangles);}
\DoxyCodeLine{1566     memcpy(clone-\/>triangles, mesh-\/>triangles,}
\DoxyCodeLine{1567         \textcolor{keyword}{sizeof}(PAR\_SHAPES\_T) * 3 * clone-\/>ntriangles);}
\DoxyCodeLine{1568     \textcolor{keywordflow}{if} (mesh-\/>normals) \{}
\DoxyCodeLine{1569         clone-\/>normals = PAR\_REALLOC(\textcolor{keywordtype}{float}, clone-\/>normals, 3 * clone-\/>npoints);}
\DoxyCodeLine{1570         memcpy(clone-\/>normals, mesh-\/>normals,}
\DoxyCodeLine{1571             \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}) * 3 * clone-\/>npoints);}
\DoxyCodeLine{1572     \}}
\DoxyCodeLine{1573     \textcolor{keywordflow}{if} (mesh-\/>tcoords) \{}
\DoxyCodeLine{1574         clone-\/>tcoords = PAR\_REALLOC(\textcolor{keywordtype}{float}, clone-\/>tcoords, 2 * clone-\/>npoints);}
\DoxyCodeLine{1575         memcpy(clone-\/>tcoords, mesh-\/>tcoords,}
\DoxyCodeLine{1576             \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{float}) * 2 * clone-\/>npoints);}
\DoxyCodeLine{1577     \}}
\DoxyCodeLine{1578     \textcolor{keywordflow}{return} clone;}
\DoxyCodeLine{1579 \}}
\DoxyCodeLine{1580 }
\DoxyCodeLine{1581 \textcolor{keyword}{static} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{1582     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* points;}
\DoxyCodeLine{1583     \textcolor{keywordtype}{int} gridsize;}
\DoxyCodeLine{1584 \} par\_shapes\_\_sort\_context;}
\DoxyCodeLine{1585 }
\DoxyCodeLine{1586 \textcolor{keyword}{static} \textcolor{keywordtype}{int} par\_shapes\_\_cmp1(\textcolor{keyword}{const} \textcolor{keywordtype}{void} *arg0, \textcolor{keyword}{const} \textcolor{keywordtype}{void} *arg1)}
\DoxyCodeLine{1587 \{}
\DoxyCodeLine{1588     \textcolor{keyword}{const} \textcolor{keywordtype}{int} g = par\_shapes\_\_sort\_context.gridsize;}
\DoxyCodeLine{1589 }
\DoxyCodeLine{1590     \textcolor{comment}{// Convert arg0 into a flattened grid index.}}
\DoxyCodeLine{1591     PAR\_SHAPES\_T d0 = *(\textcolor{keyword}{const} PAR\_SHAPES\_T*) arg0;}
\DoxyCodeLine{1592     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* p0 = par\_shapes\_\_sort\_context.points + d0 * 3;}
\DoxyCodeLine{1593     \textcolor{keywordtype}{int} i0 = (int) p0[0];}
\DoxyCodeLine{1594     \textcolor{keywordtype}{int} j0 = (int) p0[1];}
\DoxyCodeLine{1595     \textcolor{keywordtype}{int} k0 = (int) p0[2];}
\DoxyCodeLine{1596     \textcolor{keywordtype}{int} index0 = i0 + g * j0 + g * g * k0;}
\DoxyCodeLine{1597 }
\DoxyCodeLine{1598     \textcolor{comment}{// Convert arg1 into a flattened grid index.}}
\DoxyCodeLine{1599     PAR\_SHAPES\_T d1 = *(\textcolor{keyword}{const} PAR\_SHAPES\_T*) arg1;}
\DoxyCodeLine{1600     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* p1 = par\_shapes\_\_sort\_context.points + d1 * 3;}
\DoxyCodeLine{1601     \textcolor{keywordtype}{int} i1 = (int) p1[0];}
\DoxyCodeLine{1602     \textcolor{keywordtype}{int} j1 = (int) p1[1];}
\DoxyCodeLine{1603     \textcolor{keywordtype}{int} k1 = (int) p1[2];}
\DoxyCodeLine{1604     \textcolor{keywordtype}{int} index1 = i1 + g * j1 + g * g * k1;}
\DoxyCodeLine{1605 }
\DoxyCodeLine{1606     \textcolor{comment}{// Return the ordering.}}
\DoxyCodeLine{1607     \textcolor{keywordflow}{if} (index0 < index1) \textcolor{keywordflow}{return} -\/1;}
\DoxyCodeLine{1608     \textcolor{keywordflow}{if} (index0 > index1) \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{1609     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1610 \}}
\DoxyCodeLine{1611 }
\DoxyCodeLine{1612 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_sort\_points(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh, \textcolor{keywordtype}{int} gridsize,}
\DoxyCodeLine{1613     PAR\_SHAPES\_T* sortmap)}
\DoxyCodeLine{1614 \{}
\DoxyCodeLine{1615     \textcolor{comment}{// Run qsort over a list of consecutive integers that get deferenced}}
\DoxyCodeLine{1616     \textcolor{comment}{// within the comparator function; this creates a reorder mapping.}}
\DoxyCodeLine{1617     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mesh-\/>npoints; i++) \{}
\DoxyCodeLine{1618         sortmap[i] = i;}
\DoxyCodeLine{1619     \}}
\DoxyCodeLine{1620     par\_shapes\_\_sort\_context.gridsize = gridsize;}
\DoxyCodeLine{1621     par\_shapes\_\_sort\_context.points = mesh-\/>points;}
\DoxyCodeLine{1622     qsort(sortmap, mesh-\/>npoints, \textcolor{keyword}{sizeof}(PAR\_SHAPES\_T), par\_shapes\_\_cmp1);}
\DoxyCodeLine{1623 }
\DoxyCodeLine{1624     \textcolor{comment}{// Apply the reorder mapping to the XYZ coordinate data.}}
\DoxyCodeLine{1625     \textcolor{keywordtype}{float}* newpts = PAR\_MALLOC(\textcolor{keywordtype}{float}, mesh-\/>npoints * 3);}
\DoxyCodeLine{1626     PAR\_SHAPES\_T* invmap = PAR\_MALLOC(PAR\_SHAPES\_T, mesh-\/>npoints);}
\DoxyCodeLine{1627     \textcolor{keywordtype}{float}* dstpt = newpts;}
\DoxyCodeLine{1628     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mesh-\/>npoints; i++) \{}
\DoxyCodeLine{1629         invmap[sortmap[i]] = i;}
\DoxyCodeLine{1630         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* srcpt = mesh-\/>points + 3 * sortmap[i];}
\DoxyCodeLine{1631         *dstpt++ = *srcpt++;}
\DoxyCodeLine{1632         *dstpt++ = *srcpt++;}
\DoxyCodeLine{1633         *dstpt++ = *srcpt++;}
\DoxyCodeLine{1634     \}}
\DoxyCodeLine{1635     PAR\_FREE(mesh-\/>points);}
\DoxyCodeLine{1636     mesh-\/>points = newpts;}
\DoxyCodeLine{1637 }
\DoxyCodeLine{1638     \textcolor{comment}{// Apply the inverse reorder mapping to the triangle indices.}}
\DoxyCodeLine{1639     PAR\_SHAPES\_T* newinds = PAR\_MALLOC(PAR\_SHAPES\_T, mesh-\/>ntriangles * 3);}
\DoxyCodeLine{1640     PAR\_SHAPES\_T* dstind = newinds;}
\DoxyCodeLine{1641     PAR\_SHAPES\_T \textcolor{keyword}{const}* srcind = mesh-\/>triangles;}
\DoxyCodeLine{1642     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mesh-\/>ntriangles * 3; i++) \{}
\DoxyCodeLine{1643         *dstind++ = invmap[*srcind++];}
\DoxyCodeLine{1644     \}}
\DoxyCodeLine{1645     PAR\_FREE(mesh-\/>triangles);}
\DoxyCodeLine{1646     mesh-\/>triangles = newinds;}
\DoxyCodeLine{1647 }
\DoxyCodeLine{1648     \textcolor{comment}{// Cleanup.}}
\DoxyCodeLine{1649     memcpy(sortmap, invmap, \textcolor{keyword}{sizeof}(PAR\_SHAPES\_T) * mesh-\/>npoints);}
\DoxyCodeLine{1650     PAR\_FREE(invmap);}
\DoxyCodeLine{1651 \}}
\DoxyCodeLine{1652 }
\DoxyCodeLine{1653 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_shapes\_\_weld\_points(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh, \textcolor{keywordtype}{int} gridsize,}
\DoxyCodeLine{1654     \textcolor{keywordtype}{float} epsilon, PAR\_SHAPES\_T* weldmap)}
\DoxyCodeLine{1655 \{}
\DoxyCodeLine{1656     \textcolor{comment}{// Each bin contains a "{}pointer"{} (really an index) to its first point.}}
\DoxyCodeLine{1657     \textcolor{comment}{// We add 1 because 0 is reserved to mean that the bin is empty.}}
\DoxyCodeLine{1658     \textcolor{comment}{// Since the points are spatially sorted, there's no need to store}}
\DoxyCodeLine{1659     \textcolor{comment}{// a point count in each bin.}}
\DoxyCodeLine{1660     PAR\_SHAPES\_T* bins = PAR\_CALLOC(PAR\_SHAPES\_T,}
\DoxyCodeLine{1661         gridsize * gridsize * gridsize);}
\DoxyCodeLine{1662     \textcolor{keywordtype}{int} prev\_binindex = -\/1;}
\DoxyCodeLine{1663     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < mesh-\/>npoints; p++) \{}
\DoxyCodeLine{1664         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* pt = mesh-\/>points + p * 3;}
\DoxyCodeLine{1665         \textcolor{keywordtype}{int} i = (int) pt[0];}
\DoxyCodeLine{1666         \textcolor{keywordtype}{int} j = (int) pt[1];}
\DoxyCodeLine{1667         \textcolor{keywordtype}{int} k = (int) pt[2];}
\DoxyCodeLine{1668         \textcolor{keywordtype}{int} this\_binindex = i + gridsize * j + gridsize * gridsize * k;}
\DoxyCodeLine{1669         \textcolor{keywordflow}{if} (this\_binindex != prev\_binindex) \{}
\DoxyCodeLine{1670             bins[this\_binindex] = 1 + p;}
\DoxyCodeLine{1671         \}}
\DoxyCodeLine{1672         prev\_binindex = this\_binindex;}
\DoxyCodeLine{1673     \}}
\DoxyCodeLine{1674 }
\DoxyCodeLine{1675     \textcolor{comment}{// Examine all bins that intersect the epsilon-\/sized cube centered at each}}
\DoxyCodeLine{1676     \textcolor{comment}{// point, and check for colocated points within those bins.}}
\DoxyCodeLine{1677     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* pt = mesh-\/>points;}
\DoxyCodeLine{1678     \textcolor{keywordtype}{int} nremoved = 0;}
\DoxyCodeLine{1679     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < mesh-\/>npoints; p++, pt += 3) \{}
\DoxyCodeLine{1680 }
\DoxyCodeLine{1681         \textcolor{comment}{// Skip if this point has already been welded.}}
\DoxyCodeLine{1682         \textcolor{keywordflow}{if} (weldmap[p] != p) \{}
\DoxyCodeLine{1683             \textcolor{keywordflow}{continue};}
\DoxyCodeLine{1684         \}}
\DoxyCodeLine{1685 }
\DoxyCodeLine{1686         \textcolor{comment}{// Build a list of bins that intersect the epsilon-\/sized cube.}}
\DoxyCodeLine{1687         \textcolor{keywordtype}{int} nearby[8];}
\DoxyCodeLine{1688         \textcolor{keywordtype}{int} nbins = 0;}
\DoxyCodeLine{1689         \textcolor{keywordtype}{int} minp[3], maxp[3];}
\DoxyCodeLine{1690         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} c = 0; c < 3; c++) \{}
\DoxyCodeLine{1691             minp[c] = (int) (pt[c] -\/ epsilon);}
\DoxyCodeLine{1692             maxp[c] = (int) (pt[c] + epsilon);}
\DoxyCodeLine{1693         \}}
\DoxyCodeLine{1694         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = minp[0]; i <= maxp[0]; i++) \{}
\DoxyCodeLine{1695             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} j = minp[1]; j <= maxp[1]; j++) \{}
\DoxyCodeLine{1696                 \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} k = minp[2]; k <= maxp[2]; k++) \{}
\DoxyCodeLine{1697                     \textcolor{keywordtype}{int} binindex = i + gridsize * j + gridsize * gridsize * k;}
\DoxyCodeLine{1698                     PAR\_SHAPES\_T binvalue = *(bins + binindex);}
\DoxyCodeLine{1699                     \textcolor{keywordflow}{if} (binvalue > 0) \{}
\DoxyCodeLine{1700                         \textcolor{keywordflow}{if} (nbins == 8) \{}
\DoxyCodeLine{1701                             printf(\textcolor{stringliteral}{"{}Epsilon value is too large.\(\backslash\)n"{}});}
\DoxyCodeLine{1702                             \textcolor{keywordflow}{break};}
\DoxyCodeLine{1703                         \}}
\DoxyCodeLine{1704                         nearby[nbins++] = binindex;}
\DoxyCodeLine{1705                     \}}
\DoxyCodeLine{1706                 \}}
\DoxyCodeLine{1707             \}}
\DoxyCodeLine{1708         \}}
\DoxyCodeLine{1709 }
\DoxyCodeLine{1710         \textcolor{comment}{// Check for colocated points in each nearby bin.}}
\DoxyCodeLine{1711         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} b = 0; b < nbins; b++) \{}
\DoxyCodeLine{1712             \textcolor{keywordtype}{int} binindex = nearby[b];}
\DoxyCodeLine{1713             PAR\_SHAPES\_T binvalue = bins[binindex];}
\DoxyCodeLine{1714             PAR\_SHAPES\_T nindex = binvalue -\/ 1;}
\DoxyCodeLine{1715             assert(nindex < mesh-\/>npoints);}
\DoxyCodeLine{1716             \textcolor{keywordflow}{while} (\textcolor{keyword}{true}) \{}
\DoxyCodeLine{1717 }
\DoxyCodeLine{1718                 \textcolor{comment}{// If this isn't "{}self"{} and it's colocated, then weld it!}}
\DoxyCodeLine{1719                 \textcolor{keywordflow}{if} (nindex != p \&\& weldmap[nindex] == nindex) \{}
\DoxyCodeLine{1720                     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* thatpt = mesh-\/>points + nindex * 3;}
\DoxyCodeLine{1721                     \textcolor{keywordtype}{float} dist2 = par\_shapes\_\_sqrdist3(thatpt, pt);}
\DoxyCodeLine{1722                     \textcolor{keywordflow}{if} (dist2 < epsilon) \{}
\DoxyCodeLine{1723                         weldmap[nindex] = p;}
\DoxyCodeLine{1724                         nremoved++;}
\DoxyCodeLine{1725                     \}}
\DoxyCodeLine{1726                 \}}
\DoxyCodeLine{1727 }
\DoxyCodeLine{1728                 \textcolor{comment}{// Advance to the next point if possible.}}
\DoxyCodeLine{1729                 \textcolor{keywordflow}{if} (++nindex >= mesh-\/>npoints) \{}
\DoxyCodeLine{1730                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{1731                 \}}
\DoxyCodeLine{1732 }
\DoxyCodeLine{1733                 \textcolor{comment}{// If the next point is outside the bin, then we're done.}}
\DoxyCodeLine{1734                 \textcolor{keywordtype}{float} \textcolor{keyword}{const}* nextpt = mesh-\/>points + nindex * 3;}
\DoxyCodeLine{1735                 \textcolor{keywordtype}{int} i = (int) nextpt[0];}
\DoxyCodeLine{1736                 \textcolor{keywordtype}{int} j = (int) nextpt[1];}
\DoxyCodeLine{1737                 \textcolor{keywordtype}{int} k = (int) nextpt[2];}
\DoxyCodeLine{1738                 \textcolor{keywordtype}{int} nextbinindex = i + gridsize * j + gridsize * gridsize * k;}
\DoxyCodeLine{1739                 \textcolor{keywordflow}{if} (nextbinindex != binindex) \{}
\DoxyCodeLine{1740                     \textcolor{keywordflow}{break};}
\DoxyCodeLine{1741                 \}}
\DoxyCodeLine{1742             \}}
\DoxyCodeLine{1743         \}}
\DoxyCodeLine{1744     \}}
\DoxyCodeLine{1745     PAR\_FREE(bins);}
\DoxyCodeLine{1746 }
\DoxyCodeLine{1747     \textcolor{comment}{// Apply the weldmap to the vertices.}}
\DoxyCodeLine{1748     \textcolor{keywordtype}{int} npoints = mesh-\/>npoints -\/ nremoved;}
\DoxyCodeLine{1749     \textcolor{keywordtype}{float}* newpts = PAR\_MALLOC(\textcolor{keywordtype}{float}, 3 * npoints);}
\DoxyCodeLine{1750     \textcolor{keywordtype}{float}* dst = newpts;}
\DoxyCodeLine{1751     PAR\_SHAPES\_T* condensed\_map = PAR\_MALLOC(PAR\_SHAPES\_T, mesh-\/>npoints);}
\DoxyCodeLine{1752     PAR\_SHAPES\_T* cmap = condensed\_map;}
\DoxyCodeLine{1753     \textcolor{keywordtype}{float} \textcolor{keyword}{const}* src = mesh-\/>points;}
\DoxyCodeLine{1754     \textcolor{keywordtype}{int} ci = 0;}
\DoxyCodeLine{1755     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} p = 0; p < mesh-\/>npoints; p++, src += 3) \{}
\DoxyCodeLine{1756         \textcolor{keywordflow}{if} (weldmap[p] == p) \{}
\DoxyCodeLine{1757             *dst++ = src[0];}
\DoxyCodeLine{1758             *dst++ = src[1];}
\DoxyCodeLine{1759             *dst++ = src[2];}
\DoxyCodeLine{1760             *cmap++ = ci++;}
\DoxyCodeLine{1761         \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1762             *cmap++ = condensed\_map[weldmap[p]];}
\DoxyCodeLine{1763         \}}
\DoxyCodeLine{1764     \}}
\DoxyCodeLine{1765     assert(ci == npoints);}
\DoxyCodeLine{1766     PAR\_FREE(mesh-\/>points);}
\DoxyCodeLine{1767     memcpy(weldmap, condensed\_map, mesh-\/>npoints * \textcolor{keyword}{sizeof}(PAR\_SHAPES\_T));}
\DoxyCodeLine{1768     PAR\_FREE(condensed\_map);}
\DoxyCodeLine{1769     mesh-\/>points = newpts;}
\DoxyCodeLine{1770     mesh-\/>npoints = npoints;}
\DoxyCodeLine{1771 }
\DoxyCodeLine{1772     \textcolor{comment}{// Apply the weldmap to the triangle indices and skip the degenerates.}}
\DoxyCodeLine{1773     PAR\_SHAPES\_T \textcolor{keyword}{const}* tsrc = mesh-\/>triangles;}
\DoxyCodeLine{1774     PAR\_SHAPES\_T* tdst = mesh-\/>triangles;}
\DoxyCodeLine{1775     \textcolor{keywordtype}{int} ntriangles = 0;}
\DoxyCodeLine{1776     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mesh-\/>ntriangles; i++, tsrc += 3) \{}
\DoxyCodeLine{1777         PAR\_SHAPES\_T a = weldmap[tsrc[0]];}
\DoxyCodeLine{1778         PAR\_SHAPES\_T b = weldmap[tsrc[1]];}
\DoxyCodeLine{1779         PAR\_SHAPES\_T c = weldmap[tsrc[2]];}
\DoxyCodeLine{1780         \textcolor{keywordflow}{if} (a != b \&\& a != c \&\& b != c) \{}
\DoxyCodeLine{1781             assert(a < mesh-\/>npoints);}
\DoxyCodeLine{1782             assert(b < mesh-\/>npoints);}
\DoxyCodeLine{1783             assert(c < mesh-\/>npoints);}
\DoxyCodeLine{1784             *tdst++ = a;}
\DoxyCodeLine{1785             *tdst++ = b;}
\DoxyCodeLine{1786             *tdst++ = c;}
\DoxyCodeLine{1787             ntriangles++;}
\DoxyCodeLine{1788         \}}
\DoxyCodeLine{1789     \}}
\DoxyCodeLine{1790     mesh-\/>ntriangles = ntriangles;}
\DoxyCodeLine{1791 \}}
\DoxyCodeLine{1792 }
\DoxyCodeLine{1793 \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* par\_shapes\_weld(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}} \textcolor{keyword}{const}* mesh, \textcolor{keywordtype}{float} epsilon,}
\DoxyCodeLine{1794     PAR\_SHAPES\_T* weldmap)}
\DoxyCodeLine{1795 \{}
\DoxyCodeLine{1796     \mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* clone = par\_shapes\_clone(mesh, 0);}
\DoxyCodeLine{1797     \textcolor{keywordtype}{float} aabb[6];}
\DoxyCodeLine{1798     \textcolor{keywordtype}{int} gridsize = 20;}
\DoxyCodeLine{1799     \textcolor{keywordtype}{float} maxcell = gridsize -\/ 1;}
\DoxyCodeLine{1800     par\_shapes\_compute\_aabb(clone, aabb);}
\DoxyCodeLine{1801     \textcolor{keywordtype}{float} scale[3] = \{}
\DoxyCodeLine{1802         aabb[3] == aabb[0] ? 1.0f : maxcell / (aabb[3] -\/ aabb[0]),}
\DoxyCodeLine{1803         aabb[4] == aabb[1] ? 1.0f : maxcell / (aabb[4] -\/ aabb[1]),}
\DoxyCodeLine{1804         aabb[5] == aabb[2] ? 1.0f : maxcell / (aabb[5] -\/ aabb[2]),}
\DoxyCodeLine{1805     \};}
\DoxyCodeLine{1806     par\_shapes\_translate(clone, -\/aabb[0], -\/aabb[1], -\/aabb[2]);}
\DoxyCodeLine{1807     par\_shapes\_scale(clone, scale[0], scale[1], scale[2]);}
\DoxyCodeLine{1808     PAR\_SHAPES\_T* sortmap = PAR\_MALLOC(PAR\_SHAPES\_T, mesh-\/>npoints);}
\DoxyCodeLine{1809     par\_shapes\_\_sort\_points(clone, gridsize, sortmap);}
\DoxyCodeLine{1810     \textcolor{keywordtype}{bool} owner = \textcolor{keyword}{false};}
\DoxyCodeLine{1811     \textcolor{keywordflow}{if} (!weldmap) \{}
\DoxyCodeLine{1812         owner = \textcolor{keyword}{true};}
\DoxyCodeLine{1813         weldmap = PAR\_MALLOC(PAR\_SHAPES\_T, mesh-\/>npoints);}
\DoxyCodeLine{1814     \}}
\DoxyCodeLine{1815     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mesh-\/>npoints; i++) \{}
\DoxyCodeLine{1816         weldmap[i] = i;}
\DoxyCodeLine{1817     \}}
\DoxyCodeLine{1818     par\_shapes\_\_weld\_points(clone, gridsize, epsilon, weldmap);}
\DoxyCodeLine{1819     \textcolor{keywordflow}{if} (owner) \{}
\DoxyCodeLine{1820         PAR\_FREE(weldmap);}
\DoxyCodeLine{1821     \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{1822         PAR\_SHAPES\_T* newmap = PAR\_MALLOC(PAR\_SHAPES\_T, mesh-\/>npoints);}
\DoxyCodeLine{1823         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < mesh-\/>npoints; i++) \{}
\DoxyCodeLine{1824             newmap[i] = weldmap[sortmap[i]];}
\DoxyCodeLine{1825         \}}
\DoxyCodeLine{1826         memcpy(weldmap, newmap, \textcolor{keyword}{sizeof}(PAR\_SHAPES\_T) * mesh-\/>npoints);}
\DoxyCodeLine{1827         PAR\_FREE(newmap);}
\DoxyCodeLine{1828     \}}
\DoxyCodeLine{1829     PAR\_FREE(sortmap);}
\DoxyCodeLine{1830     par\_shapes\_scale(clone, 1.0 / scale[0], 1.0 / scale[1], 1.0 / scale[2]);}
\DoxyCodeLine{1831     par\_shapes\_translate(clone, aabb[0], aabb[1], aabb[2]);}
\DoxyCodeLine{1832     \textcolor{keywordflow}{return} clone;}
\DoxyCodeLine{1833 \}}
\DoxyCodeLine{1834 }
\DoxyCodeLine{1835 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{1836 \textcolor{comment}{// BEGIN OPEN SIMPLEX NOISE}}
\DoxyCodeLine{1837 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{1838 }
\DoxyCodeLine{1839 \textcolor{preprocessor}{\#define STRETCH\_CONSTANT\_2D (-\/0.211324865405187)  }\textcolor{comment}{// (1 / sqrt(2 + 1) -\/ 1 ) / 2;}}
\DoxyCodeLine{1840 \textcolor{preprocessor}{\#define SQUISH\_CONSTANT\_2D (0.366025403784439)  }\textcolor{comment}{// (sqrt(2 + 1) -\/1) / 2;}}
\DoxyCodeLine{1841 \textcolor{preprocessor}{\#define STRETCH\_CONSTANT\_3D (-\/1.0 / 6.0)  }\textcolor{comment}{// (1 / sqrt(3 + 1) -\/ 1) / 3;}}
\DoxyCodeLine{1842 \textcolor{preprocessor}{\#define SQUISH\_CONSTANT\_3D (1.0 / 3.0)  }\textcolor{comment}{// (sqrt(3+1)-\/1)/3;}}
\DoxyCodeLine{1843 \textcolor{preprocessor}{\#define STRETCH\_CONSTANT\_4D (-\/0.138196601125011)  }\textcolor{comment}{// (1 / sqrt(4 + 1) -\/ 1) / 4;}}
\DoxyCodeLine{1844 \textcolor{preprocessor}{\#define SQUISH\_CONSTANT\_4D (0.309016994374947)  }\textcolor{comment}{// (sqrt(4 + 1) -\/ 1) / 4;}}
\DoxyCodeLine{1845 }
\DoxyCodeLine{1846 \textcolor{preprocessor}{\#define NORM\_CONSTANT\_2D (47.0)}}
\DoxyCodeLine{1847 \textcolor{preprocessor}{\#define NORM\_CONSTANT\_3D (103.0)}}
\DoxyCodeLine{1848 \textcolor{preprocessor}{\#define NORM\_CONSTANT\_4D (30.0)}}
\DoxyCodeLine{1849 }
\DoxyCodeLine{1850 \textcolor{preprocessor}{\#define DEFAULT\_SEED (0LL)}}
\DoxyCodeLine{1851 }
\DoxyCodeLine{1852 \textcolor{keyword}{struct }osn\_context \{}
\DoxyCodeLine{1853     int16\_t* perm;}
\DoxyCodeLine{1854     int16\_t* permGradIndex3D;}
\DoxyCodeLine{1855 \};}
\DoxyCodeLine{1856 }
\DoxyCodeLine{1857 \textcolor{preprocessor}{\#define ARRAYSIZE(x) (sizeof((x)) / sizeof((x)[0]))}}
\DoxyCodeLine{1858 }
\DoxyCodeLine{1859 \textcolor{comment}{/*}}
\DoxyCodeLine{1860 \textcolor{comment}{ * Gradients for 2D. They approximate the directions to the}}
\DoxyCodeLine{1861 \textcolor{comment}{ * vertices of an octagon from the center.}}
\DoxyCodeLine{1862 \textcolor{comment}{ */}}
\DoxyCodeLine{1863 \textcolor{keyword}{static} \textcolor{keyword}{const} int8\_t gradients2D[] = \{}
\DoxyCodeLine{1864     5, 2, 2, 5, -\/5, 2, -\/2, 5, 5, -\/2, 2, -\/5, -\/5, -\/2, -\/2, -\/5,}
\DoxyCodeLine{1865 \};}
\DoxyCodeLine{1866 }
\DoxyCodeLine{1867 \textcolor{comment}{/*}}
\DoxyCodeLine{1868 \textcolor{comment}{ * Gradients for 3D. They approximate the directions to the}}
\DoxyCodeLine{1869 \textcolor{comment}{ * vertices of a rhombicuboctahedron from the center, skewed so}}
\DoxyCodeLine{1870 \textcolor{comment}{ * that the triangular and square facets can be inscribed inside}}
\DoxyCodeLine{1871 \textcolor{comment}{ * circles of the same radius.}}
\DoxyCodeLine{1872 \textcolor{comment}{ */}}
\DoxyCodeLine{1873 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{signed} \textcolor{keywordtype}{char} gradients3D[] = \{}
\DoxyCodeLine{1874     -\/11, 4, 4, -\/4, 11, 4, -\/4, 4, 11, 11, 4, 4, 4, 11, 4, 4, 4, 11, -\/11, -\/4, 4,}
\DoxyCodeLine{1875     -\/4, -\/11, 4, -\/4, -\/4, 11, 11, -\/4, 4, 4, -\/11, 4, 4, -\/4, 11, -\/11, 4, -\/4, -\/4, 11,}
\DoxyCodeLine{1876     -\/4, -\/4, 4, -\/11, 11, 4, -\/4, 4, 11, -\/4, 4, 4, -\/11, -\/11, -\/4, -\/4, -\/4, -\/11, -\/4,}
\DoxyCodeLine{1877     -\/4, -\/4, -\/11, 11, -\/4, -\/4, 4, -\/11, -\/4, 4, -\/4, -\/11,}
\DoxyCodeLine{1878 \};}
\DoxyCodeLine{1879 }
\DoxyCodeLine{1880 \textcolor{comment}{/*}}
\DoxyCodeLine{1881 \textcolor{comment}{ * Gradients for 4D. They approximate the directions to the}}
\DoxyCodeLine{1882 \textcolor{comment}{ * vertices of a disprismatotesseractihexadecachoron from the center,}}
\DoxyCodeLine{1883 \textcolor{comment}{ * skewed so that the tetrahedral and cubic facets can be inscribed inside}}
\DoxyCodeLine{1884 \textcolor{comment}{ * spheres of the same radius.}}
\DoxyCodeLine{1885 \textcolor{comment}{ */}}
\DoxyCodeLine{1886 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{signed} \textcolor{keywordtype}{char} gradients4D[] = \{}
\DoxyCodeLine{1887     3, 1, 1, 1, 1, 3, 1, 1, 1, 1, 3, 1, 1, 1, 1, 3, -\/3, 1, 1, 1, -\/1, 3, 1, 1,}
\DoxyCodeLine{1888     -\/1, 1, 3, 1, -\/1, 1, 1, 3, 3, -\/1, 1, 1, 1, -\/3, 1, 1, 1, -\/1, 3, 1, 1, -\/1, 1,}
\DoxyCodeLine{1889     3, -\/3, -\/1, 1, 1, -\/1, -\/3, 1, 1, -\/1, -\/1, 3, 1, -\/1, -\/1, 1, 3, 3, 1, -\/1, 1, 1,}
\DoxyCodeLine{1890     3, -\/1, 1, 1, 1, -\/3, 1, 1, 1, -\/1, 3, -\/3, 1, -\/1, 1, -\/1, 3, -\/1, 1, -\/1, 1, -\/3,}
\DoxyCodeLine{1891     1, -\/1, 1, -\/1, 3, 3, -\/1, -\/1, 1, 1, -\/3, -\/1, 1, 1, -\/1, -\/3, 1, 1, -\/1, -\/1, 3, -\/3,}
\DoxyCodeLine{1892     -\/1, -\/1, 1, -\/1, -\/3, -\/1, 1, -\/1, -\/1, -\/3, 1, -\/1, -\/1, -\/1, 3, 3, 1, 1, -\/1, 1, 3,}
\DoxyCodeLine{1893     1, -\/1, 1, 1, 3, -\/1, 1, 1, 1, -\/3, -\/3, 1, 1, -\/1, -\/1, 3, 1, -\/1, -\/1, 1, 3, -\/1,}
\DoxyCodeLine{1894     -\/1, 1, 1, -\/3, 3, -\/1, 1, -\/1, 1, -\/3, 1, -\/1, 1, -\/1, 3, -\/1, 1, -\/1, 1, -\/3, -\/3,}
\DoxyCodeLine{1895     -\/1, 1, -\/1, -\/1, -\/3, 1, -\/1, -\/1, -\/1, 3, -\/1, -\/1, -\/1, 1, -\/3, 3, 1, -\/1, -\/1, 1, 3,}
\DoxyCodeLine{1896     -\/1, -\/1, 1, 1, -\/3, -\/1, 1, 1, -\/1, -\/3, -\/3, 1, -\/1, -\/1, -\/1, 3, -\/1, -\/1, -\/1, 1, -\/3,}
\DoxyCodeLine{1897     -\/1, -\/1, 1, -\/1, -\/3, 3, -\/1, -\/1, -\/1, 1, -\/3, -\/1, -\/1, 1, -\/1, -\/3, -\/1, 1, -\/1, -\/1,}
\DoxyCodeLine{1898     -\/3, -\/3, -\/1, -\/1, -\/1, -\/1, -\/3, -\/1, -\/1, -\/1, -\/1, -\/3, -\/1, -\/1, -\/1, -\/1, -\/3,}
\DoxyCodeLine{1899 \};}
\DoxyCodeLine{1900 }
\DoxyCodeLine{1901 \textcolor{keyword}{static} \textcolor{keywordtype}{double} extrapolate2(}
\DoxyCodeLine{1902     \textcolor{keyword}{struct} osn\_context* ctx, \textcolor{keywordtype}{int} xsb, \textcolor{keywordtype}{int} ysb, \textcolor{keywordtype}{double} dx, \textcolor{keywordtype}{double} dy)}
\DoxyCodeLine{1903 \{}
\DoxyCodeLine{1904     int16\_t* perm = ctx-\/>perm;}
\DoxyCodeLine{1905     \textcolor{keywordtype}{int} index = perm[(perm[xsb \& 0xFF] + ysb) \& 0xFF] \& 0x0E;}
\DoxyCodeLine{1906     \textcolor{keywordflow}{return} gradients2D[index] * dx + gradients2D[index + 1] * dy;}
\DoxyCodeLine{1907 \}}
\DoxyCodeLine{1908 }
\DoxyCodeLine{1909 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{int} fastFloor(\textcolor{keywordtype}{double} x)}
\DoxyCodeLine{1910 \{}
\DoxyCodeLine{1911     \textcolor{keywordtype}{int} xi = (int) x;}
\DoxyCodeLine{1912     \textcolor{keywordflow}{return} x < xi ? xi -\/ 1 : xi;}
\DoxyCodeLine{1913 \}}
\DoxyCodeLine{1914 }
\DoxyCodeLine{1915 \textcolor{keyword}{static} \textcolor{keywordtype}{int} allocate\_perm(\textcolor{keyword}{struct} osn\_context* ctx, \textcolor{keywordtype}{int} nperm, \textcolor{keywordtype}{int} ngrad)}
\DoxyCodeLine{1916 \{}
\DoxyCodeLine{1917     PAR\_FREE(ctx-\/>perm);}
\DoxyCodeLine{1918     PAR\_FREE(ctx-\/>permGradIndex3D);}
\DoxyCodeLine{1919     ctx-\/>perm = PAR\_MALLOC(int16\_t, nperm);}
\DoxyCodeLine{1920     \textcolor{keywordflow}{if} (!ctx-\/>perm) \{}
\DoxyCodeLine{1921         \textcolor{keywordflow}{return} -\/ENOMEM;}
\DoxyCodeLine{1922     \}}
\DoxyCodeLine{1923     ctx-\/>permGradIndex3D = PAR\_MALLOC(int16\_t, ngrad);}
\DoxyCodeLine{1924     \textcolor{keywordflow}{if} (!ctx-\/>permGradIndex3D) \{}
\DoxyCodeLine{1925         PAR\_FREE(ctx-\/>perm);}
\DoxyCodeLine{1926         \textcolor{keywordflow}{return} -\/ENOMEM;}
\DoxyCodeLine{1927     \}}
\DoxyCodeLine{1928     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1929 \}}
\DoxyCodeLine{1930 }
\DoxyCodeLine{1931 \textcolor{keyword}{static} \textcolor{keywordtype}{int} par\_\_simplex\_noise(int64\_t seed, \textcolor{keyword}{struct} osn\_context** ctx)}
\DoxyCodeLine{1932 \{}
\DoxyCodeLine{1933     \textcolor{keywordtype}{int} rc;}
\DoxyCodeLine{1934     int16\_t source[256];}
\DoxyCodeLine{1935     \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{1936     int16\_t* perm;}
\DoxyCodeLine{1937     int16\_t* permGradIndex3D;}
\DoxyCodeLine{1938     *ctx = PAR\_MALLOC(\textcolor{keyword}{struct} osn\_context, 1);}
\DoxyCodeLine{1939     \textcolor{keywordflow}{if} (!(*ctx)) \{}
\DoxyCodeLine{1940         \textcolor{keywordflow}{return} -\/ENOMEM;}
\DoxyCodeLine{1941     \}}
\DoxyCodeLine{1942     (*ctx)-\/>perm = NULL;}
\DoxyCodeLine{1943     (*ctx)-\/>permGradIndex3D = NULL;}
\DoxyCodeLine{1944     rc = allocate\_perm(*ctx, 256, 256);}
\DoxyCodeLine{1945     \textcolor{keywordflow}{if} (rc) \{}
\DoxyCodeLine{1946         PAR\_FREE(*ctx);}
\DoxyCodeLine{1947         \textcolor{keywordflow}{return} rc;}
\DoxyCodeLine{1948     \}}
\DoxyCodeLine{1949     perm = (*ctx)-\/>perm;}
\DoxyCodeLine{1950     permGradIndex3D = (*ctx)-\/>permGradIndex3D;}
\DoxyCodeLine{1951     \textcolor{keywordflow}{for} (i = 0; i < 256; i++) \{}
\DoxyCodeLine{1952         source[i] = (int16\_t) i;}
\DoxyCodeLine{1953     \}}
\DoxyCodeLine{1954     seed = seed * 6364136223846793005LL + 1442695040888963407LL;}
\DoxyCodeLine{1955     seed = seed * 6364136223846793005LL + 1442695040888963407LL;}
\DoxyCodeLine{1956     seed = seed * 6364136223846793005LL + 1442695040888963407LL;}
\DoxyCodeLine{1957     \textcolor{keywordflow}{for} (i = 255; i >= 0; i-\/-\/) \{}
\DoxyCodeLine{1958         seed = seed * 6364136223846793005LL + 1442695040888963407LL;}
\DoxyCodeLine{1959         \textcolor{keywordtype}{int} r = (int) ((seed + 31) \% (i + 1));}
\DoxyCodeLine{1960         \textcolor{keywordflow}{if} (r < 0)}
\DoxyCodeLine{1961             r += (i + 1);}
\DoxyCodeLine{1962         perm[i] = source[r];}
\DoxyCodeLine{1963         permGradIndex3D[i] =}
\DoxyCodeLine{1964             (short) ((perm[i] \% (ARRAYSIZE(gradients3D) / 3)) * 3);}
\DoxyCodeLine{1965         source[r] = source[i];}
\DoxyCodeLine{1966     \}}
\DoxyCodeLine{1967     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1968 \}}
\DoxyCodeLine{1969 }
\DoxyCodeLine{1970 \textcolor{keyword}{static} \textcolor{keywordtype}{void} par\_\_simplex\_noise\_free(\textcolor{keyword}{struct} osn\_context* ctx)}
\DoxyCodeLine{1971 \{}
\DoxyCodeLine{1972     \textcolor{keywordflow}{if} (!ctx)}
\DoxyCodeLine{1973         \textcolor{keywordflow}{return};}
\DoxyCodeLine{1974     \textcolor{keywordflow}{if} (ctx-\/>perm) \{}
\DoxyCodeLine{1975         PAR\_FREE(ctx-\/>perm);}
\DoxyCodeLine{1976         ctx-\/>perm = NULL;}
\DoxyCodeLine{1977     \}}
\DoxyCodeLine{1978     \textcolor{keywordflow}{if} (ctx-\/>permGradIndex3D) \{}
\DoxyCodeLine{1979         PAR\_FREE(ctx-\/>permGradIndex3D);}
\DoxyCodeLine{1980         ctx-\/>permGradIndex3D = NULL;}
\DoxyCodeLine{1981     \}}
\DoxyCodeLine{1982     PAR\_FREE(ctx);}
\DoxyCodeLine{1983 \}}
\DoxyCodeLine{1984 }
\DoxyCodeLine{1985 \textcolor{keyword}{static} \textcolor{keywordtype}{double} par\_\_simplex\_noise2(\textcolor{keyword}{struct} osn\_context* ctx, \textcolor{keywordtype}{double} x, \textcolor{keywordtype}{double} y)}
\DoxyCodeLine{1986 \{}
\DoxyCodeLine{1987     \textcolor{comment}{// Place input coordinates onto grid.}}
\DoxyCodeLine{1988     \textcolor{keywordtype}{double} stretchOffset = (x + y) * STRETCH\_CONSTANT\_2D;}
\DoxyCodeLine{1989     \textcolor{keywordtype}{double} xs = x + stretchOffset;}
\DoxyCodeLine{1990     \textcolor{keywordtype}{double} ys = y + stretchOffset;}
\DoxyCodeLine{1991 }
\DoxyCodeLine{1992     \textcolor{comment}{// Floor to get grid coordinates of rhombus (stretched square) super-\/cell}}
\DoxyCodeLine{1993     \textcolor{comment}{// origin.}}
\DoxyCodeLine{1994     \textcolor{keywordtype}{int} xsb = fastFloor(xs);}
\DoxyCodeLine{1995     \textcolor{keywordtype}{int} ysb = fastFloor(ys);}
\DoxyCodeLine{1996 }
\DoxyCodeLine{1997     \textcolor{comment}{// Skew out to get actual coordinates of rhombus origin. We'll need these}}
\DoxyCodeLine{1998     \textcolor{comment}{// later.}}
\DoxyCodeLine{1999     \textcolor{keywordtype}{double} squishOffset = (xsb + ysb) * SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2000     \textcolor{keywordtype}{double} xb = xsb + squishOffset;}
\DoxyCodeLine{2001     \textcolor{keywordtype}{double} yb = ysb + squishOffset;}
\DoxyCodeLine{2002 }
\DoxyCodeLine{2003     \textcolor{comment}{// Compute grid coordinates relative to rhombus origin.}}
\DoxyCodeLine{2004     \textcolor{keywordtype}{double} xins = xs -\/ xsb;}
\DoxyCodeLine{2005     \textcolor{keywordtype}{double} yins = ys -\/ ysb;}
\DoxyCodeLine{2006 }
\DoxyCodeLine{2007     \textcolor{comment}{// Sum those together to get a value that determines which region we're in.}}
\DoxyCodeLine{2008     \textcolor{keywordtype}{double} inSum = xins + yins;}
\DoxyCodeLine{2009 }
\DoxyCodeLine{2010     \textcolor{comment}{// Positions relative to origin point.}}
\DoxyCodeLine{2011     \textcolor{keywordtype}{double} dx0 = x -\/ xb;}
\DoxyCodeLine{2012     \textcolor{keywordtype}{double} dy0 = y -\/ yb;}
\DoxyCodeLine{2013 }
\DoxyCodeLine{2014     \textcolor{comment}{// We'll be defining these inside the next block and using them afterwards.}}
\DoxyCodeLine{2015     \textcolor{keywordtype}{double} dx\_ext, dy\_ext;}
\DoxyCodeLine{2016     \textcolor{keywordtype}{int} xsv\_ext, ysv\_ext;}
\DoxyCodeLine{2017 }
\DoxyCodeLine{2018     \textcolor{keywordtype}{double} value = 0;}
\DoxyCodeLine{2019 }
\DoxyCodeLine{2020     \textcolor{comment}{// Contribution (1,0)}}
\DoxyCodeLine{2021     \textcolor{keywordtype}{double} dx1 = dx0 -\/ 1 -\/ SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2022     \textcolor{keywordtype}{double} dy1 = dy0 -\/ 0 -\/ SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2023     \textcolor{keywordtype}{double} attn1 = 2 -\/ dx1 * dx1 -\/ dy1 * dy1;}
\DoxyCodeLine{2024     \textcolor{keywordflow}{if} (attn1 > 0) \{}
\DoxyCodeLine{2025         attn1 *= attn1;}
\DoxyCodeLine{2026         value += attn1 * attn1 * extrapolate2(ctx, xsb + 1, ysb + 0, dx1, dy1);}
\DoxyCodeLine{2027     \}}
\DoxyCodeLine{2028 }
\DoxyCodeLine{2029     \textcolor{comment}{// Contribution (0,1)}}
\DoxyCodeLine{2030     \textcolor{keywordtype}{double} dx2 = dx0 -\/ 0 -\/ SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2031     \textcolor{keywordtype}{double} dy2 = dy0 -\/ 1 -\/ SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2032     \textcolor{keywordtype}{double} attn2 = 2 -\/ dx2 * dx2 -\/ dy2 * dy2;}
\DoxyCodeLine{2033     \textcolor{keywordflow}{if} (attn2 > 0) \{}
\DoxyCodeLine{2034         attn2 *= attn2;}
\DoxyCodeLine{2035         value += attn2 * attn2 * extrapolate2(ctx, xsb + 0, ysb + 1, dx2, dy2);}
\DoxyCodeLine{2036     \}}
\DoxyCodeLine{2037 }
\DoxyCodeLine{2038     \textcolor{keywordflow}{if} (inSum <= 1) \{  \textcolor{comment}{// We're inside the triangle (2-\/Simplex) at (0,0)}}
\DoxyCodeLine{2039         \textcolor{keywordtype}{double} zins = 1 -\/ inSum;}
\DoxyCodeLine{2040         \textcolor{keywordflow}{if} (zins > xins || zins > yins) \{}
\DoxyCodeLine{2041             \textcolor{keywordflow}{if} (xins > yins) \{}
\DoxyCodeLine{2042                 xsv\_ext = xsb + 1;}
\DoxyCodeLine{2043                 ysv\_ext = ysb -\/ 1;}
\DoxyCodeLine{2044                 dx\_ext = dx0 -\/ 1;}
\DoxyCodeLine{2045                 dy\_ext = dy0 + 1;}
\DoxyCodeLine{2046             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2047                 xsv\_ext = xsb -\/ 1;}
\DoxyCodeLine{2048                 ysv\_ext = ysb + 1;}
\DoxyCodeLine{2049                 dx\_ext = dx0 + 1;}
\DoxyCodeLine{2050                 dy\_ext = dy0 -\/ 1;}
\DoxyCodeLine{2051             \}}
\DoxyCodeLine{2052         \} \textcolor{keywordflow}{else} \{  \textcolor{comment}{//(1,0) and (0,1) are the closest two vertices.}}
\DoxyCodeLine{2053             xsv\_ext = xsb + 1;}
\DoxyCodeLine{2054             ysv\_ext = ysb + 1;}
\DoxyCodeLine{2055             dx\_ext = dx0 -\/ 1 -\/ 2 * SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2056             dy\_ext = dy0 -\/ 1 -\/ 2 * SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2057         \}}
\DoxyCodeLine{2058     \} \textcolor{keywordflow}{else} \{  \textcolor{comment}{// We're inside the triangle (2-\/Simplex) at (1,1)}}
\DoxyCodeLine{2059         \textcolor{keywordtype}{double} zins = 2 -\/ inSum;}
\DoxyCodeLine{2060         \textcolor{keywordflow}{if} (zins < xins || zins < yins) \{}
\DoxyCodeLine{2061             \textcolor{keywordflow}{if} (xins > yins) \{}
\DoxyCodeLine{2062                 xsv\_ext = xsb + 2;}
\DoxyCodeLine{2063                 ysv\_ext = ysb + 0;}
\DoxyCodeLine{2064                 dx\_ext = dx0 -\/ 2 -\/ 2 * SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2065                 dy\_ext = dy0 + 0 -\/ 2 * SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2066             \} \textcolor{keywordflow}{else} \{}
\DoxyCodeLine{2067                 xsv\_ext = xsb + 0;}
\DoxyCodeLine{2068                 ysv\_ext = ysb + 2;}
\DoxyCodeLine{2069                 dx\_ext = dx0 + 0 -\/ 2 * SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2070                 dy\_ext = dy0 -\/ 2 -\/ 2 * SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2071             \}}
\DoxyCodeLine{2072         \} \textcolor{keywordflow}{else} \{  \textcolor{comment}{//(1,0) and (0,1) are the closest two vertices.}}
\DoxyCodeLine{2073             dx\_ext = dx0;}
\DoxyCodeLine{2074             dy\_ext = dy0;}
\DoxyCodeLine{2075             xsv\_ext = xsb;}
\DoxyCodeLine{2076             ysv\_ext = ysb;}
\DoxyCodeLine{2077         \}}
\DoxyCodeLine{2078         xsb += 1;}
\DoxyCodeLine{2079         ysb += 1;}
\DoxyCodeLine{2080         dx0 = dx0 -\/ 1 -\/ 2 * SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2081         dy0 = dy0 -\/ 1 -\/ 2 * SQUISH\_CONSTANT\_2D;}
\DoxyCodeLine{2082     \}}
\DoxyCodeLine{2083 }
\DoxyCodeLine{2084     \textcolor{comment}{// Contribution (0,0) or (1,1)}}
\DoxyCodeLine{2085     \textcolor{keywordtype}{double} attn0 = 2 -\/ dx0 * dx0 -\/ dy0 * dy0;}
\DoxyCodeLine{2086     \textcolor{keywordflow}{if} (attn0 > 0) \{}
\DoxyCodeLine{2087         attn0 *= attn0;}
\DoxyCodeLine{2088         value += attn0 * attn0 * extrapolate2(ctx, xsb, ysb, dx0, dy0);}
\DoxyCodeLine{2089     \}}
\DoxyCodeLine{2090 }
\DoxyCodeLine{2091     \textcolor{comment}{// Extra Vertex}}
\DoxyCodeLine{2092     \textcolor{keywordtype}{double} attn\_ext = 2 -\/ dx\_ext * dx\_ext -\/ dy\_ext * dy\_ext;}
\DoxyCodeLine{2093     \textcolor{keywordflow}{if} (attn\_ext > 0) \{}
\DoxyCodeLine{2094         attn\_ext *= attn\_ext;}
\DoxyCodeLine{2095         value += attn\_ext * attn\_ext *}
\DoxyCodeLine{2096             extrapolate2(ctx, xsv\_ext, ysv\_ext, dx\_ext, dy\_ext);}
\DoxyCodeLine{2097     \}}
\DoxyCodeLine{2098 }
\DoxyCodeLine{2099     \textcolor{keywordflow}{return} value / NORM\_CONSTANT\_2D;}
\DoxyCodeLine{2100 \}}
\DoxyCodeLine{2101 }
\DoxyCodeLine{2102 \textcolor{keywordtype}{void} par\_shapes\_remove\_degenerate(\mbox{\hyperlink{structpar__shapes__mesh__s}{par\_shapes\_mesh}}* mesh, \textcolor{keywordtype}{float} mintriarea)}
\DoxyCodeLine{2103 \{}
\DoxyCodeLine{2104     \textcolor{keywordtype}{int} ntriangles = 0;}
\DoxyCodeLine{2105     PAR\_SHAPES\_T* triangles = PAR\_MALLOC(PAR\_SHAPES\_T, mesh-\/>ntriangles * 3);}
\DoxyCodeLine{2106     PAR\_SHAPES\_T* dst = triangles;}
\DoxyCodeLine{2107     PAR\_SHAPES\_T \textcolor{keyword}{const}* src = mesh-\/>triangles;}
\DoxyCodeLine{2108     \textcolor{keywordtype}{float} next[3], prev[3], cp[3];}
\DoxyCodeLine{2109     \textcolor{keywordtype}{float} mincplen2 = (mintriarea * 2) * (mintriarea * 2);}
\DoxyCodeLine{2110     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} f = 0; f < mesh-\/>ntriangles; f++, src += 3) \{}
\DoxyCodeLine{2111         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* pa = mesh-\/>points + 3 * src[0];}
\DoxyCodeLine{2112         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* pb = mesh-\/>points + 3 * src[1];}
\DoxyCodeLine{2113         \textcolor{keywordtype}{float} \textcolor{keyword}{const}* pc = mesh-\/>points + 3 * src[2];}
\DoxyCodeLine{2114         par\_shapes\_\_copy3(next, pb);}
\DoxyCodeLine{2115         par\_shapes\_\_subtract3(next, pa);}
\DoxyCodeLine{2116         par\_shapes\_\_copy3(prev, pc);}
\DoxyCodeLine{2117         par\_shapes\_\_subtract3(prev, pa);}
\DoxyCodeLine{2118         par\_shapes\_\_cross3(cp, next, prev);}
\DoxyCodeLine{2119         \textcolor{keywordtype}{float} cplen2 = par\_shapes\_\_dot3(cp, cp);}
\DoxyCodeLine{2120         \textcolor{keywordflow}{if} (cplen2 >= mincplen2) \{}
\DoxyCodeLine{2121             *dst++ = src[0];}
\DoxyCodeLine{2122             *dst++ = src[1];}
\DoxyCodeLine{2123             *dst++ = src[2];}
\DoxyCodeLine{2124             ntriangles++;}
\DoxyCodeLine{2125         \}}
\DoxyCodeLine{2126     \}}
\DoxyCodeLine{2127     mesh-\/>ntriangles = ntriangles;}
\DoxyCodeLine{2128     PAR\_FREE(mesh-\/>triangles);}
\DoxyCodeLine{2129     mesh-\/>triangles = triangles;}
\DoxyCodeLine{2130 \}}
\DoxyCodeLine{2131 }
\DoxyCodeLine{2132 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// PAR\_SHAPES\_IMPLEMENTATION}}
\DoxyCodeLine{2133 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// PAR\_SHAPES\_H}}
\DoxyCodeLine{2134 }
\DoxyCodeLine{2135 \textcolor{comment}{// par\_shapes is distributed under the MIT license:}}
\DoxyCodeLine{2136 \textcolor{comment}{//}}
\DoxyCodeLine{2137 \textcolor{comment}{// Copyright (c) 2019 Philip Rideout}}
\DoxyCodeLine{2138 \textcolor{comment}{//}}
\DoxyCodeLine{2139 \textcolor{comment}{// Permission is hereby granted, free of charge, to any person obtaining a copy}}
\DoxyCodeLine{2140 \textcolor{comment}{// of this software and associated documentation files (the "{}Software"{}), to deal}}
\DoxyCodeLine{2141 \textcolor{comment}{// in the Software without restriction, including without limitation the rights}}
\DoxyCodeLine{2142 \textcolor{comment}{// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell}}
\DoxyCodeLine{2143 \textcolor{comment}{// copies of the Software, and to permit persons to whom the Software is}}
\DoxyCodeLine{2144 \textcolor{comment}{// furnished to do so, subject to the following conditions:}}
\DoxyCodeLine{2145 \textcolor{comment}{//}}
\DoxyCodeLine{2146 \textcolor{comment}{// The above copyright notice and this permission notice shall be included in}}
\DoxyCodeLine{2147 \textcolor{comment}{// all copies or substantial portions of the Software.}}
\DoxyCodeLine{2148 \textcolor{comment}{//}}
\DoxyCodeLine{2149 \textcolor{comment}{// THE SOFTWARE IS PROVIDED "{}AS IS"{}, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR}}
\DoxyCodeLine{2150 \textcolor{comment}{// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,}}
\DoxyCodeLine{2151 \textcolor{comment}{// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE}}
\DoxyCodeLine{2152 \textcolor{comment}{// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER}}
\DoxyCodeLine{2153 \textcolor{comment}{// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,}}
\DoxyCodeLine{2154 \textcolor{comment}{// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE}}
\DoxyCodeLine{2155 \textcolor{comment}{// SOFTWARE.}}

\end{DoxyCode}
