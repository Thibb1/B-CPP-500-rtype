\hypertarget{jar__mod_8h_source}{}\doxysection{jar\+\_\+mod.\+h}
\label{jar__mod_8h_source}\index{build/\_deps/raylib-\/src/src/external/jar\_mod.h@{build/\_deps/raylib-\/src/src/external/jar\_mod.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{// jar\_mod.h -\/ v0.01 -\/ public domain C0 -\/ Joshua Reisenauer}}
\DoxyCodeLine{2 \textcolor{comment}{//}}
\DoxyCodeLine{3 \textcolor{comment}{// HISTORY:}}
\DoxyCodeLine{4 \textcolor{comment}{//}}
\DoxyCodeLine{5 \textcolor{comment}{//   v0.01  2016-\/03-\/12  Setup}}
\DoxyCodeLine{6 \textcolor{comment}{//}}
\DoxyCodeLine{7 \textcolor{comment}{//}}
\DoxyCodeLine{8 \textcolor{comment}{// USAGE:}}
\DoxyCodeLine{9 \textcolor{comment}{//}}
\DoxyCodeLine{10 \textcolor{comment}{// In ONE source file, put:}}
\DoxyCodeLine{11 \textcolor{comment}{//}}
\DoxyCodeLine{12 \textcolor{comment}{//    \#define JAR\_MOD\_IMPLEMENTATION}}
\DoxyCodeLine{13 \textcolor{comment}{//    \#include "{}jar\_mod.h"{}}}
\DoxyCodeLine{14 \textcolor{comment}{//}}
\DoxyCodeLine{15 \textcolor{comment}{// Other source files should just include jar\_mod.h}}
\DoxyCodeLine{16 \textcolor{comment}{//}}
\DoxyCodeLine{17 \textcolor{comment}{// SAMPLE CODE:}}
\DoxyCodeLine{18 \textcolor{comment}{// jar\_mod\_context\_t modctx;}}
\DoxyCodeLine{19 \textcolor{comment}{// short samplebuff[4096];}}
\DoxyCodeLine{20 \textcolor{comment}{// bool bufferFull = false;}}
\DoxyCodeLine{21 \textcolor{comment}{// int intro\_load(void)}}
\DoxyCodeLine{22 \textcolor{comment}{// \{}}
\DoxyCodeLine{23 \textcolor{comment}{//     jar\_mod\_init(\&modctx);}}
\DoxyCodeLine{24 \textcolor{comment}{//     jar\_mod\_load\_file(\&modctx, "{}file.mod"{});}}
\DoxyCodeLine{25 \textcolor{comment}{//     return 1;}}
\DoxyCodeLine{26 \textcolor{comment}{// \}}}
\DoxyCodeLine{27 \textcolor{comment}{// int intro\_unload(void)}}
\DoxyCodeLine{28 \textcolor{comment}{// \{}}
\DoxyCodeLine{29 \textcolor{comment}{//     jar\_mod\_unload(\&modctx);}}
\DoxyCodeLine{30 \textcolor{comment}{//     return 1;}}
\DoxyCodeLine{31 \textcolor{comment}{// \}}}
\DoxyCodeLine{32 \textcolor{comment}{// int intro\_tick(long counter)}}
\DoxyCodeLine{33 \textcolor{comment}{// \{}}
\DoxyCodeLine{34 \textcolor{comment}{//     if(!bufferFull)}}
\DoxyCodeLine{35 \textcolor{comment}{//     \{}}
\DoxyCodeLine{36 \textcolor{comment}{//         jar\_mod\_fillbuffer(\&modctx, samplebuff, 4096, 0);}}
\DoxyCodeLine{37 \textcolor{comment}{//         bufferFull=true;}}
\DoxyCodeLine{38 \textcolor{comment}{//     \}}}
\DoxyCodeLine{39 \textcolor{comment}{//     if(IsKeyDown(KEY\_ENTER))}}
\DoxyCodeLine{40 \textcolor{comment}{//         return 1;}}
\DoxyCodeLine{41 \textcolor{comment}{//     return 0;}}
\DoxyCodeLine{42 \textcolor{comment}{// \}}}
\DoxyCodeLine{43 \textcolor{comment}{//}}
\DoxyCodeLine{44 \textcolor{comment}{//}}
\DoxyCodeLine{45 \textcolor{comment}{// LISCENSE:}}
\DoxyCodeLine{46 \textcolor{comment}{//}}
\DoxyCodeLine{47 \textcolor{comment}{// Written by: Jean-\/Fran√ßois DEL NERO (http://hxc2001.com/) <Email : jeanfrancoisdelnero <> free.fr>}}
\DoxyCodeLine{48 \textcolor{comment}{// Adapted to jar\_mod by: Joshua Adam Reisenauer <kd7tck@gmail.com>}}
\DoxyCodeLine{49 \textcolor{comment}{// This program is free software. It comes without any warranty, to the}}
\DoxyCodeLine{50 \textcolor{comment}{// extent permitted by applicable law. You can redistribute it and/or}}
\DoxyCodeLine{51 \textcolor{comment}{// modify it under the terms of the Do What The Fuck You Want To Public}}
\DoxyCodeLine{52 \textcolor{comment}{// License, Version 2, as published by Sam Hocevar. See}}
\DoxyCodeLine{53 \textcolor{comment}{// http://sam.zoy.org/wtfpl/COPYING for more details.}}
\DoxyCodeLine{55 \textcolor{comment}{}\textcolor{comment}{// HxCMOD Core API:}}
\DoxyCodeLine{56 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{57 \textcolor{comment}{// int  jar\_mod\_init(jar\_mod\_context\_t * modctx)}}
\DoxyCodeLine{58 \textcolor{comment}{//}}
\DoxyCodeLine{59 \textcolor{comment}{// -\/ Initialize the jar\_mod\_context\_t buffer. Must be called before doing anything else.}}
\DoxyCodeLine{60 \textcolor{comment}{//   Return 1 if success. 0 in case of error.}}
\DoxyCodeLine{61 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{62 \textcolor{comment}{// mulong jar\_mod\_load\_file(jar\_mod\_context\_t * modctx, const char* filename)}}
\DoxyCodeLine{63 \textcolor{comment}{//}}
\DoxyCodeLine{64 \textcolor{comment}{// -\/ "{}Load"{} a MOD from file, context must already be initialized.}}
\DoxyCodeLine{65 \textcolor{comment}{//   Return size of file in bytes.}}
\DoxyCodeLine{66 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{67 \textcolor{comment}{// void jar\_mod\_fillbuffer( jar\_mod\_context\_t * modctx, short * outbuffer, unsigned long nbsample, jar\_mod\_tracker\_buffer\_state * trkbuf )}}
\DoxyCodeLine{68 \textcolor{comment}{//}}
\DoxyCodeLine{69 \textcolor{comment}{// -\/ Generate and return the next samples chunk to outbuffer.}}
\DoxyCodeLine{70 \textcolor{comment}{//   nbsample specify the number of stereo 16bits samples you want.}}
\DoxyCodeLine{71 \textcolor{comment}{//   The output format is by default signed 48000Hz 16-\/bit Stereo PCM samples, otherwise it is changed with jar\_mod\_setcfg().}}
\DoxyCodeLine{72 \textcolor{comment}{//   The output buffer size in bytes must be equal to ( nbsample * 2 * channels ).}}
\DoxyCodeLine{73 \textcolor{comment}{//   The optional trkbuf parameter can be used to get detailed status of the player. Put NULL/0 is unused.}}
\DoxyCodeLine{74 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{75 \textcolor{comment}{// void jar\_mod\_unload( jar\_mod\_context\_t * modctx )}}
\DoxyCodeLine{76 \textcolor{comment}{// -\/ "{}Unload"{} / clear the player status.}}
\DoxyCodeLine{77 \textcolor{comment}{// -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{79 \textcolor{comment}{}}
\DoxyCodeLine{80 }
\DoxyCodeLine{81 \textcolor{preprocessor}{\#ifndef INCLUDE\_JAR\_MOD\_H}}
\DoxyCodeLine{82 \textcolor{preprocessor}{\#define INCLUDE\_JAR\_MOD\_H}}
\DoxyCodeLine{83 }
\DoxyCodeLine{84 \textcolor{comment}{// Allow custom memory allocators}}
\DoxyCodeLine{85 \textcolor{preprocessor}{\#ifndef JARMOD\_MALLOC}}
\DoxyCodeLine{86 \textcolor{preprocessor}{    \#define JARMOD\_MALLOC(sz)    malloc(sz)}}
\DoxyCodeLine{87 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{88 \textcolor{preprocessor}{\#ifndef JARMOD\_FREE}}
\DoxyCodeLine{89 \textcolor{preprocessor}{    \#define JARMOD\_FREE(p)       free(p)}}
\DoxyCodeLine{90 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{91 }
\DoxyCodeLine{92 }
\DoxyCodeLine{93 \textcolor{comment}{// Basic type}}
\DoxyCodeLine{94 \textcolor{keyword}{typedef} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} muchar;}
\DoxyCodeLine{95 \textcolor{keyword}{typedef} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} muint;}
\DoxyCodeLine{96 \textcolor{keyword}{typedef} \textcolor{keywordtype}{short} mint;}
\DoxyCodeLine{97 \textcolor{keyword}{typedef} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} mulong;}
\DoxyCodeLine{98 }
\DoxyCodeLine{99 \textcolor{preprocessor}{\#define NUMMAXCHANNELS 32}}
\DoxyCodeLine{100 \textcolor{preprocessor}{\#define MAXNOTES 12*12}}
\DoxyCodeLine{101 \textcolor{preprocessor}{\#define DEFAULT\_SAMPLE\_RATE 48000}}
\DoxyCodeLine{102 \textcolor{comment}{//}}
\DoxyCodeLine{103 \textcolor{comment}{// MOD file structures}}
\DoxyCodeLine{104 \textcolor{comment}{//}}
\DoxyCodeLine{105 }
\DoxyCodeLine{106 \textcolor{preprocessor}{\#pragma pack(1)}}
\DoxyCodeLine{107 }
\DoxyCodeLine{108 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{109     muchar  name[22];}
\DoxyCodeLine{110     muint   length;}
\DoxyCodeLine{111     muchar  finetune;}
\DoxyCodeLine{112     muchar  volume;}
\DoxyCodeLine{113     muint   reppnt;}
\DoxyCodeLine{114     muint   replen;}
\DoxyCodeLine{115 \} \mbox{\hyperlink{structsample}{sample}};}
\DoxyCodeLine{116 }
\DoxyCodeLine{117 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{118     muchar  sampperiod;}
\DoxyCodeLine{119     muchar  period;}
\DoxyCodeLine{120     muchar  sampeffect;}
\DoxyCodeLine{121     muchar  effect;}
\DoxyCodeLine{122 \} \mbox{\hyperlink{structnote}{note}};}
\DoxyCodeLine{123 }
\DoxyCodeLine{124 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{125     muchar  title[20];}
\DoxyCodeLine{126     \mbox{\hyperlink{structsample}{sample}}  samples[31];}
\DoxyCodeLine{127     muchar  length; \textcolor{comment}{// length of tablepos}}
\DoxyCodeLine{128     muchar  protracker;}
\DoxyCodeLine{129     muchar  patterntable[128];}
\DoxyCodeLine{130     muchar  signature[4];}
\DoxyCodeLine{131     muchar  speed;}
\DoxyCodeLine{132 \} \mbox{\hyperlink{structmodule}{module}};}
\DoxyCodeLine{133 }
\DoxyCodeLine{134 \textcolor{preprocessor}{\#pragma pack()}}
\DoxyCodeLine{135 }
\DoxyCodeLine{136 \textcolor{comment}{//}}
\DoxyCodeLine{137 \textcolor{comment}{// HxCMod Internal structures}}
\DoxyCodeLine{138 \textcolor{comment}{//}}
\DoxyCodeLine{139 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{140     \textcolor{keywordtype}{char}*   sampdata;}
\DoxyCodeLine{141     muint   sampnum;}
\DoxyCodeLine{142     muint   length;}
\DoxyCodeLine{143     muint   reppnt;}
\DoxyCodeLine{144     muint   replen;}
\DoxyCodeLine{145     mulong  samppos;}
\DoxyCodeLine{146     muint   period;}
\DoxyCodeLine{147     muchar  volume;}
\DoxyCodeLine{148     mulong  ticks;}
\DoxyCodeLine{149     muchar  effect;}
\DoxyCodeLine{150     muchar  parameffect;}
\DoxyCodeLine{151     muint   effect\_code;}
\DoxyCodeLine{152     mint    decalperiod;}
\DoxyCodeLine{153     mint    portaspeed;}
\DoxyCodeLine{154     mint    portaperiod;}
\DoxyCodeLine{155     mint    vibraperiod;}
\DoxyCodeLine{156     mint    Arpperiods[3];}
\DoxyCodeLine{157     muchar  ArpIndex;}
\DoxyCodeLine{158     mint    oldk;}
\DoxyCodeLine{159     muchar  volumeslide;}
\DoxyCodeLine{160     muchar  vibraparam;}
\DoxyCodeLine{161     muchar  vibrapointeur;}
\DoxyCodeLine{162     muchar  finetune;}
\DoxyCodeLine{163     muchar  cut\_param;}
\DoxyCodeLine{164     muint   patternloopcnt;}
\DoxyCodeLine{165     muint   patternloopstartpoint;}
\DoxyCodeLine{166 \} \mbox{\hyperlink{structchannel}{channel}};}
\DoxyCodeLine{167 }
\DoxyCodeLine{168 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\{}
\DoxyCodeLine{169     \mbox{\hyperlink{structmodule}{module}}  song;}
\DoxyCodeLine{170     \textcolor{keywordtype}{char}*   sampledata[31];}
\DoxyCodeLine{171     \mbox{\hyperlink{structnote}{note}}*   patterndata[128];}
\DoxyCodeLine{172 }
\DoxyCodeLine{173     mulong  playrate;}
\DoxyCodeLine{174     muint   tablepos;}
\DoxyCodeLine{175     muint   patternpos;}
\DoxyCodeLine{176     muint   patterndelay;}
\DoxyCodeLine{177     muint   jump\_loop\_effect;}
\DoxyCodeLine{178     muchar  bpm;}
\DoxyCodeLine{179     mulong  patternticks;}
\DoxyCodeLine{180     mulong  patterntickse;}
\DoxyCodeLine{181     mulong  patternticksaim;}
\DoxyCodeLine{182     mulong  sampleticksconst;}
\DoxyCodeLine{183     mulong  samplenb;}
\DoxyCodeLine{184     \mbox{\hyperlink{structchannel}{channel}} channels[NUMMAXCHANNELS];}
\DoxyCodeLine{185     muint   number\_of\_channels;}
\DoxyCodeLine{186     muint   fullperiod[MAXNOTES * 8];}
\DoxyCodeLine{187     muint   mod\_loaded;}
\DoxyCodeLine{188     mint    last\_r\_sample;}
\DoxyCodeLine{189     mint    last\_l\_sample;}
\DoxyCodeLine{190     mint    stereo;}
\DoxyCodeLine{191     mint    stereo\_separation;}
\DoxyCodeLine{192     mint    bits;}
\DoxyCodeLine{193     mint    filter;}
\DoxyCodeLine{194     }
\DoxyCodeLine{195     muchar *modfile; \textcolor{comment}{// the raw mod file}}
\DoxyCodeLine{196     mulong  modfilesize;}
\DoxyCodeLine{197     muint   loopcount;}
\DoxyCodeLine{198 \} \mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}};}
\DoxyCodeLine{199 }
\DoxyCodeLine{200 \textcolor{comment}{//}}
\DoxyCodeLine{201 \textcolor{comment}{// Player states structures}}
\DoxyCodeLine{202 \textcolor{comment}{//}}
\DoxyCodeLine{203 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structtrack__state__}{track\_state\_}}}
\DoxyCodeLine{204 \{}
\DoxyCodeLine{205     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} instrument\_number;}
\DoxyCodeLine{206     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} cur\_period;}
\DoxyCodeLine{207     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}  cur\_volume;}
\DoxyCodeLine{208     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} cur\_effect;}
\DoxyCodeLine{209     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} cur\_parameffect;}
\DoxyCodeLine{210 \}\mbox{\hyperlink{structtrack__state__}{track\_state}};}
\DoxyCodeLine{211 }
\DoxyCodeLine{212 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structtracker__state__}{tracker\_state\_}}}
\DoxyCodeLine{213 \{}
\DoxyCodeLine{214     \textcolor{keywordtype}{int} number\_of\_tracks;}
\DoxyCodeLine{215     \textcolor{keywordtype}{int} bpm;}
\DoxyCodeLine{216     \textcolor{keywordtype}{int} speed;}
\DoxyCodeLine{217     \textcolor{keywordtype}{int} cur\_pattern;}
\DoxyCodeLine{218     \textcolor{keywordtype}{int} cur\_pattern\_pos;}
\DoxyCodeLine{219     \textcolor{keywordtype}{int} cur\_pattern\_table\_pos;}
\DoxyCodeLine{220     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} buf\_index;}
\DoxyCodeLine{221     \mbox{\hyperlink{structtrack__state__}{track\_state}} tracks[32];}
\DoxyCodeLine{222 \}\mbox{\hyperlink{structtracker__state__}{tracker\_state}};}
\DoxyCodeLine{223 }
\DoxyCodeLine{224 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structtracker__state__instrument__}{tracker\_state\_instrument\_}}}
\DoxyCodeLine{225 \{}
\DoxyCodeLine{226     \textcolor{keywordtype}{char} name[22];}
\DoxyCodeLine{227     \textcolor{keywordtype}{int}  active;}
\DoxyCodeLine{228 \}\mbox{\hyperlink{structtracker__state__instrument__}{tracker\_state\_instrument}};}
\DoxyCodeLine{229 }
\DoxyCodeLine{230 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structjar__mod__tracker__buffer__state__}{jar\_mod\_tracker\_buffer\_state\_}}}
\DoxyCodeLine{231 \{}
\DoxyCodeLine{232     \textcolor{keywordtype}{int}  nb\_max\_of\_state;}
\DoxyCodeLine{233     \textcolor{keywordtype}{int}  nb\_of\_state;}
\DoxyCodeLine{234     \textcolor{keywordtype}{int}  cur\_rd\_index;}
\DoxyCodeLine{235     \textcolor{keywordtype}{int}  sample\_step;}
\DoxyCodeLine{236     \textcolor{keywordtype}{char} name[64];}
\DoxyCodeLine{237     \mbox{\hyperlink{structtracker__state__instrument__}{tracker\_state\_instrument}} instruments[31];}
\DoxyCodeLine{238     \mbox{\hyperlink{structtracker__state__}{tracker\_state}} * track\_state\_buf;}
\DoxyCodeLine{239 \}\mbox{\hyperlink{structjar__mod__tracker__buffer__state__}{jar\_mod\_tracker\_buffer\_state}};}
\DoxyCodeLine{240 }
\DoxyCodeLine{241 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{242 \textcolor{keyword}{extern} \textcolor{stringliteral}{"{}C"{}} \{}
\DoxyCodeLine{243 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{244 }
\DoxyCodeLine{245 \textcolor{keywordtype}{bool}   jar\_mod\_init(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx);}
\DoxyCodeLine{246 \textcolor{keywordtype}{bool}   jar\_mod\_setcfg(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx, \textcolor{keywordtype}{int} samplerate, \textcolor{keywordtype}{int} bits, \textcolor{keywordtype}{int} stereo, \textcolor{keywordtype}{int} stereo\_separation, \textcolor{keywordtype}{int} filter);}
\DoxyCodeLine{247 \textcolor{keywordtype}{void}   jar\_mod\_fillbuffer(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx, \textcolor{keywordtype}{short} * outbuffer, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} nbsample, \mbox{\hyperlink{structjar__mod__tracker__buffer__state__}{jar\_mod\_tracker\_buffer\_state}} * trkbuf);}
\DoxyCodeLine{248 \textcolor{keywordtype}{void}   jar\_mod\_unload(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx);}
\DoxyCodeLine{249 mulong jar\_mod\_load\_file(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* filename);}
\DoxyCodeLine{250 mulong jar\_mod\_current\_samples(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx);}
\DoxyCodeLine{251 mulong jar\_mod\_max\_samples(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx);}
\DoxyCodeLine{252 \textcolor{keywordtype}{void}   jar\_mod\_seek\_start(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * ctx);}
\DoxyCodeLine{253 }
\DoxyCodeLine{254 \textcolor{preprocessor}{\#ifdef \_\_cplusplus}}
\DoxyCodeLine{255 \}}
\DoxyCodeLine{256 \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{257 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{258 }
\DoxyCodeLine{259 }
\DoxyCodeLine{260 }
\DoxyCodeLine{261 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{262 \textcolor{preprocessor}{\#ifdef JAR\_MOD\_IMPLEMENTATION}}
\DoxyCodeLine{263 }
\DoxyCodeLine{264 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{265 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{266 \textcolor{comment}{//\#include <stdbool.h>}}
\DoxyCodeLine{267 }
\DoxyCodeLine{268 \textcolor{comment}{// Effects list}}
\DoxyCodeLine{269 \textcolor{preprocessor}{\#define EFFECT\_ARPEGGIO              0x0 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{270 \textcolor{preprocessor}{\#define EFFECT\_PORTAMENTO\_UP         0x1 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{271 \textcolor{preprocessor}{\#define EFFECT\_PORTAMENTO\_DOWN       0x2 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{272 \textcolor{preprocessor}{\#define EFFECT\_TONE\_PORTAMENTO       0x3 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{273 \textcolor{preprocessor}{\#define EFFECT\_VIBRATO               0x4 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{274 \textcolor{preprocessor}{\#define EFFECT\_VOLSLIDE\_TONEPORTA    0x5 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{275 \textcolor{preprocessor}{\#define EFFECT\_VOLSLIDE\_VIBRATO      0x6 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{276 \textcolor{preprocessor}{\#define EFFECT\_VOLSLIDE\_TREMOLO      0x7 }\textcolor{comment}{// -\/ TO BE DONE -\/}}
\DoxyCodeLine{277 \textcolor{preprocessor}{\#define EFFECT\_SET\_PANNING           0x8 }\textcolor{comment}{// -\/ TO BE DONE -\/}}
\DoxyCodeLine{278 \textcolor{preprocessor}{\#define EFFECT\_SET\_OFFSET            0x9 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{279 \textcolor{preprocessor}{\#define EFFECT\_VOLUME\_SLIDE          0xA }\textcolor{comment}{// Supported}}
\DoxyCodeLine{280 \textcolor{preprocessor}{\#define EFFECT\_JUMP\_POSITION         0xB }\textcolor{comment}{// Supported}}
\DoxyCodeLine{281 \textcolor{preprocessor}{\#define EFFECT\_SET\_VOLUME            0xC }\textcolor{comment}{// Supported}}
\DoxyCodeLine{282 \textcolor{preprocessor}{\#define EFFECT\_PATTERN\_BREAK         0xD }\textcolor{comment}{// Supported}}
\DoxyCodeLine{283 }
\DoxyCodeLine{284 \textcolor{preprocessor}{\#define EFFECT\_EXTENDED              0xE}}
\DoxyCodeLine{285 \textcolor{preprocessor}{\#define EFFECT\_E\_FINE\_PORTA\_UP       0x1 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{286 \textcolor{preprocessor}{\#define EFFECT\_E\_FINE\_PORTA\_DOWN     0x2 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{287 \textcolor{preprocessor}{\#define EFFECT\_E\_GLISSANDO\_CTRL      0x3 }\textcolor{comment}{// -\/ TO BE DONE -\/}}
\DoxyCodeLine{288 \textcolor{preprocessor}{\#define EFFECT\_E\_VIBRATO\_WAVEFORM    0x4 }\textcolor{comment}{// -\/ TO BE DONE -\/}}
\DoxyCodeLine{289 \textcolor{preprocessor}{\#define EFFECT\_E\_SET\_FINETUNE        0x5 }\textcolor{comment}{// -\/ TO BE DONE -\/}}
\DoxyCodeLine{290 \textcolor{preprocessor}{\#define EFFECT\_E\_PATTERN\_LOOP        0x6 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{291 \textcolor{preprocessor}{\#define EFFECT\_E\_TREMOLO\_WAVEFORM    0x7 }\textcolor{comment}{// -\/ TO BE DONE -\/}}
\DoxyCodeLine{292 \textcolor{preprocessor}{\#define EFFECT\_E\_SET\_PANNING\_2       0x8 }\textcolor{comment}{// -\/ TO BE DONE -\/}}
\DoxyCodeLine{293 \textcolor{preprocessor}{\#define EFFECT\_E\_RETRIGGER\_NOTE      0x9 }\textcolor{comment}{// -\/ TO BE DONE -\/}}
\DoxyCodeLine{294 \textcolor{preprocessor}{\#define EFFECT\_E\_FINE\_VOLSLIDE\_UP    0xA }\textcolor{comment}{// Supported}}
\DoxyCodeLine{295 \textcolor{preprocessor}{\#define EFFECT\_E\_FINE\_VOLSLIDE\_DOWN  0xB }\textcolor{comment}{// Supported}}
\DoxyCodeLine{296 \textcolor{preprocessor}{\#define EFFECT\_E\_NOTE\_CUT            0xC }\textcolor{comment}{// Supported}}
\DoxyCodeLine{297 \textcolor{preprocessor}{\#define EFFECT\_E\_NOTE\_DELAY          0xD }\textcolor{comment}{// -\/ TO BE DONE -\/}}
\DoxyCodeLine{298 \textcolor{preprocessor}{\#define EFFECT\_E\_PATTERN\_DELAY       0xE }\textcolor{comment}{// Supported}}
\DoxyCodeLine{299 \textcolor{preprocessor}{\#define EFFECT\_E\_INVERT\_LOOP         0xF }\textcolor{comment}{// -\/ TO BE DONE -\/}}
\DoxyCodeLine{300 \textcolor{preprocessor}{\#define EFFECT\_SET\_SPEED             0xF0 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{301 \textcolor{preprocessor}{\#define EFFECT\_SET\_TEMPO             0xF2 }\textcolor{comment}{// Supported}}
\DoxyCodeLine{302 }
\DoxyCodeLine{303 \textcolor{preprocessor}{\#define PERIOD\_TABLE\_LENGTH  MAXNOTES}}
\DoxyCodeLine{304 \textcolor{preprocessor}{\#define FULL\_PERIOD\_TABLE\_LENGTH  ( PERIOD\_TABLE\_LENGTH * 8 )}}
\DoxyCodeLine{305 }
\DoxyCodeLine{306 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{short} periodtable[]=}
\DoxyCodeLine{307 \{}
\DoxyCodeLine{308     27392, 25856, 24384, 23040, 21696, 20480, 19328, 18240, 17216, 16256, 15360, 14496,}
\DoxyCodeLine{309     13696, 12928, 12192, 11520, 10848, 10240,  9664,  9120,  8606,  8128,  7680,  7248,}
\DoxyCodeLine{310      6848,  6464,  6096,  5760,  5424,  5120,  4832,  4560,  4304,  4064,  3840,  3624,}
\DoxyCodeLine{311      3424,  3232,  3048,  2880,  2712,  2560,  2416,  2280,  2152,  2032,  1920,  1812,}
\DoxyCodeLine{312      1712,  1616,  1524,  1440,  1356,  1280,  1208,  1140,  1076,  1016,   960,   906,}
\DoxyCodeLine{313       856,   808,   762,   720,   678,   640,   604,   570,   538,   508,   480,   453,}
\DoxyCodeLine{314       428,   404,   381,   360,   339,   320,   302,   285,   269,   254,   240,   226,}
\DoxyCodeLine{315       214,   202,   190,   180,   170,   160,   151,   143,   135,   127,   120,   113,}
\DoxyCodeLine{316       107,   101,    95,    90,    85,    80,    75,    71,    67,    63,    60,    56,}
\DoxyCodeLine{317        53,    50,    47,    45,    42,    40,    37,    35,    33,    31,    30,    28,}
\DoxyCodeLine{318        27,    25,    24,    22,    21,    20,    19,    18,    17,    16,    15,    14,}
\DoxyCodeLine{319        13,    13,    12,    11,    11,    10,     9,     9,     8,     8,     7,     7}
\DoxyCodeLine{320 \};}
\DoxyCodeLine{321 }
\DoxyCodeLine{322 \textcolor{keyword}{static} \textcolor{keyword}{const} \textcolor{keywordtype}{short} sintable[]=\{}
\DoxyCodeLine{323       0,  24,  49,  74,  97, 120, 141,161,}
\DoxyCodeLine{324     180, 197, 212, 224, 235, 244, 250,253,}
\DoxyCodeLine{325     255, 253, 250, 244, 235, 224, 212,197,}
\DoxyCodeLine{326     180, 161, 141, 120,  97,  74,  49, 24}
\DoxyCodeLine{327 \};}
\DoxyCodeLine{328 }
\DoxyCodeLine{329 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }modtype\_}
\DoxyCodeLine{330 \{}
\DoxyCodeLine{331     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} signature[5];}
\DoxyCodeLine{332     \textcolor{keywordtype}{int} numberofchannels;}
\DoxyCodeLine{333 \}modtype;}
\DoxyCodeLine{334 }
\DoxyCodeLine{335 modtype modlist[]=}
\DoxyCodeLine{336 \{}
\DoxyCodeLine{337     \{ \textcolor{stringliteral}{"{}M!K!"{}},4\},}
\DoxyCodeLine{338     \{ \textcolor{stringliteral}{"{}M.K."{}},4\},}
\DoxyCodeLine{339     \{ \textcolor{stringliteral}{"{}FLT4"{}},4\},}
\DoxyCodeLine{340     \{ \textcolor{stringliteral}{"{}FLT8"{}},8\},}
\DoxyCodeLine{341     \{ \textcolor{stringliteral}{"{}4CHN"{}},4\},}
\DoxyCodeLine{342     \{ \textcolor{stringliteral}{"{}6CHN"{}},6\},}
\DoxyCodeLine{343     \{ \textcolor{stringliteral}{"{}8CHN"{}},8\},}
\DoxyCodeLine{344     \{ \textcolor{stringliteral}{"{}10CH"{}},10\},}
\DoxyCodeLine{345     \{ \textcolor{stringliteral}{"{}12CH"{}},12\},}
\DoxyCodeLine{346     \{ \textcolor{stringliteral}{"{}14CH"{}},14\},}
\DoxyCodeLine{347     \{ \textcolor{stringliteral}{"{}16CH"{}},16\},}
\DoxyCodeLine{348     \{ \textcolor{stringliteral}{"{}18CH"{}},18\},}
\DoxyCodeLine{349     \{ \textcolor{stringliteral}{"{}20CH"{}},20\},}
\DoxyCodeLine{350     \{ \textcolor{stringliteral}{"{}22CH"{}},22\},}
\DoxyCodeLine{351     \{ \textcolor{stringliteral}{"{}24CH"{}},24\},}
\DoxyCodeLine{352     \{ \textcolor{stringliteral}{"{}26CH"{}},26\},}
\DoxyCodeLine{353     \{ \textcolor{stringliteral}{"{}28CH"{}},28\},}
\DoxyCodeLine{354     \{ \textcolor{stringliteral}{"{}30CH"{}},30\},}
\DoxyCodeLine{355     \{ \textcolor{stringliteral}{"{}32CH"{}},32\},}
\DoxyCodeLine{356     \{ \textcolor{stringliteral}{"{}"{}},0\}}
\DoxyCodeLine{357 \};}
\DoxyCodeLine{358 }
\DoxyCodeLine{360 }
\DoxyCodeLine{361 \textcolor{keyword}{static} \textcolor{keywordtype}{void} memcopy( \textcolor{keywordtype}{void} * dest, \textcolor{keywordtype}{void} *source, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} size )}
\DoxyCodeLine{362 \{}
\DoxyCodeLine{363     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} i;}
\DoxyCodeLine{364     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} * d,*s;}
\DoxyCodeLine{365 }
\DoxyCodeLine{366     d=(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}*)dest;}
\DoxyCodeLine{367     s=(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}*)source;}
\DoxyCodeLine{368     \textcolor{keywordflow}{for}(i=0;i<size;i++)}
\DoxyCodeLine{369     \{}
\DoxyCodeLine{370         d[i]=s[i];}
\DoxyCodeLine{371     \}}
\DoxyCodeLine{372 \}}
\DoxyCodeLine{373 }
\DoxyCodeLine{374 \textcolor{keyword}{static} \textcolor{keywordtype}{void} memclear( \textcolor{keywordtype}{void} * dest, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} value, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} size )}
\DoxyCodeLine{375 \{}
\DoxyCodeLine{376     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} i;}
\DoxyCodeLine{377     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} * d;}
\DoxyCodeLine{378 }
\DoxyCodeLine{379     d=(\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}*)dest;}
\DoxyCodeLine{380     \textcolor{keywordflow}{for}(i=0;i<size;i++)}
\DoxyCodeLine{381     \{}
\DoxyCodeLine{382         d[i]=value;}
\DoxyCodeLine{383     \}}
\DoxyCodeLine{384 \}}
\DoxyCodeLine{385 }
\DoxyCodeLine{386 \textcolor{keyword}{static} \textcolor{keywordtype}{int} memcompare( \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} * buf1, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} * buf2, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} size )}
\DoxyCodeLine{387 \{}
\DoxyCodeLine{388     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{389 }
\DoxyCodeLine{390     i = 0;}
\DoxyCodeLine{391 }
\DoxyCodeLine{392     \textcolor{keywordflow}{while}(i<size)}
\DoxyCodeLine{393     \{}
\DoxyCodeLine{394         \textcolor{keywordflow}{if}(buf1[i] != buf2[i])}
\DoxyCodeLine{395         \{}
\DoxyCodeLine{396             \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{397         \}}
\DoxyCodeLine{398         i++;}
\DoxyCodeLine{399     \}}
\DoxyCodeLine{400 }
\DoxyCodeLine{401     \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{402 \}}
\DoxyCodeLine{403 }
\DoxyCodeLine{404 \textcolor{keyword}{static} \textcolor{keywordtype}{int} getnote( \mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * mod, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} period, \textcolor{keywordtype}{int} finetune )}
\DoxyCodeLine{405 \{}
\DoxyCodeLine{406     \textcolor{keywordtype}{int} i;}
\DoxyCodeLine{407 }
\DoxyCodeLine{408     \textcolor{keywordflow}{for}(i = 0; i < FULL\_PERIOD\_TABLE\_LENGTH; i++)}
\DoxyCodeLine{409     \{}
\DoxyCodeLine{410         \textcolor{keywordflow}{if}(period >= mod-\/>fullperiod[i])}
\DoxyCodeLine{411         \{}
\DoxyCodeLine{412             \textcolor{keywordflow}{return} i;}
\DoxyCodeLine{413         \}}
\DoxyCodeLine{414     \}}
\DoxyCodeLine{415 }
\DoxyCodeLine{416     \textcolor{keywordflow}{return} MAXNOTES;}
\DoxyCodeLine{417 \}}
\DoxyCodeLine{418 }
\DoxyCodeLine{419 \textcolor{keyword}{static} \textcolor{keywordtype}{void} worknote( \mbox{\hyperlink{structnote}{note}} * nptr, \mbox{\hyperlink{structchannel}{channel}} * cptr, \textcolor{keywordtype}{char} t, \mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * mod )}
\DoxyCodeLine{420 \{}
\DoxyCodeLine{421     muint \mbox{\hyperlink{structsample}{sample}}, period, effect, operiod;}
\DoxyCodeLine{422     muint curnote, arpnote;}
\DoxyCodeLine{423 }
\DoxyCodeLine{424     \mbox{\hyperlink{structsample}{sample}} = (nptr-\/>sampperiod \& 0xF0) | (nptr-\/>sampeffect >> 4);}
\DoxyCodeLine{425     period = ((nptr-\/>sampperiod \& 0xF) << 8) | nptr-\/>period;}
\DoxyCodeLine{426     effect = ((nptr-\/>sampeffect \& 0xF) << 8) | nptr-\/>effect;}
\DoxyCodeLine{427 }
\DoxyCodeLine{428     operiod = cptr-\/>period;}
\DoxyCodeLine{429 }
\DoxyCodeLine{430     \textcolor{keywordflow}{if} ( period || \mbox{\hyperlink{structsample}{sample}} )}
\DoxyCodeLine{431     \{}
\DoxyCodeLine{432         \textcolor{keywordflow}{if}( \mbox{\hyperlink{structsample}{sample}} \&\& \mbox{\hyperlink{structsample}{sample}} < 32 )}
\DoxyCodeLine{433         \{}
\DoxyCodeLine{434             cptr-\/>sampnum = \mbox{\hyperlink{structsample}{sample}} -\/ 1;}
\DoxyCodeLine{435         \}}
\DoxyCodeLine{436 }
\DoxyCodeLine{437         \textcolor{keywordflow}{if}( period || \mbox{\hyperlink{structsample}{sample}} )}
\DoxyCodeLine{438         \{}
\DoxyCodeLine{439             cptr-\/>sampdata = (\textcolor{keywordtype}{char} *) mod-\/>sampledata[cptr-\/>sampnum];}
\DoxyCodeLine{440             cptr-\/>length = mod-\/>song.samples[cptr-\/>sampnum].length;}
\DoxyCodeLine{441             cptr-\/>reppnt = mod-\/>song.samples[cptr-\/>sampnum].reppnt;}
\DoxyCodeLine{442             cptr-\/>replen = mod-\/>song.samples[cptr-\/>sampnum].replen;}
\DoxyCodeLine{443 }
\DoxyCodeLine{444             cptr-\/>finetune = (mod-\/>song.samples[cptr-\/>sampnum].finetune)\&0xF;}
\DoxyCodeLine{445 }
\DoxyCodeLine{446             \textcolor{keywordflow}{if}(effect>>8!=4 \&\& effect>>8!=6)}
\DoxyCodeLine{447             \{}
\DoxyCodeLine{448                 cptr-\/>vibraperiod=0;}
\DoxyCodeLine{449                 cptr-\/>vibrapointeur=0;}
\DoxyCodeLine{450             \}}
\DoxyCodeLine{451         \}}
\DoxyCodeLine{452 }
\DoxyCodeLine{453         \textcolor{keywordflow}{if}( (\mbox{\hyperlink{structsample}{sample}} != 0) \&\& ( (effect>>8) != EFFECT\_VOLSLIDE\_TONEPORTA ) )}
\DoxyCodeLine{454         \{}
\DoxyCodeLine{455             cptr-\/>volume = mod-\/>song.samples[cptr-\/>sampnum].volume;}
\DoxyCodeLine{456             cptr-\/>volumeslide = 0;}
\DoxyCodeLine{457         \}}
\DoxyCodeLine{458 }
\DoxyCodeLine{459         \textcolor{keywordflow}{if}( ( (effect>>8) != EFFECT\_TONE\_PORTAMENTO \&\& (effect>>8)!=EFFECT\_VOLSLIDE\_TONEPORTA) )}
\DoxyCodeLine{460         \{}
\DoxyCodeLine{461             \textcolor{keywordflow}{if} (period!=0)}
\DoxyCodeLine{462                 cptr-\/>samppos = 0;}
\DoxyCodeLine{463         \}}
\DoxyCodeLine{464 }
\DoxyCodeLine{465         cptr-\/>decalperiod = 0;}
\DoxyCodeLine{466         \textcolor{keywordflow}{if}( period )}
\DoxyCodeLine{467         \{}
\DoxyCodeLine{468             \textcolor{keywordflow}{if}(cptr-\/>finetune)}
\DoxyCodeLine{469             \{}
\DoxyCodeLine{470                 \textcolor{keywordflow}{if}( cptr-\/>finetune <= 7 )}
\DoxyCodeLine{471                 \{}
\DoxyCodeLine{472                     period = mod-\/>fullperiod[getnote(mod,period,0) + cptr-\/>finetune];}
\DoxyCodeLine{473                 \}}
\DoxyCodeLine{474                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{475                 \{}
\DoxyCodeLine{476                     period = mod-\/>fullperiod[getnote(mod,period,0) -\/ (16 -\/ (cptr-\/>finetune)) ];}
\DoxyCodeLine{477                 \}}
\DoxyCodeLine{478             \}}
\DoxyCodeLine{479 }
\DoxyCodeLine{480             cptr-\/>period = period;}
\DoxyCodeLine{481         \}}
\DoxyCodeLine{482 }
\DoxyCodeLine{483     \}}
\DoxyCodeLine{484 }
\DoxyCodeLine{485     cptr-\/>effect = 0;}
\DoxyCodeLine{486     cptr-\/>parameffect = 0;}
\DoxyCodeLine{487     cptr-\/>effect\_code = effect;}
\DoxyCodeLine{488 }
\DoxyCodeLine{489     \textcolor{keywordflow}{switch} (effect >> 8)}
\DoxyCodeLine{490     \{}
\DoxyCodeLine{491         \textcolor{keywordflow}{case} EFFECT\_ARPEGGIO:}
\DoxyCodeLine{492             \textcolor{comment}{/*}}
\DoxyCodeLine{493 \textcolor{comment}{            [0]: Arpeggio}}
\DoxyCodeLine{494 \textcolor{comment}{            Where [0][x][y] means "{}play note, note+x semitones, note+y}}
\DoxyCodeLine{495 \textcolor{comment}{            semitones, then return to original note"{}. The fluctuations are}}
\DoxyCodeLine{496 \textcolor{comment}{            carried out evenly spaced in one pattern division. They are usually}}
\DoxyCodeLine{497 \textcolor{comment}{            used to simulate chords, but this doesn't work too well. They are}}
\DoxyCodeLine{498 \textcolor{comment}{            also used to produce heavy vibrato. A major chord is when x=4, y=7.}}
\DoxyCodeLine{499 \textcolor{comment}{            A minor chord is when x=3, y=7.}}
\DoxyCodeLine{500 \textcolor{comment}{            */}}
\DoxyCodeLine{501 }
\DoxyCodeLine{502             \textcolor{keywordflow}{if}(effect\&0xff)}
\DoxyCodeLine{503             \{}
\DoxyCodeLine{504                 cptr-\/>effect = EFFECT\_ARPEGGIO;}
\DoxyCodeLine{505                 cptr-\/>parameffect = effect\&0xff;}
\DoxyCodeLine{506 }
\DoxyCodeLine{507                 cptr-\/>ArpIndex = 0;}
\DoxyCodeLine{508 }
\DoxyCodeLine{509                 curnote = getnote(mod,cptr-\/>period,cptr-\/>finetune);}
\DoxyCodeLine{510 }
\DoxyCodeLine{511                 cptr-\/>Arpperiods[0] = cptr-\/>period;}
\DoxyCodeLine{512 }
\DoxyCodeLine{513                 arpnote = curnote + (((cptr-\/>parameffect>>4)\&0xF)*8);}
\DoxyCodeLine{514                 \textcolor{keywordflow}{if}( arpnote >= FULL\_PERIOD\_TABLE\_LENGTH )}
\DoxyCodeLine{515                     arpnote = FULL\_PERIOD\_TABLE\_LENGTH -\/ 1;}
\DoxyCodeLine{516 }
\DoxyCodeLine{517                 cptr-\/>Arpperiods[1] = mod-\/>fullperiod[arpnote];}
\DoxyCodeLine{518 }
\DoxyCodeLine{519                 arpnote = curnote + (((cptr-\/>parameffect)\&0xF)*8);}
\DoxyCodeLine{520                 \textcolor{keywordflow}{if}( arpnote >= FULL\_PERIOD\_TABLE\_LENGTH )}
\DoxyCodeLine{521                     arpnote = FULL\_PERIOD\_TABLE\_LENGTH -\/ 1;}
\DoxyCodeLine{522 }
\DoxyCodeLine{523                 cptr-\/>Arpperiods[2] = mod-\/>fullperiod[arpnote];}
\DoxyCodeLine{524             \}}
\DoxyCodeLine{525         \textcolor{keywordflow}{break};}
\DoxyCodeLine{526 }
\DoxyCodeLine{527         \textcolor{keywordflow}{case} EFFECT\_PORTAMENTO\_UP:}
\DoxyCodeLine{528             \textcolor{comment}{/*}}
\DoxyCodeLine{529 \textcolor{comment}{            [1]: Slide up}}
\DoxyCodeLine{530 \textcolor{comment}{            Where [1][x][y] means "{}smoothly decrease the period of current}}
\DoxyCodeLine{531 \textcolor{comment}{            sample by x*16+y after each tick in the division"{}. The}}
\DoxyCodeLine{532 \textcolor{comment}{            ticks/division are set with the 'set speed' effect (see below). If}}
\DoxyCodeLine{533 \textcolor{comment}{            the period of the note being played is z, then the final period}}
\DoxyCodeLine{534 \textcolor{comment}{            will be z -\/ (x*16 + y)*(ticks -\/ 1). As the slide rate depends on}}
\DoxyCodeLine{535 \textcolor{comment}{            the speed, changing the speed will change the slide. You cannot}}
\DoxyCodeLine{536 \textcolor{comment}{            slide beyond the note B3 (period 113).}}
\DoxyCodeLine{537 \textcolor{comment}{            */}}
\DoxyCodeLine{538 }
\DoxyCodeLine{539             cptr-\/>effect = EFFECT\_PORTAMENTO\_UP;}
\DoxyCodeLine{540             cptr-\/>parameffect = effect\&0xff;}
\DoxyCodeLine{541         \textcolor{keywordflow}{break};}
\DoxyCodeLine{542 }
\DoxyCodeLine{543         \textcolor{keywordflow}{case} EFFECT\_PORTAMENTO\_DOWN:}
\DoxyCodeLine{544             \textcolor{comment}{/*}}
\DoxyCodeLine{545 \textcolor{comment}{            [2]: Slide down}}
\DoxyCodeLine{546 \textcolor{comment}{            Where [2][x][y] means "{}smoothly increase the period of current}}
\DoxyCodeLine{547 \textcolor{comment}{            sample by x*16+y after each tick in the division"{}. Similar to [1],}}
\DoxyCodeLine{548 \textcolor{comment}{            but lowers the pitch. You cannot slide beyond the note C1 (period}}
\DoxyCodeLine{549 \textcolor{comment}{            856).}}
\DoxyCodeLine{550 \textcolor{comment}{            */}}
\DoxyCodeLine{551 }
\DoxyCodeLine{552             cptr-\/>effect = EFFECT\_PORTAMENTO\_DOWN;}
\DoxyCodeLine{553             cptr-\/>parameffect = effect\&0xff;}
\DoxyCodeLine{554         \textcolor{keywordflow}{break};}
\DoxyCodeLine{555 }
\DoxyCodeLine{556         \textcolor{keywordflow}{case} EFFECT\_TONE\_PORTAMENTO:}
\DoxyCodeLine{557             \textcolor{comment}{/*}}
\DoxyCodeLine{558 \textcolor{comment}{            [3]: Slide to note}}
\DoxyCodeLine{559 \textcolor{comment}{            Where [3][x][y] means "{}smoothly change the period of current sample}}
\DoxyCodeLine{560 \textcolor{comment}{            by x*16+y after each tick in the division, never sliding beyond}}
\DoxyCodeLine{561 \textcolor{comment}{            current period"{}. The period-\/length in this channel's division is a}}
\DoxyCodeLine{562 \textcolor{comment}{            parameter to this effect, and hence is not played. Sliding to a}}
\DoxyCodeLine{563 \textcolor{comment}{            note is similar to effects [1] and [2], but the slide will not go}}
\DoxyCodeLine{564 \textcolor{comment}{            beyond the given period, and the direction is implied by that}}
\DoxyCodeLine{565 \textcolor{comment}{            period. If x and y are both 0, then the old slide will continue.}}
\DoxyCodeLine{566 \textcolor{comment}{            */}}
\DoxyCodeLine{567 }
\DoxyCodeLine{568             cptr-\/>effect = EFFECT\_TONE\_PORTAMENTO;}
\DoxyCodeLine{569             \textcolor{keywordflow}{if}( (effect\&0xff) != 0 )}
\DoxyCodeLine{570             \{}
\DoxyCodeLine{571                 cptr-\/>portaspeed = (short)(effect\&0xff);}
\DoxyCodeLine{572             \}}
\DoxyCodeLine{573 }
\DoxyCodeLine{574             \textcolor{keywordflow}{if}(period!=0)}
\DoxyCodeLine{575             \{}
\DoxyCodeLine{576                 cptr-\/>portaperiod = period;}
\DoxyCodeLine{577                 cptr-\/>period = operiod;}
\DoxyCodeLine{578             \}}
\DoxyCodeLine{579         \textcolor{keywordflow}{break};}
\DoxyCodeLine{580 }
\DoxyCodeLine{581         \textcolor{keywordflow}{case} EFFECT\_VIBRATO:}
\DoxyCodeLine{582             \textcolor{comment}{/*}}
\DoxyCodeLine{583 \textcolor{comment}{            [4]: Vibrato}}
\DoxyCodeLine{584 \textcolor{comment}{            Where [4][x][y] means "{}oscillate the sample pitch using a}}
\DoxyCodeLine{585 \textcolor{comment}{            particular waveform with amplitude y/16 semitones, such that (x *}}
\DoxyCodeLine{586 \textcolor{comment}{            ticks)/64 cycles occur in the division"{}. The waveform is set using}}
\DoxyCodeLine{587 \textcolor{comment}{            effect [14][4]. By placing vibrato effects on consecutive}}
\DoxyCodeLine{588 \textcolor{comment}{            divisions, the vibrato effect can be maintained. If either x or y}}
\DoxyCodeLine{589 \textcolor{comment}{            are 0, then the old vibrato values will be used.}}
\DoxyCodeLine{590 \textcolor{comment}{            */}}
\DoxyCodeLine{591 }
\DoxyCodeLine{592             cptr-\/>effect = EFFECT\_VIBRATO;}
\DoxyCodeLine{593             \textcolor{keywordflow}{if}( ( effect \& 0x0F ) != 0 ) \textcolor{comment}{// Depth continue or change ?}}
\DoxyCodeLine{594                 cptr-\/>vibraparam = (cptr-\/>vibraparam \& 0xF0) | ( effect \& 0x0F );}
\DoxyCodeLine{595             \textcolor{keywordflow}{if}( ( effect \& 0xF0 ) != 0 ) \textcolor{comment}{// Speed continue or change ?}}
\DoxyCodeLine{596                 cptr-\/>vibraparam = (cptr-\/>vibraparam \& 0x0F) | ( effect \& 0xF0 );}
\DoxyCodeLine{597 }
\DoxyCodeLine{598         \textcolor{keywordflow}{break};}
\DoxyCodeLine{599 }
\DoxyCodeLine{600         \textcolor{keywordflow}{case} EFFECT\_VOLSLIDE\_TONEPORTA:}
\DoxyCodeLine{601             \textcolor{comment}{/*}}
\DoxyCodeLine{602 \textcolor{comment}{            [5]: Continue 'Slide to note', but also do Volume slide}}
\DoxyCodeLine{603 \textcolor{comment}{            Where [5][x][y] means "{}either slide the volume up x*(ticks -\/ 1) or}}
\DoxyCodeLine{604 \textcolor{comment}{            slide the volume down y*(ticks -\/ 1), at the same time as continuing}}
\DoxyCodeLine{605 \textcolor{comment}{            the last 'Slide to note'"{}. It is illegal for both x and y to be}}
\DoxyCodeLine{606 \textcolor{comment}{            non-\/zero. You cannot slide outside the volume range 0..64. The}}
\DoxyCodeLine{607 \textcolor{comment}{            period-\/length in this channel's division is a parameter to this}}
\DoxyCodeLine{608 \textcolor{comment}{            effect, and hence is not played.}}
\DoxyCodeLine{609 \textcolor{comment}{            */}}
\DoxyCodeLine{610 }
\DoxyCodeLine{611             \textcolor{keywordflow}{if}( period != 0 )}
\DoxyCodeLine{612             \{}
\DoxyCodeLine{613                 cptr-\/>portaperiod = period;}
\DoxyCodeLine{614                 cptr-\/>period = operiod;}
\DoxyCodeLine{615             \}}
\DoxyCodeLine{616 }
\DoxyCodeLine{617             cptr-\/>effect = EFFECT\_VOLSLIDE\_TONEPORTA;}
\DoxyCodeLine{618             \textcolor{keywordflow}{if}( ( effect \& 0xFF ) != 0 )}
\DoxyCodeLine{619                 cptr-\/>volumeslide = ( effect \& 0xFF );}
\DoxyCodeLine{620 }
\DoxyCodeLine{621         \textcolor{keywordflow}{break};}
\DoxyCodeLine{622 }
\DoxyCodeLine{623         \textcolor{keywordflow}{case} EFFECT\_VOLSLIDE\_VIBRATO:}
\DoxyCodeLine{624             \textcolor{comment}{/*}}
\DoxyCodeLine{625 \textcolor{comment}{            [6]: Continue 'Vibrato', but also do Volume slide}}
\DoxyCodeLine{626 \textcolor{comment}{            Where [6][x][y] means "{}either slide the volume up x*(ticks -\/ 1) or}}
\DoxyCodeLine{627 \textcolor{comment}{            slide the volume down y*(ticks -\/ 1), at the same time as continuing}}
\DoxyCodeLine{628 \textcolor{comment}{            the last 'Vibrato'"{}. It is illegal for both x and y to be non-\/zero.}}
\DoxyCodeLine{629 \textcolor{comment}{            You cannot slide outside the volume range 0..64.}}
\DoxyCodeLine{630 \textcolor{comment}{            */}}
\DoxyCodeLine{631 }
\DoxyCodeLine{632             cptr-\/>effect = EFFECT\_VOLSLIDE\_VIBRATO;}
\DoxyCodeLine{633             \textcolor{keywordflow}{if}( (effect \& 0xFF) != 0 )}
\DoxyCodeLine{634                 cptr-\/>volumeslide = (effect \& 0xFF);}
\DoxyCodeLine{635         \textcolor{keywordflow}{break};}
\DoxyCodeLine{636 }
\DoxyCodeLine{637         \textcolor{keywordflow}{case} EFFECT\_SET\_OFFSET:}
\DoxyCodeLine{638             \textcolor{comment}{/*}}
\DoxyCodeLine{639 \textcolor{comment}{            [9]: Set sample offset}}
\DoxyCodeLine{640 \textcolor{comment}{            Where [9][x][y] means "{}play the sample from offset x*4096 + y*256"{}.}}
\DoxyCodeLine{641 \textcolor{comment}{            The offset is measured in words. If no sample is given, yet one is}}
\DoxyCodeLine{642 \textcolor{comment}{            still playing on this channel, it should be retriggered to the new}}
\DoxyCodeLine{643 \textcolor{comment}{            offset using the current volume.}}
\DoxyCodeLine{644 \textcolor{comment}{            */}}
\DoxyCodeLine{645 }
\DoxyCodeLine{646             cptr-\/>samppos = ((effect>>4) * 4096) + ((effect\&0xF)*256);}
\DoxyCodeLine{647 }
\DoxyCodeLine{648         \textcolor{keywordflow}{break};}
\DoxyCodeLine{649 }
\DoxyCodeLine{650         \textcolor{keywordflow}{case} EFFECT\_VOLUME\_SLIDE:}
\DoxyCodeLine{651             \textcolor{comment}{/*}}
\DoxyCodeLine{652 \textcolor{comment}{            [10]: Volume slide}}
\DoxyCodeLine{653 \textcolor{comment}{            Where [10][x][y] means "{}either slide the volume up x*(ticks -\/ 1) or}}
\DoxyCodeLine{654 \textcolor{comment}{            slide the volume down y*(ticks -\/ 1)"{}. If both x and y are non-\/zero,}}
\DoxyCodeLine{655 \textcolor{comment}{            then the y value is ignored (assumed to be 0). You cannot slide}}
\DoxyCodeLine{656 \textcolor{comment}{            outside the volume range 0..64.}}
\DoxyCodeLine{657 \textcolor{comment}{            */}}
\DoxyCodeLine{658 }
\DoxyCodeLine{659             cptr-\/>effect = EFFECT\_VOLUME\_SLIDE;}
\DoxyCodeLine{660             cptr-\/>volumeslide = (effect \& 0xFF);}
\DoxyCodeLine{661         \textcolor{keywordflow}{break};}
\DoxyCodeLine{662 }
\DoxyCodeLine{663         \textcolor{keywordflow}{case} EFFECT\_JUMP\_POSITION:}
\DoxyCodeLine{664             \textcolor{comment}{/*}}
\DoxyCodeLine{665 \textcolor{comment}{            [11]: Position Jump}}
\DoxyCodeLine{666 \textcolor{comment}{            Where [11][x][y] means "{}stop the pattern after this division, and}}
\DoxyCodeLine{667 \textcolor{comment}{            continue the song at song-\/position x*16+y"{}. This shifts the}}
\DoxyCodeLine{668 \textcolor{comment}{            'pattern-\/cursor' in the pattern table (see above). Legal values for}}
\DoxyCodeLine{669 \textcolor{comment}{            x*16+y are from 0 to 127.}}
\DoxyCodeLine{670 \textcolor{comment}{            */}}
\DoxyCodeLine{671 }
\DoxyCodeLine{672             mod-\/>tablepos = (effect \& 0xFF);}
\DoxyCodeLine{673             \textcolor{keywordflow}{if}(mod-\/>tablepos >= mod-\/>song.length)}
\DoxyCodeLine{674             \{}
\DoxyCodeLine{675                 mod-\/>tablepos = 0;}
\DoxyCodeLine{676             \}}
\DoxyCodeLine{677             mod-\/>patternpos = 0;}
\DoxyCodeLine{678             mod-\/>jump\_loop\_effect = 1;}
\DoxyCodeLine{679 }
\DoxyCodeLine{680         \textcolor{keywordflow}{break};}
\DoxyCodeLine{681 }
\DoxyCodeLine{682         \textcolor{keywordflow}{case} EFFECT\_SET\_VOLUME:}
\DoxyCodeLine{683             \textcolor{comment}{/*}}
\DoxyCodeLine{684 \textcolor{comment}{            [12]: Set volume}}
\DoxyCodeLine{685 \textcolor{comment}{            Where [12][x][y] means "{}set current sample's volume to x*16+y"{}.}}
\DoxyCodeLine{686 \textcolor{comment}{            Legal volumes are 0..64.}}
\DoxyCodeLine{687 \textcolor{comment}{            */}}
\DoxyCodeLine{688 }
\DoxyCodeLine{689             cptr-\/>volume = (effect \& 0xFF);}
\DoxyCodeLine{690         \textcolor{keywordflow}{break};}
\DoxyCodeLine{691 }
\DoxyCodeLine{692         \textcolor{keywordflow}{case} EFFECT\_PATTERN\_BREAK:}
\DoxyCodeLine{693             \textcolor{comment}{/*}}
\DoxyCodeLine{694 \textcolor{comment}{            [13]: Pattern Break}}
\DoxyCodeLine{695 \textcolor{comment}{            Where [13][x][y] means "{}stop the pattern after this division, and}}
\DoxyCodeLine{696 \textcolor{comment}{            continue the song at the next pattern at division x*10+y"{} (the 10}}
\DoxyCodeLine{697 \textcolor{comment}{            is not a typo). Legal divisions are from 0 to 63 (note Protracker}}
\DoxyCodeLine{698 \textcolor{comment}{            exception above).}}
\DoxyCodeLine{699 \textcolor{comment}{            */}}
\DoxyCodeLine{700 }
\DoxyCodeLine{701             mod-\/>patternpos = ( ((effect>>4)\&0xF)*10 + (effect\&0xF) ) * mod-\/>number\_of\_channels;}
\DoxyCodeLine{702             mod-\/>jump\_loop\_effect = 1;}
\DoxyCodeLine{703             mod-\/>tablepos++;}
\DoxyCodeLine{704             \textcolor{keywordflow}{if}(mod-\/>tablepos >= mod-\/>song.length)}
\DoxyCodeLine{705             \{}
\DoxyCodeLine{706                 mod-\/>tablepos = 0;}
\DoxyCodeLine{707             \}}
\DoxyCodeLine{708 }
\DoxyCodeLine{709         \textcolor{keywordflow}{break};}
\DoxyCodeLine{710 }
\DoxyCodeLine{711         \textcolor{keywordflow}{case} EFFECT\_EXTENDED:}
\DoxyCodeLine{712             \textcolor{keywordflow}{switch}( (effect>>4) \& 0xF )}
\DoxyCodeLine{713             \{}
\DoxyCodeLine{714                 \textcolor{keywordflow}{case} EFFECT\_E\_FINE\_PORTA\_UP:}
\DoxyCodeLine{715                     \textcolor{comment}{/*}}
\DoxyCodeLine{716 \textcolor{comment}{                    [14][1]: Fineslide up}}
\DoxyCodeLine{717 \textcolor{comment}{                    Where [14][1][x] means "{}decrement the period of the current sample}}
\DoxyCodeLine{718 \textcolor{comment}{                    by x"{}. The incrementing takes place at the beginning of the}}
\DoxyCodeLine{719 \textcolor{comment}{                    division, and hence there is no actual sliding. You cannot slide}}
\DoxyCodeLine{720 \textcolor{comment}{                    beyond the note B3 (period 113).}}
\DoxyCodeLine{721 \textcolor{comment}{                    */}}
\DoxyCodeLine{722 }
\DoxyCodeLine{723                     cptr-\/>period -\/= (effect \& 0xF);}
\DoxyCodeLine{724                     \textcolor{keywordflow}{if}( cptr-\/>period < 113 )}
\DoxyCodeLine{725                         cptr-\/>period = 113;}
\DoxyCodeLine{726                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{727 }
\DoxyCodeLine{728                 \textcolor{keywordflow}{case} EFFECT\_E\_FINE\_PORTA\_DOWN:}
\DoxyCodeLine{729                     \textcolor{comment}{/*}}
\DoxyCodeLine{730 \textcolor{comment}{                    [14][2]: Fineslide down}}
\DoxyCodeLine{731 \textcolor{comment}{                    Where [14][2][x] means "{}increment the period of the current sample}}
\DoxyCodeLine{732 \textcolor{comment}{                    by x"{}. Similar to [14][1] but shifts the pitch down. You cannot}}
\DoxyCodeLine{733 \textcolor{comment}{                    slide beyond the note C1 (period 856).}}
\DoxyCodeLine{734 \textcolor{comment}{                    */}}
\DoxyCodeLine{735 }
\DoxyCodeLine{736                     cptr-\/>period += (effect \& 0xF);}
\DoxyCodeLine{737                     \textcolor{keywordflow}{if}( cptr-\/>period > 856 )}
\DoxyCodeLine{738                         cptr-\/>period = 856;}
\DoxyCodeLine{739                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{740 }
\DoxyCodeLine{741                 \textcolor{keywordflow}{case} EFFECT\_E\_FINE\_VOLSLIDE\_UP:}
\DoxyCodeLine{742                     \textcolor{comment}{/*}}
\DoxyCodeLine{743 \textcolor{comment}{                    [14][10]: Fine volume slide up}}
\DoxyCodeLine{744 \textcolor{comment}{                    Where [14][10][x] means "{}increment the volume of the current sample}}
\DoxyCodeLine{745 \textcolor{comment}{                    by x"{}. The incrementing takes place at the beginning of the}}
\DoxyCodeLine{746 \textcolor{comment}{                    division, and hence there is no sliding. You cannot slide beyond}}
\DoxyCodeLine{747 \textcolor{comment}{                    volume 64.}}
\DoxyCodeLine{748 \textcolor{comment}{                    */}}
\DoxyCodeLine{749 }
\DoxyCodeLine{750                     cptr-\/>volume += (effect \& 0xF);}
\DoxyCodeLine{751                     \textcolor{keywordflow}{if}( cptr-\/>volume>64 )}
\DoxyCodeLine{752                         cptr-\/>volume = 64;}
\DoxyCodeLine{753                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{754 }
\DoxyCodeLine{755                 \textcolor{keywordflow}{case} EFFECT\_E\_FINE\_VOLSLIDE\_DOWN:}
\DoxyCodeLine{756                     \textcolor{comment}{/*}}
\DoxyCodeLine{757 \textcolor{comment}{                    [14][11]: Fine volume slide down}}
\DoxyCodeLine{758 \textcolor{comment}{                    Where [14][11][x] means "{}decrement the volume of the current sample}}
\DoxyCodeLine{759 \textcolor{comment}{                    by x"{}. Similar to [14][10] but lowers volume. You cannot slide}}
\DoxyCodeLine{760 \textcolor{comment}{                    beyond volume 0.}}
\DoxyCodeLine{761 \textcolor{comment}{                    */}}
\DoxyCodeLine{762 }
\DoxyCodeLine{763                     cptr-\/>volume -\/= (effect \& 0xF);}
\DoxyCodeLine{764                     \textcolor{keywordflow}{if}( cptr-\/>volume > 200 )}
\DoxyCodeLine{765                         cptr-\/>volume = 0;}
\DoxyCodeLine{766                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{767 }
\DoxyCodeLine{768                 \textcolor{keywordflow}{case} EFFECT\_E\_PATTERN\_LOOP:}
\DoxyCodeLine{769                     \textcolor{comment}{/*}}
\DoxyCodeLine{770 \textcolor{comment}{                    [14][6]: Loop pattern}}
\DoxyCodeLine{771 \textcolor{comment}{                    Where [14][6][x] means "{}set the start of a loop to this division if}}
\DoxyCodeLine{772 \textcolor{comment}{                    x is 0, otherwise after this division, jump back to the start of a}}
\DoxyCodeLine{773 \textcolor{comment}{                    loop and play it another x times before continuing"{}. If the start}}
\DoxyCodeLine{774 \textcolor{comment}{                    of the loop was not set, it will default to the start of the}}
\DoxyCodeLine{775 \textcolor{comment}{                    current pattern. Hence 'loop pattern' cannot be performed across}}
\DoxyCodeLine{776 \textcolor{comment}{                    multiple patterns. Note that loops do not support nesting, and you}}
\DoxyCodeLine{777 \textcolor{comment}{                    may generate an infinite loop if you try to nest 'loop pattern's.}}
\DoxyCodeLine{778 \textcolor{comment}{                    */}}
\DoxyCodeLine{779 }
\DoxyCodeLine{780                     \textcolor{keywordflow}{if}( effect \& 0xF )}
\DoxyCodeLine{781                     \{}
\DoxyCodeLine{782                         \textcolor{keywordflow}{if}( cptr-\/>patternloopcnt )}
\DoxyCodeLine{783                         \{}
\DoxyCodeLine{784                             cptr-\/>patternloopcnt-\/-\/;}
\DoxyCodeLine{785                             \textcolor{keywordflow}{if}( cptr-\/>patternloopcnt )}
\DoxyCodeLine{786                             \{}
\DoxyCodeLine{787                                 mod-\/>patternpos = cptr-\/>patternloopstartpoint;}
\DoxyCodeLine{788                                 mod-\/>jump\_loop\_effect = 1;}
\DoxyCodeLine{789                             \}}
\DoxyCodeLine{790                             \textcolor{keywordflow}{else}}
\DoxyCodeLine{791                             \{}
\DoxyCodeLine{792                                 cptr-\/>patternloopstartpoint = mod-\/>patternpos ;}
\DoxyCodeLine{793                             \}}
\DoxyCodeLine{794                         \}}
\DoxyCodeLine{795                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{796                         \{}
\DoxyCodeLine{797                             cptr-\/>patternloopcnt = (effect \& 0xF);}
\DoxyCodeLine{798                             mod-\/>patternpos = cptr-\/>patternloopstartpoint;}
\DoxyCodeLine{799                             mod-\/>jump\_loop\_effect = 1;}
\DoxyCodeLine{800                         \}}
\DoxyCodeLine{801                     \}}
\DoxyCodeLine{802                     \textcolor{keywordflow}{else} \textcolor{comment}{// Start point}}
\DoxyCodeLine{803                     \{}
\DoxyCodeLine{804                         cptr-\/>patternloopstartpoint = mod-\/>patternpos;}
\DoxyCodeLine{805                     \}}
\DoxyCodeLine{806 }
\DoxyCodeLine{807                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{808 }
\DoxyCodeLine{809                 \textcolor{keywordflow}{case} EFFECT\_E\_PATTERN\_DELAY:}
\DoxyCodeLine{810                     \textcolor{comment}{/*}}
\DoxyCodeLine{811 \textcolor{comment}{                    [14][14]: Delay pattern}}
\DoxyCodeLine{812 \textcolor{comment}{                    Where [14][14][x] means "{}after this division there will be a delay}}
\DoxyCodeLine{813 \textcolor{comment}{                    equivalent to the time taken to play x divisions after which the}}
\DoxyCodeLine{814 \textcolor{comment}{                    pattern will be resumed"{}. The delay only relates to the}}
\DoxyCodeLine{815 \textcolor{comment}{                    interpreting of new divisions, and all effects and previous notes}}
\DoxyCodeLine{816 \textcolor{comment}{                    continue during delay.}}
\DoxyCodeLine{817 \textcolor{comment}{                    */}}
\DoxyCodeLine{818 }
\DoxyCodeLine{819                     mod-\/>patterndelay = (effect \& 0xF);}
\DoxyCodeLine{820                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{821 }
\DoxyCodeLine{822                 \textcolor{keywordflow}{case} EFFECT\_E\_NOTE\_CUT:}
\DoxyCodeLine{823                     \textcolor{comment}{/*}}
\DoxyCodeLine{824 \textcolor{comment}{                    [14][12]: Cut sample}}
\DoxyCodeLine{825 \textcolor{comment}{                    Where [14][12][x] means "{}after the current sample has been played}}
\DoxyCodeLine{826 \textcolor{comment}{                    for x ticks in this division, its volume will be set to 0"{}. This}}
\DoxyCodeLine{827 \textcolor{comment}{                    implies that if x is 0, then you will not hear any of the sample.}}
\DoxyCodeLine{828 \textcolor{comment}{                    If you wish to insert "{}silence"{} in a pattern, it is better to use a}}
\DoxyCodeLine{829 \textcolor{comment}{                    "{}silence"{}-\/sample (see above) due to the lack of proper support for}}
\DoxyCodeLine{830 \textcolor{comment}{                    this effect.}}
\DoxyCodeLine{831 \textcolor{comment}{                    */}}
\DoxyCodeLine{832                     cptr-\/>effect = EFFECT\_E\_NOTE\_CUT;}
\DoxyCodeLine{833                     cptr-\/>cut\_param = (effect \& 0xF);}
\DoxyCodeLine{834                     \textcolor{keywordflow}{if}(!cptr-\/>cut\_param)}
\DoxyCodeLine{835                         cptr-\/>volume = 0;}
\DoxyCodeLine{836                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{837 }
\DoxyCodeLine{838                 \textcolor{keywordflow}{default}:}
\DoxyCodeLine{839 }
\DoxyCodeLine{840                 \textcolor{keywordflow}{break};}
\DoxyCodeLine{841             \}}
\DoxyCodeLine{842         \textcolor{keywordflow}{break};}
\DoxyCodeLine{843 }
\DoxyCodeLine{844         \textcolor{keywordflow}{case} 0xF:}
\DoxyCodeLine{845             \textcolor{comment}{/*}}
\DoxyCodeLine{846 \textcolor{comment}{            [15]: Set speed}}
\DoxyCodeLine{847 \textcolor{comment}{            Where [15][x][y] means "{}set speed to x*16+y"{}. Though it is nowhere}}
\DoxyCodeLine{848 \textcolor{comment}{            near that simple. Let z = x*16+y. Depending on what values z takes,}}
\DoxyCodeLine{849 \textcolor{comment}{            different units of speed are set, there being two: ticks/division}}
\DoxyCodeLine{850 \textcolor{comment}{            and beats/minute (though this one is only a label and not strictly}}
\DoxyCodeLine{851 \textcolor{comment}{            true). If z=0, then what should technically happen is that the}}
\DoxyCodeLine{852 \textcolor{comment}{            module stops, but in practice it is treated as if z=1, because}}
\DoxyCodeLine{853 \textcolor{comment}{            there is already a method for stopping the module (running out of}}
\DoxyCodeLine{854 \textcolor{comment}{            patterns). If z<=32, then it means "{}set ticks/division to z"{}}}
\DoxyCodeLine{855 \textcolor{comment}{            otherwise it means "{}set beats/minute to z"{} (convention says that}}
\DoxyCodeLine{856 \textcolor{comment}{            this should read "{}If z<32.."{} but there are some composers out there}}
\DoxyCodeLine{857 \textcolor{comment}{            that defy conventions). Default values are 6 ticks/division, and}}
\DoxyCodeLine{858 \textcolor{comment}{            125 beats/minute (4 divisions = 1 beat). The beats/minute tag is}}
\DoxyCodeLine{859 \textcolor{comment}{            only meaningful for 6 ticks/division. To get a more accurate view}}
\DoxyCodeLine{860 \textcolor{comment}{            of how things work, use the following formula:}}
\DoxyCodeLine{861 \textcolor{comment}{                                     24 * beats/minute}}
\DoxyCodeLine{862 \textcolor{comment}{                  divisions/minute = -\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{863 \textcolor{comment}{                                      ticks/division}}
\DoxyCodeLine{864 \textcolor{comment}{            Hence divisions/minute range from 24.75 to 6120, eg. to get a value}}
\DoxyCodeLine{865 \textcolor{comment}{            of 2000 divisions/minute use 3 ticks/division and 250 beats/minute.}}
\DoxyCodeLine{866 \textcolor{comment}{            If multiple "{}set speed"{} effects are performed in a single division,}}
\DoxyCodeLine{867 \textcolor{comment}{            the ones on higher-\/numbered channels take precedence over the ones}}
\DoxyCodeLine{868 \textcolor{comment}{            on lower-\/numbered channels. This effect has a large number of}}
\DoxyCodeLine{869 \textcolor{comment}{            different implementations, but the one described here has the}}
\DoxyCodeLine{870 \textcolor{comment}{            widest usage.}}
\DoxyCodeLine{871 \textcolor{comment}{            */}}
\DoxyCodeLine{872 }
\DoxyCodeLine{873             \textcolor{keywordflow}{if}( (effect\&0xFF) < 0x21 )}
\DoxyCodeLine{874             \{}
\DoxyCodeLine{875                 \textcolor{keywordflow}{if}( effect\&0xFF )}
\DoxyCodeLine{876                 \{}
\DoxyCodeLine{877                     mod-\/>song.speed = effect\&0xFF;}
\DoxyCodeLine{878                     mod-\/>patternticksaim = (long)mod-\/>song.speed * ((mod-\/>playrate * 5 ) / (((long)2 * (\textcolor{keywordtype}{long})mod-\/>bpm)));}
\DoxyCodeLine{879                 \}}
\DoxyCodeLine{880             \}}
\DoxyCodeLine{881 }
\DoxyCodeLine{882             \textcolor{keywordflow}{if}( (effect\&0xFF) >= 0x21 )}
\DoxyCodeLine{883             \{}
\DoxyCodeLine{885                 mod-\/>bpm = effect\&0xFF;}
\DoxyCodeLine{886                 mod-\/>patternticksaim = (long)mod-\/>song.speed * ((mod-\/>playrate * 5 ) / (((long)2 * (\textcolor{keywordtype}{long})mod-\/>bpm)));}
\DoxyCodeLine{887             \}}
\DoxyCodeLine{888 }
\DoxyCodeLine{889         \textcolor{keywordflow}{break};}
\DoxyCodeLine{890 }
\DoxyCodeLine{891         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{892         \textcolor{comment}{// Unsupported effect}}
\DoxyCodeLine{893         \textcolor{keywordflow}{break};}
\DoxyCodeLine{894 }
\DoxyCodeLine{895     \}}
\DoxyCodeLine{896 }
\DoxyCodeLine{897 \}}
\DoxyCodeLine{898 }
\DoxyCodeLine{899 \textcolor{keyword}{static} \textcolor{keywordtype}{void} workeffect( \mbox{\hyperlink{structnote}{note}} * nptr, \mbox{\hyperlink{structchannel}{channel}} * cptr )}
\DoxyCodeLine{900 \{}
\DoxyCodeLine{901     \textcolor{keywordflow}{switch}(cptr-\/>effect)}
\DoxyCodeLine{902     \{}
\DoxyCodeLine{903         \textcolor{keywordflow}{case} EFFECT\_ARPEGGIO:}
\DoxyCodeLine{904 }
\DoxyCodeLine{905             \textcolor{keywordflow}{if}( cptr-\/>parameffect )}
\DoxyCodeLine{906             \{}
\DoxyCodeLine{907                 cptr-\/>decalperiod = cptr-\/>period -\/ cptr-\/>Arpperiods[cptr-\/>ArpIndex];}
\DoxyCodeLine{908 }
\DoxyCodeLine{909                 cptr-\/>ArpIndex++;}
\DoxyCodeLine{910                 \textcolor{keywordflow}{if}( cptr-\/>ArpIndex>2 )}
\DoxyCodeLine{911                     cptr-\/>ArpIndex = 0;}
\DoxyCodeLine{912             \}}
\DoxyCodeLine{913         \textcolor{keywordflow}{break};}
\DoxyCodeLine{914 }
\DoxyCodeLine{915         \textcolor{keywordflow}{case} EFFECT\_PORTAMENTO\_UP:}
\DoxyCodeLine{916 }
\DoxyCodeLine{917             \textcolor{keywordflow}{if}(cptr-\/>period)}
\DoxyCodeLine{918             \{}
\DoxyCodeLine{919                 cptr-\/>period -\/= cptr-\/>parameffect;}
\DoxyCodeLine{920 }
\DoxyCodeLine{921                 \textcolor{keywordflow}{if}( cptr-\/>period < 113 || cptr-\/>period > 20000 )}
\DoxyCodeLine{922                     cptr-\/>period = 113;}
\DoxyCodeLine{923             \}}
\DoxyCodeLine{924 }
\DoxyCodeLine{925         \textcolor{keywordflow}{break};}
\DoxyCodeLine{926 }
\DoxyCodeLine{927         \textcolor{keywordflow}{case} EFFECT\_PORTAMENTO\_DOWN:}
\DoxyCodeLine{928 }
\DoxyCodeLine{929             \textcolor{keywordflow}{if}(cptr-\/>period)}
\DoxyCodeLine{930             \{}
\DoxyCodeLine{931                 cptr-\/>period += cptr-\/>parameffect;}
\DoxyCodeLine{932 }
\DoxyCodeLine{933                 \textcolor{keywordflow}{if}( cptr-\/>period > 20000 )}
\DoxyCodeLine{934                     cptr-\/>period = 20000;}
\DoxyCodeLine{935             \}}
\DoxyCodeLine{936 }
\DoxyCodeLine{937         \textcolor{keywordflow}{break};}
\DoxyCodeLine{938 }
\DoxyCodeLine{939         \textcolor{keywordflow}{case} EFFECT\_VOLSLIDE\_TONEPORTA:}
\DoxyCodeLine{940         \textcolor{keywordflow}{case} EFFECT\_TONE\_PORTAMENTO:}
\DoxyCodeLine{941 }
\DoxyCodeLine{942             \textcolor{keywordflow}{if}( cptr-\/>period \&\& ( cptr-\/>period != cptr-\/>portaperiod ) \&\& cptr-\/>portaperiod )}
\DoxyCodeLine{943             \{}
\DoxyCodeLine{944                 \textcolor{keywordflow}{if}( cptr-\/>period > cptr-\/>portaperiod )}
\DoxyCodeLine{945                 \{}
\DoxyCodeLine{946                     \textcolor{keywordflow}{if}( cptr-\/>period -\/ cptr-\/>portaperiod >= cptr-\/>portaspeed )}
\DoxyCodeLine{947                     \{}
\DoxyCodeLine{948                         cptr-\/>period -\/= cptr-\/>portaspeed;}
\DoxyCodeLine{949                     \}}
\DoxyCodeLine{950                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{951                     \{}
\DoxyCodeLine{952                         cptr-\/>period = cptr-\/>portaperiod;}
\DoxyCodeLine{953                     \}}
\DoxyCodeLine{954                 \}}
\DoxyCodeLine{955                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{956                 \{}
\DoxyCodeLine{957                     \textcolor{keywordflow}{if}( cptr-\/>portaperiod -\/ cptr-\/>period >= cptr-\/>portaspeed )}
\DoxyCodeLine{958                     \{}
\DoxyCodeLine{959                         cptr-\/>period += cptr-\/>portaspeed;}
\DoxyCodeLine{960                     \}}
\DoxyCodeLine{961                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{962                     \{}
\DoxyCodeLine{963                         cptr-\/>period = cptr-\/>portaperiod;}
\DoxyCodeLine{964                     \}}
\DoxyCodeLine{965                 \}}
\DoxyCodeLine{966 }
\DoxyCodeLine{967                 \textcolor{keywordflow}{if}( cptr-\/>period == cptr-\/>portaperiod )}
\DoxyCodeLine{968                 \{}
\DoxyCodeLine{969                     \textcolor{comment}{// If the slide is over, don't let it to be retriggered.}}
\DoxyCodeLine{970                     cptr-\/>portaperiod = 0;}
\DoxyCodeLine{971                 \}}
\DoxyCodeLine{972             \}}
\DoxyCodeLine{973 }
\DoxyCodeLine{974             \textcolor{keywordflow}{if}( cptr-\/>effect == EFFECT\_VOLSLIDE\_TONEPORTA )}
\DoxyCodeLine{975             \{}
\DoxyCodeLine{976                 \textcolor{keywordflow}{if}( cptr-\/>volumeslide > 0x0F )}
\DoxyCodeLine{977                 \{}
\DoxyCodeLine{978                     cptr-\/>volume = cptr-\/>volume + (cptr-\/>volumeslide>>4);}
\DoxyCodeLine{979 }
\DoxyCodeLine{980                     \textcolor{keywordflow}{if}(cptr-\/>volume>63)}
\DoxyCodeLine{981                         cptr-\/>volume = 63;}
\DoxyCodeLine{982                 \}}
\DoxyCodeLine{983                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{984                 \{}
\DoxyCodeLine{985                     cptr-\/>volume = cptr-\/>volume -\/ (cptr-\/>volumeslide);}
\DoxyCodeLine{986 }
\DoxyCodeLine{987                     \textcolor{keywordflow}{if}(cptr-\/>volume>63)}
\DoxyCodeLine{988                         cptr-\/>volume=0;}
\DoxyCodeLine{989                 \}}
\DoxyCodeLine{990             \}}
\DoxyCodeLine{991         \textcolor{keywordflow}{break};}
\DoxyCodeLine{992 }
\DoxyCodeLine{993         \textcolor{keywordflow}{case} EFFECT\_VOLSLIDE\_VIBRATO:}
\DoxyCodeLine{994         \textcolor{keywordflow}{case} EFFECT\_VIBRATO:}
\DoxyCodeLine{995 }
\DoxyCodeLine{996             cptr-\/>vibraperiod = ( (cptr-\/>vibraparam\&0xF) * sintable[cptr-\/>vibrapointeur\&0x1F] )>>7;}
\DoxyCodeLine{997 }
\DoxyCodeLine{998             \textcolor{keywordflow}{if}( cptr-\/>vibrapointeur > 31 )}
\DoxyCodeLine{999                 cptr-\/>vibraperiod = -\/cptr-\/>vibraperiod;}
\DoxyCodeLine{1000 }
\DoxyCodeLine{1001             cptr-\/>vibrapointeur = (cptr-\/>vibrapointeur+(((cptr-\/>vibraparam>>4))\&0xf)) \& 0x3F;}
\DoxyCodeLine{1002 }
\DoxyCodeLine{1003             \textcolor{keywordflow}{if}( cptr-\/>effect == EFFECT\_VOLSLIDE\_VIBRATO )}
\DoxyCodeLine{1004             \{}
\DoxyCodeLine{1005                 \textcolor{keywordflow}{if}( cptr-\/>volumeslide > 0xF )}
\DoxyCodeLine{1006                 \{}
\DoxyCodeLine{1007                     cptr-\/>volume = cptr-\/>volume+(cptr-\/>volumeslide>>4);}
\DoxyCodeLine{1008 }
\DoxyCodeLine{1009                     \textcolor{keywordflow}{if}( cptr-\/>volume > 64 )}
\DoxyCodeLine{1010                         cptr-\/>volume = 64;}
\DoxyCodeLine{1011                 \}}
\DoxyCodeLine{1012                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{1013                 \{}
\DoxyCodeLine{1014                     cptr-\/>volume = cptr-\/>volume -\/ cptr-\/>volumeslide;}
\DoxyCodeLine{1015 }
\DoxyCodeLine{1016                     \textcolor{keywordflow}{if}( cptr-\/>volume > 64 )}
\DoxyCodeLine{1017                         cptr-\/>volume = 0;}
\DoxyCodeLine{1018                 \}}
\DoxyCodeLine{1019             \}}
\DoxyCodeLine{1020 }
\DoxyCodeLine{1021         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1022 }
\DoxyCodeLine{1023         \textcolor{keywordflow}{case} EFFECT\_VOLUME\_SLIDE:}
\DoxyCodeLine{1024 }
\DoxyCodeLine{1025             \textcolor{keywordflow}{if}( cptr-\/>volumeslide > 0xF )}
\DoxyCodeLine{1026             \{}
\DoxyCodeLine{1027                 cptr-\/>volume += (cptr-\/>volumeslide>>4);}
\DoxyCodeLine{1028 }
\DoxyCodeLine{1029                 \textcolor{keywordflow}{if}( cptr-\/>volume > 64 )}
\DoxyCodeLine{1030                     cptr-\/>volume = 64;}
\DoxyCodeLine{1031             \}}
\DoxyCodeLine{1032             \textcolor{keywordflow}{else}}
\DoxyCodeLine{1033             \{}
\DoxyCodeLine{1034                 cptr-\/>volume -\/= (cptr-\/>volumeslide\&0xf);}
\DoxyCodeLine{1035 }
\DoxyCodeLine{1036                 \textcolor{keywordflow}{if}( cptr-\/>volume > 64 )}
\DoxyCodeLine{1037                     cptr-\/>volume = 0;}
\DoxyCodeLine{1038             \}}
\DoxyCodeLine{1039         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1040 }
\DoxyCodeLine{1041         \textcolor{keywordflow}{case} EFFECT\_E\_NOTE\_CUT:}
\DoxyCodeLine{1042             \textcolor{keywordflow}{if}(cptr-\/>cut\_param)}
\DoxyCodeLine{1043                 cptr-\/>cut\_param-\/-\/;}
\DoxyCodeLine{1044 }
\DoxyCodeLine{1045             \textcolor{keywordflow}{if}(!cptr-\/>cut\_param)}
\DoxyCodeLine{1046                 cptr-\/>volume = 0;}
\DoxyCodeLine{1047         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1048 }
\DoxyCodeLine{1049         \textcolor{keywordflow}{default}:}
\DoxyCodeLine{1050         \textcolor{keywordflow}{break};}
\DoxyCodeLine{1051 }
\DoxyCodeLine{1052     \}}
\DoxyCodeLine{1053 }
\DoxyCodeLine{1054 \}}
\DoxyCodeLine{1055 }
\DoxyCodeLine{1057 \textcolor{keywordtype}{bool} jar\_mod\_init(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx)}
\DoxyCodeLine{1058 \{}
\DoxyCodeLine{1059     muint i,j;}
\DoxyCodeLine{1060 }
\DoxyCodeLine{1061     \textcolor{keywordflow}{if}( modctx )}
\DoxyCodeLine{1062     \{}
\DoxyCodeLine{1063         memclear(modctx, 0, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}}));}
\DoxyCodeLine{1064         modctx-\/>playrate = DEFAULT\_SAMPLE\_RATE;}
\DoxyCodeLine{1065         modctx-\/>stereo = 1;}
\DoxyCodeLine{1066         modctx-\/>stereo\_separation = 1;}
\DoxyCodeLine{1067         modctx-\/>bits = 16;}
\DoxyCodeLine{1068         modctx-\/>filter = 1;}
\DoxyCodeLine{1069 }
\DoxyCodeLine{1070         \textcolor{keywordflow}{for}(i=0; i < PERIOD\_TABLE\_LENGTH -\/ 1; i++)}
\DoxyCodeLine{1071         \{}
\DoxyCodeLine{1072             \textcolor{keywordflow}{for}(j=0; j < 8; j++)}
\DoxyCodeLine{1073             \{}
\DoxyCodeLine{1074                 modctx-\/>fullperiod[(i*8) + j] = periodtable[i] -\/ ((( periodtable[i] -\/ periodtable[i+1] ) / 8) * j);}
\DoxyCodeLine{1075             \}}
\DoxyCodeLine{1076         \}}
\DoxyCodeLine{1077 }
\DoxyCodeLine{1078         \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{1079     \}}
\DoxyCodeLine{1080 }
\DoxyCodeLine{1081     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1082 \}}
\DoxyCodeLine{1083 }
\DoxyCodeLine{1084 \textcolor{keywordtype}{bool} jar\_mod\_setcfg(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx, \textcolor{keywordtype}{int} samplerate, \textcolor{keywordtype}{int} bits, \textcolor{keywordtype}{int} stereo, \textcolor{keywordtype}{int} stereo\_separation, \textcolor{keywordtype}{int} filter)}
\DoxyCodeLine{1085 \{}
\DoxyCodeLine{1086     \textcolor{keywordflow}{if}( modctx )}
\DoxyCodeLine{1087     \{}
\DoxyCodeLine{1088         modctx-\/>playrate = samplerate;}
\DoxyCodeLine{1089 }
\DoxyCodeLine{1090         \textcolor{keywordflow}{if}( stereo )}
\DoxyCodeLine{1091             modctx-\/>stereo = 1;}
\DoxyCodeLine{1092         \textcolor{keywordflow}{else}}
\DoxyCodeLine{1093             modctx-\/>stereo = 0;}
\DoxyCodeLine{1094             }
\DoxyCodeLine{1095         \textcolor{keywordflow}{if}(stereo\_separation < 4)}
\DoxyCodeLine{1096         \{}
\DoxyCodeLine{1097             modctx-\/>stereo\_separation = stereo\_separation;}
\DoxyCodeLine{1098         \}}
\DoxyCodeLine{1099 }
\DoxyCodeLine{1100         \textcolor{keywordflow}{if}( bits == 8 || bits == 16 )}
\DoxyCodeLine{1101             modctx-\/>bits = bits;}
\DoxyCodeLine{1102         \textcolor{keywordflow}{else}}
\DoxyCodeLine{1103             modctx-\/>bits = 16;}
\DoxyCodeLine{1104 }
\DoxyCodeLine{1105         \textcolor{keywordflow}{if}( filter )}
\DoxyCodeLine{1106             modctx-\/>filter = 1;}
\DoxyCodeLine{1107         \textcolor{keywordflow}{else}}
\DoxyCodeLine{1108             modctx-\/>filter = 0;}
\DoxyCodeLine{1109 }
\DoxyCodeLine{1110         \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{1111     \}}
\DoxyCodeLine{1112 }
\DoxyCodeLine{1113     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1114 \}}
\DoxyCodeLine{1115 }
\DoxyCodeLine{1116 \textcolor{comment}{// make certain that mod\_data stays in memory while playing}}
\DoxyCodeLine{1117 \textcolor{keyword}{static} \textcolor{keywordtype}{bool} jar\_mod\_load( \mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx, \textcolor{keywordtype}{void} * mod\_data, \textcolor{keywordtype}{int} mod\_data\_size )}
\DoxyCodeLine{1118 \{}
\DoxyCodeLine{1119     muint i, max;}
\DoxyCodeLine{1120     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{short} t;}
\DoxyCodeLine{1121     \mbox{\hyperlink{structsample}{sample}} *sptr;}
\DoxyCodeLine{1122     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} * modmemory,* endmodmemory;}
\DoxyCodeLine{1123 }
\DoxyCodeLine{1124     modmemory = (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} *)mod\_data;}
\DoxyCodeLine{1125     endmodmemory = modmemory + mod\_data\_size;}
\DoxyCodeLine{1126     }
\DoxyCodeLine{1127     }
\DoxyCodeLine{1128 }
\DoxyCodeLine{1129     \textcolor{keywordflow}{if}(modmemory)}
\DoxyCodeLine{1130     \{}
\DoxyCodeLine{1131         \textcolor{keywordflow}{if}( modctx )}
\DoxyCodeLine{1132         \{}
\DoxyCodeLine{1133             memcopy(\&(modctx-\/>song.title),modmemory,1084);}
\DoxyCodeLine{1134 }
\DoxyCodeLine{1135             i = 0;}
\DoxyCodeLine{1136             modctx-\/>number\_of\_channels = 0;}
\DoxyCodeLine{1137             \textcolor{keywordflow}{while}(modlist[i].numberofchannels)}
\DoxyCodeLine{1138             \{}
\DoxyCodeLine{1139                 \textcolor{keywordflow}{if}(memcompare(modctx-\/>song.signature,modlist[i].signature,4))}
\DoxyCodeLine{1140                 \{}
\DoxyCodeLine{1141                     modctx-\/>number\_of\_channels = modlist[i].numberofchannels;}
\DoxyCodeLine{1142                 \}}
\DoxyCodeLine{1143 }
\DoxyCodeLine{1144                 i++;}
\DoxyCodeLine{1145             \}}
\DoxyCodeLine{1146 }
\DoxyCodeLine{1147             \textcolor{keywordflow}{if}( !modctx-\/>number\_of\_channels )}
\DoxyCodeLine{1148             \{}
\DoxyCodeLine{1149                 \textcolor{comment}{// 15 Samples modules support}}
\DoxyCodeLine{1150                 \textcolor{comment}{// Shift the whole datas to make it look likes a standard 4 channels mod.}}
\DoxyCodeLine{1151                 memcopy(\&(modctx-\/>song.signature), \textcolor{stringliteral}{"{}M.K."{}}, 4);}
\DoxyCodeLine{1152                 memcopy(\&(modctx-\/>song.length), \&(modctx-\/>song.samples[15]), 130);}
\DoxyCodeLine{1153                 memclear(\&(modctx-\/>song.samples[15]), 0, 480);}
\DoxyCodeLine{1154                 modmemory += 600;}
\DoxyCodeLine{1155                 modctx-\/>number\_of\_channels = 4;}
\DoxyCodeLine{1156             \}}
\DoxyCodeLine{1157             \textcolor{keywordflow}{else}}
\DoxyCodeLine{1158             \{}
\DoxyCodeLine{1159                 modmemory += 1084;}
\DoxyCodeLine{1160             \}}
\DoxyCodeLine{1161 }
\DoxyCodeLine{1162             \textcolor{keywordflow}{if}( modmemory >= endmodmemory )}
\DoxyCodeLine{1163                 \textcolor{keywordflow}{return} 0; \textcolor{comment}{// End passed ? -\/ Probably a bad file !}}
\DoxyCodeLine{1164 }
\DoxyCodeLine{1165             \textcolor{comment}{// Patterns loading}}
\DoxyCodeLine{1166             \textcolor{keywordflow}{for} (i = max = 0; i < 128; i++)}
\DoxyCodeLine{1167             \{}
\DoxyCodeLine{1168                 \textcolor{keywordflow}{while} (max <= modctx-\/>song.patterntable[i])}
\DoxyCodeLine{1169                 \{}
\DoxyCodeLine{1170                     modctx-\/>patterndata[max] = (\mbox{\hyperlink{structnote}{note}}*)modmemory;}
\DoxyCodeLine{1171                     modmemory += (256*modctx-\/>number\_of\_channels);}
\DoxyCodeLine{1172                     max++;}
\DoxyCodeLine{1173 }
\DoxyCodeLine{1174                     \textcolor{keywordflow}{if}( modmemory >= endmodmemory )}
\DoxyCodeLine{1175                         \textcolor{keywordflow}{return} 0; \textcolor{comment}{// End passed ? -\/ Probably a bad file !}}
\DoxyCodeLine{1176                 \}}
\DoxyCodeLine{1177             \}}
\DoxyCodeLine{1178 }
\DoxyCodeLine{1179             \textcolor{keywordflow}{for} (i = 0; i < 31; i++)}
\DoxyCodeLine{1180                 modctx-\/>sampledata[i]=0;}
\DoxyCodeLine{1181 }
\DoxyCodeLine{1182             \textcolor{comment}{// Samples loading}}
\DoxyCodeLine{1183             for (i = 0, sptr = modctx-\/>song.samples; i <31; i++, sptr++)}
\DoxyCodeLine{1184             \{}
\DoxyCodeLine{1185                 t= (sptr-\/>length \&0xFF00)>>8 | (sptr-\/>length \&0xFF)<<8;}
\DoxyCodeLine{1186                 sptr-\/>length = t*2;}
\DoxyCodeLine{1187 }
\DoxyCodeLine{1188                 t= (sptr-\/>reppnt \&0xFF00)>>8 | (sptr-\/>reppnt \&0xFF)<<8;}
\DoxyCodeLine{1189                 sptr-\/>reppnt = t*2;}
\DoxyCodeLine{1190 }
\DoxyCodeLine{1191                 t= (sptr-\/>replen \&0xFF00)>>8 | (sptr-\/>replen \&0xFF)<<8;}
\DoxyCodeLine{1192                 sptr-\/>replen = t*2;}
\DoxyCodeLine{1193 }
\DoxyCodeLine{1194 }
\DoxyCodeLine{1195                 \textcolor{keywordflow}{if} (sptr-\/>length == 0) \textcolor{keywordflow}{continue};}
\DoxyCodeLine{1196 }
\DoxyCodeLine{1197                 modctx-\/>sampledata[i] = (\textcolor{keywordtype}{char}*)modmemory;}
\DoxyCodeLine{1198                 modmemory += sptr-\/>length;}
\DoxyCodeLine{1199 }
\DoxyCodeLine{1200                 \textcolor{keywordflow}{if} (sptr-\/>replen + sptr-\/>reppnt > sptr-\/>length)}
\DoxyCodeLine{1201                     sptr-\/>replen = sptr-\/>length -\/ sptr-\/>reppnt;}
\DoxyCodeLine{1202 }
\DoxyCodeLine{1203                 \textcolor{keywordflow}{if}( modmemory > endmodmemory )}
\DoxyCodeLine{1204                     \textcolor{keywordflow}{return} 0; \textcolor{comment}{// End passed ? -\/ Probably a bad file !}}
\DoxyCodeLine{1205             \}}
\DoxyCodeLine{1206 }
\DoxyCodeLine{1207             \textcolor{comment}{// States init}}
\DoxyCodeLine{1208 }
\DoxyCodeLine{1209             modctx-\/>tablepos = 0;}
\DoxyCodeLine{1210             modctx-\/>patternpos = 0;}
\DoxyCodeLine{1211             modctx-\/>song.speed = 6;}
\DoxyCodeLine{1212             modctx-\/>bpm = 125;}
\DoxyCodeLine{1213             modctx-\/>samplenb = 0;}
\DoxyCodeLine{1214 }
\DoxyCodeLine{1215             modctx-\/>patternticks = (((long)modctx-\/>song.speed * modctx-\/>playrate * 5)/ (2 * modctx-\/>bpm)) + 1;}
\DoxyCodeLine{1216             modctx-\/>patternticksaim = ((long)modctx-\/>song.speed * modctx-\/>playrate * 5) / (2 * modctx-\/>bpm);}
\DoxyCodeLine{1217 }
\DoxyCodeLine{1218             modctx-\/>sampleticksconst = 3546894UL / modctx-\/>playrate; \textcolor{comment}{//8448*428/playrate;}}
\DoxyCodeLine{1219 }
\DoxyCodeLine{1220             \textcolor{keywordflow}{for}(i=0; i < modctx-\/>number\_of\_channels; i++)}
\DoxyCodeLine{1221             \{}
\DoxyCodeLine{1222                 modctx-\/>channels[i].volume = 0;}
\DoxyCodeLine{1223                 modctx-\/>channels[i].period = 0;}
\DoxyCodeLine{1224             \}}
\DoxyCodeLine{1225 }
\DoxyCodeLine{1226             modctx-\/>mod\_loaded = 1;}
\DoxyCodeLine{1227 }
\DoxyCodeLine{1228             \textcolor{keywordflow}{return} 1;}
\DoxyCodeLine{1229         \}}
\DoxyCodeLine{1230     \}}
\DoxyCodeLine{1231 }
\DoxyCodeLine{1232     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1233 \}}
\DoxyCodeLine{1234 }
\DoxyCodeLine{1235 \textcolor{keywordtype}{void} jar\_mod\_fillbuffer( \mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx, \textcolor{keywordtype}{short} * outbuffer, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} nbsample, \mbox{\hyperlink{structjar__mod__tracker__buffer__state__}{jar\_mod\_tracker\_buffer\_state}} * trkbuf )}
\DoxyCodeLine{1236 \{}
\DoxyCodeLine{1237     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} i, j;}
\DoxyCodeLine{1238     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} k;}
\DoxyCodeLine{1239     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} c;}
\DoxyCodeLine{1240     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} state\_remaining\_steps;}
\DoxyCodeLine{1241     \textcolor{keywordtype}{int} l,r;}
\DoxyCodeLine{1242     \textcolor{keywordtype}{int} ll,lr;}
\DoxyCodeLine{1243     \textcolor{keywordtype}{int} tl,tr;}
\DoxyCodeLine{1244     \textcolor{keywordtype}{short} finalperiod;}
\DoxyCodeLine{1245     \mbox{\hyperlink{structnote}{note}}    *nptr;}
\DoxyCodeLine{1246     \mbox{\hyperlink{structchannel}{channel}} *cptr;}
\DoxyCodeLine{1247 }
\DoxyCodeLine{1248     \textcolor{keywordflow}{if}( modctx \&\& outbuffer )}
\DoxyCodeLine{1249     \{}
\DoxyCodeLine{1250         \textcolor{keywordflow}{if}(modctx-\/>mod\_loaded)}
\DoxyCodeLine{1251         \{}
\DoxyCodeLine{1252             state\_remaining\_steps = 0;}
\DoxyCodeLine{1253 }
\DoxyCodeLine{1254             \textcolor{keywordflow}{if}( trkbuf )}
\DoxyCodeLine{1255             \{}
\DoxyCodeLine{1256                 trkbuf-\/>cur\_rd\_index = 0;}
\DoxyCodeLine{1257 }
\DoxyCodeLine{1258                 memcopy(trkbuf-\/>name,modctx-\/>song.title,\textcolor{keyword}{sizeof}(modctx-\/>song.title));}
\DoxyCodeLine{1259 }
\DoxyCodeLine{1260                 \textcolor{keywordflow}{for}(i=0;i<31;i++)}
\DoxyCodeLine{1261                 \{}
\DoxyCodeLine{1262                     memcopy(trkbuf-\/>instruments[i].name,modctx-\/>song.samples[i].name,\textcolor{keyword}{sizeof}(trkbuf-\/>instruments[i].name));}
\DoxyCodeLine{1263                 \}}
\DoxyCodeLine{1264             \}}
\DoxyCodeLine{1265 }
\DoxyCodeLine{1266             ll = modctx-\/>last\_l\_sample;}
\DoxyCodeLine{1267             lr = modctx-\/>last\_r\_sample;}
\DoxyCodeLine{1268 }
\DoxyCodeLine{1269             \textcolor{keywordflow}{for} (i = 0; i < nbsample; i++)}
\DoxyCodeLine{1270             \{}
\DoxyCodeLine{1271                 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{1272                 \textcolor{keywordflow}{if}( modctx-\/>patternticks++ > modctx-\/>patternticksaim )}
\DoxyCodeLine{1273                 \{}
\DoxyCodeLine{1274                     \textcolor{keywordflow}{if}( !modctx-\/>patterndelay )}
\DoxyCodeLine{1275                     \{}
\DoxyCodeLine{1276                         nptr = modctx-\/>patterndata[modctx-\/>song.patterntable[modctx-\/>tablepos]];}
\DoxyCodeLine{1277                         nptr = nptr + modctx-\/>patternpos;}
\DoxyCodeLine{1278                         cptr = modctx-\/>channels;}
\DoxyCodeLine{1279 }
\DoxyCodeLine{1280                         modctx-\/>patternticks = 0;}
\DoxyCodeLine{1281                         modctx-\/>patterntickse = 0;}
\DoxyCodeLine{1282 }
\DoxyCodeLine{1283                         \textcolor{keywordflow}{for}(c=0;c<modctx-\/>number\_of\_channels;c++)}
\DoxyCodeLine{1284                         \{}
\DoxyCodeLine{1285                             worknote((\mbox{\hyperlink{structnote}{note}}*)(nptr+c), (\mbox{\hyperlink{structchannel}{channel}}*)(cptr+c),(\textcolor{keywordtype}{char})(c+1),modctx);}
\DoxyCodeLine{1286                         \}}
\DoxyCodeLine{1287 }
\DoxyCodeLine{1288                         \textcolor{keywordflow}{if}( !modctx-\/>jump\_loop\_effect )}
\DoxyCodeLine{1289                             modctx-\/>patternpos += modctx-\/>number\_of\_channels;}
\DoxyCodeLine{1290                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{1291                             modctx-\/>jump\_loop\_effect = 0;}
\DoxyCodeLine{1292 }
\DoxyCodeLine{1293                         \textcolor{keywordflow}{if}( modctx-\/>patternpos == 64*modctx-\/>number\_of\_channels )}
\DoxyCodeLine{1294                         \{}
\DoxyCodeLine{1295                             modctx-\/>tablepos++;}
\DoxyCodeLine{1296                             modctx-\/>patternpos = 0;}
\DoxyCodeLine{1297                             \textcolor{keywordflow}{if}(modctx-\/>tablepos >= modctx-\/>song.length)}
\DoxyCodeLine{1298                             \{}
\DoxyCodeLine{1299                                 modctx-\/>tablepos = 0;}
\DoxyCodeLine{1300                                 modctx-\/>loopcount++; \textcolor{comment}{// count next loop}}
\DoxyCodeLine{1301                             \}}
\DoxyCodeLine{1302                         \}}
\DoxyCodeLine{1303                     \}}
\DoxyCodeLine{1304                     \textcolor{keywordflow}{else}}
\DoxyCodeLine{1305                     \{}
\DoxyCodeLine{1306                         modctx-\/>patterndelay-\/-\/;}
\DoxyCodeLine{1307                         modctx-\/>patternticks = 0;}
\DoxyCodeLine{1308                         modctx-\/>patterntickse = 0;}
\DoxyCodeLine{1309                     \}}
\DoxyCodeLine{1310 }
\DoxyCodeLine{1311                 \}}
\DoxyCodeLine{1312 }
\DoxyCodeLine{1313                 \textcolor{keywordflow}{if}( modctx-\/>patterntickse++ > (modctx-\/>patternticksaim/modctx-\/>song.speed) )}
\DoxyCodeLine{1314                 \{}
\DoxyCodeLine{1315                     nptr = modctx-\/>patterndata[modctx-\/>song.patterntable[modctx-\/>tablepos]];}
\DoxyCodeLine{1316                     nptr = nptr + modctx-\/>patternpos;}
\DoxyCodeLine{1317                     cptr = modctx-\/>channels;}
\DoxyCodeLine{1318 }
\DoxyCodeLine{1319                     \textcolor{keywordflow}{for}(c=0;c<modctx-\/>number\_of\_channels;c++)}
\DoxyCodeLine{1320                     \{}
\DoxyCodeLine{1321                         workeffect(nptr+c, cptr+c);}
\DoxyCodeLine{1322                     \}}
\DoxyCodeLine{1323 }
\DoxyCodeLine{1324                     modctx-\/>patterntickse = 0;}
\DoxyCodeLine{1325                 \}}
\DoxyCodeLine{1326 }
\DoxyCodeLine{1327                 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{1328 }
\DoxyCodeLine{1329                 \textcolor{keywordflow}{if}( trkbuf \&\& !state\_remaining\_steps )}
\DoxyCodeLine{1330                 \{}
\DoxyCodeLine{1331                     \textcolor{keywordflow}{if}( trkbuf-\/>nb\_of\_state < trkbuf-\/>nb\_max\_of\_state )}
\DoxyCodeLine{1332                     \{}
\DoxyCodeLine{1333                         memclear(\&trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state], 0, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structtracker__state__}{tracker\_state}}));}
\DoxyCodeLine{1334                     \}}
\DoxyCodeLine{1335                 \}}
\DoxyCodeLine{1336 }
\DoxyCodeLine{1337                 l=0;}
\DoxyCodeLine{1338                 r=0;}
\DoxyCodeLine{1339 }
\DoxyCodeLine{1340                 \textcolor{keywordflow}{for}(j =0, cptr = modctx-\/>channels; j < modctx-\/>number\_of\_channels ; j++, cptr++)}
\DoxyCodeLine{1341                 \{}
\DoxyCodeLine{1342                     \textcolor{keywordflow}{if}( cptr-\/>period != 0 )}
\DoxyCodeLine{1343                     \{}
\DoxyCodeLine{1344                         finalperiod = cptr-\/>period -\/ cptr-\/>decalperiod -\/ cptr-\/>vibraperiod;}
\DoxyCodeLine{1345                         \textcolor{keywordflow}{if}( finalperiod )}
\DoxyCodeLine{1346                         \{}
\DoxyCodeLine{1347                             cptr-\/>samppos += ( (modctx-\/>sampleticksconst<<10) / finalperiod );}
\DoxyCodeLine{1348                         \}}
\DoxyCodeLine{1349 }
\DoxyCodeLine{1350                         cptr-\/>ticks++;}
\DoxyCodeLine{1351 }
\DoxyCodeLine{1352                         \textcolor{keywordflow}{if}( cptr-\/>replen<=2 )}
\DoxyCodeLine{1353                         \{}
\DoxyCodeLine{1354                             \textcolor{keywordflow}{if}( (cptr-\/>samppos>>10) >= (cptr-\/>length) )}
\DoxyCodeLine{1355                             \{}
\DoxyCodeLine{1356                                 cptr-\/>length = 0;}
\DoxyCodeLine{1357                                 cptr-\/>reppnt = 0;}
\DoxyCodeLine{1358 }
\DoxyCodeLine{1359                                 \textcolor{keywordflow}{if}( cptr-\/>length )}
\DoxyCodeLine{1360                                     cptr-\/>samppos = cptr-\/>samppos \% (((\textcolor{keywordtype}{unsigned} long)cptr-\/>length)<<10);}
\DoxyCodeLine{1361                                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{1362                                     cptr-\/>samppos = 0;}
\DoxyCodeLine{1363                             \}}
\DoxyCodeLine{1364                         \}}
\DoxyCodeLine{1365                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{1366                         \{}
\DoxyCodeLine{1367                             \textcolor{keywordflow}{if}( (cptr-\/>samppos>>10) >= (\textcolor{keywordtype}{unsigned} long)(cptr-\/>replen+cptr-\/>reppnt) )}
\DoxyCodeLine{1368                             \{}
\DoxyCodeLine{1369                                 cptr-\/>samppos = ((\textcolor{keywordtype}{unsigned} long)(cptr-\/>reppnt)<<10) + (cptr-\/>samppos \% ((\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long})(cptr-\/>replen+cptr-\/>reppnt)<<10));}
\DoxyCodeLine{1370                             \}}
\DoxyCodeLine{1371                         \}}
\DoxyCodeLine{1372 }
\DoxyCodeLine{1373                         k = cptr-\/>samppos >> 10;}
\DoxyCodeLine{1374 }
\DoxyCodeLine{1375                         \textcolor{keywordflow}{if}( cptr-\/>sampdata!=0 \&\& ( ((j\&3)==1) || ((j\&3)==2) ) )}
\DoxyCodeLine{1376                         \{}
\DoxyCodeLine{1377                             r += ( cptr-\/>sampdata[k] *  cptr-\/>volume );}
\DoxyCodeLine{1378                         \}}
\DoxyCodeLine{1379 }
\DoxyCodeLine{1380                         \textcolor{keywordflow}{if}( cptr-\/>sampdata!=0 \&\& ( ((j\&3)==0) || ((j\&3)==3) ) )}
\DoxyCodeLine{1381                         \{}
\DoxyCodeLine{1382                             l += ( cptr-\/>sampdata[k] *  cptr-\/>volume );}
\DoxyCodeLine{1383                         \}}
\DoxyCodeLine{1384 }
\DoxyCodeLine{1385                         \textcolor{keywordflow}{if}( trkbuf \&\& !state\_remaining\_steps )}
\DoxyCodeLine{1386                         \{}
\DoxyCodeLine{1387                             \textcolor{keywordflow}{if}( trkbuf-\/>nb\_of\_state < trkbuf-\/>nb\_max\_of\_state )}
\DoxyCodeLine{1388                             \{}
\DoxyCodeLine{1389                                 trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state].number\_of\_tracks = modctx-\/>number\_of\_channels;}
\DoxyCodeLine{1390                                 trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state].buf\_index = i;}
\DoxyCodeLine{1391                                 trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state].cur\_pattern = modctx-\/>song.patterntable[modctx-\/>tablepos];}
\DoxyCodeLine{1392                                 trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state].cur\_pattern\_pos = modctx-\/>patternpos / modctx-\/>number\_of\_channels;}
\DoxyCodeLine{1393                                 trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state].cur\_pattern\_table\_pos = modctx-\/>tablepos;}
\DoxyCodeLine{1394                                 trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state].bpm = modctx-\/>bpm;}
\DoxyCodeLine{1395                                 trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state].speed = modctx-\/>song.speed;}
\DoxyCodeLine{1396                                 trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state].tracks[j].cur\_effect = cptr-\/>effect\_code;}
\DoxyCodeLine{1397                                 trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state].tracks[j].cur\_parameffect = cptr-\/>parameffect;}
\DoxyCodeLine{1398                                 trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state].tracks[j].cur\_period = finalperiod;}
\DoxyCodeLine{1399                                 trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state].tracks[j].cur\_volume = cptr-\/>volume;}
\DoxyCodeLine{1400                                 trkbuf-\/>track\_state\_buf[trkbuf-\/>nb\_of\_state].tracks[j].instrument\_number = (\textcolor{keywordtype}{unsigned} char)cptr-\/>sampnum;}
\DoxyCodeLine{1401                             \}}
\DoxyCodeLine{1402                         \}}
\DoxyCodeLine{1403                     \}}
\DoxyCodeLine{1404                 \}}
\DoxyCodeLine{1405 }
\DoxyCodeLine{1406                 \textcolor{keywordflow}{if}( trkbuf \&\& !state\_remaining\_steps )}
\DoxyCodeLine{1407                 \{}
\DoxyCodeLine{1408                     state\_remaining\_steps = trkbuf-\/>sample\_step;}
\DoxyCodeLine{1409 }
\DoxyCodeLine{1410                     \textcolor{keywordflow}{if}(trkbuf-\/>nb\_of\_state < trkbuf-\/>nb\_max\_of\_state)}
\DoxyCodeLine{1411                         trkbuf-\/>nb\_of\_state++;}
\DoxyCodeLine{1412                 \}}
\DoxyCodeLine{1413                 \textcolor{keywordflow}{else}}
\DoxyCodeLine{1414                 \{}
\DoxyCodeLine{1415                     state\_remaining\_steps-\/-\/;}
\DoxyCodeLine{1416                 \}}
\DoxyCodeLine{1417 }
\DoxyCodeLine{1418                 tl = (short)l;}
\DoxyCodeLine{1419                 tr = (short)r;}
\DoxyCodeLine{1420 }
\DoxyCodeLine{1421                 \textcolor{keywordflow}{if} ( modctx-\/>filter )}
\DoxyCodeLine{1422                 \{}
\DoxyCodeLine{1423                     \textcolor{comment}{// Filter}}
\DoxyCodeLine{1424                     l = (l+ll)>>1;}
\DoxyCodeLine{1425                     r = (r+lr)>>1;}
\DoxyCodeLine{1426                 \}}
\DoxyCodeLine{1427 }
\DoxyCodeLine{1428                 \textcolor{keywordflow}{if} ( modctx-\/>stereo\_separation == 1 )}
\DoxyCodeLine{1429                 \{}
\DoxyCodeLine{1430                     \textcolor{comment}{// Left \& Right Stereo panning}}
\DoxyCodeLine{1431                     l = (l+(r>>1));}
\DoxyCodeLine{1432                     r = (r+(l>>1));}
\DoxyCodeLine{1433                 \}}
\DoxyCodeLine{1434 }
\DoxyCodeLine{1435                 \textcolor{comment}{// Level limitation}}
\DoxyCodeLine{1436                 \textcolor{keywordflow}{if}( l > 32767 ) l = 32767;}
\DoxyCodeLine{1437                 \textcolor{keywordflow}{if}( l < -\/32768 ) l = -\/32768;}
\DoxyCodeLine{1438                 \textcolor{keywordflow}{if}( r > 32767 ) r = 32767;}
\DoxyCodeLine{1439                 \textcolor{keywordflow}{if}( r < -\/32768 ) r = -\/32768;}
\DoxyCodeLine{1440 }
\DoxyCodeLine{1441                 \textcolor{comment}{// Store the final sample.}}
\DoxyCodeLine{1442                 outbuffer[(i*2)]   = l;}
\DoxyCodeLine{1443                 outbuffer[(i*2)+1] = r;}
\DoxyCodeLine{1444 }
\DoxyCodeLine{1445                 ll = tl;}
\DoxyCodeLine{1446                 lr = tr;}
\DoxyCodeLine{1447 }
\DoxyCodeLine{1448             \}}
\DoxyCodeLine{1449 }
\DoxyCodeLine{1450             modctx-\/>last\_l\_sample = ll;}
\DoxyCodeLine{1451             modctx-\/>last\_r\_sample = lr;}
\DoxyCodeLine{1452 }
\DoxyCodeLine{1453             modctx-\/>samplenb = modctx-\/>samplenb+nbsample;}
\DoxyCodeLine{1454         \}}
\DoxyCodeLine{1455         \textcolor{keywordflow}{else}}
\DoxyCodeLine{1456         \{}
\DoxyCodeLine{1457             \textcolor{keywordflow}{for} (i = 0; i < nbsample; i++)}
\DoxyCodeLine{1458             \{}
\DoxyCodeLine{1459                 \textcolor{comment}{// Mod not loaded. Return blank buffer.}}
\DoxyCodeLine{1460                 outbuffer[(i*2)]   = 0;}
\DoxyCodeLine{1461                 outbuffer[(i*2)+1] = 0;}
\DoxyCodeLine{1462             \}}
\DoxyCodeLine{1463 }
\DoxyCodeLine{1464             \textcolor{keywordflow}{if}(trkbuf)}
\DoxyCodeLine{1465             \{}
\DoxyCodeLine{1466                 trkbuf-\/>nb\_of\_state = 0;}
\DoxyCodeLine{1467                 trkbuf-\/>cur\_rd\_index = 0;}
\DoxyCodeLine{1468                 trkbuf-\/>name[0] = 0;}
\DoxyCodeLine{1469                 memclear(trkbuf-\/>track\_state\_buf, 0, \textcolor{keyword}{sizeof}(\mbox{\hyperlink{structtracker__state__}{tracker\_state}}) * trkbuf-\/>nb\_max\_of\_state);}
\DoxyCodeLine{1470                 memclear(trkbuf-\/>instruments, 0, \textcolor{keyword}{sizeof}(trkbuf-\/>instruments));}
\DoxyCodeLine{1471             \}}
\DoxyCodeLine{1472         \}}
\DoxyCodeLine{1473     \}}
\DoxyCodeLine{1474 \}}
\DoxyCodeLine{1475 }
\DoxyCodeLine{1476 \textcolor{comment}{//resets internals for mod context}}
\DoxyCodeLine{1477 \textcolor{keyword}{static} \textcolor{keywordtype}{bool} jar\_mod\_reset( \mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx)}
\DoxyCodeLine{1478 \{}
\DoxyCodeLine{1479     \textcolor{keywordflow}{if}(modctx)}
\DoxyCodeLine{1480     \{}
\DoxyCodeLine{1481         memclear(\&modctx-\/>song, 0, \textcolor{keyword}{sizeof}(modctx-\/>song));}
\DoxyCodeLine{1482         memclear(\&modctx-\/>sampledata, 0, \textcolor{keyword}{sizeof}(modctx-\/>sampledata));}
\DoxyCodeLine{1483         memclear(\&modctx-\/>patterndata, 0, \textcolor{keyword}{sizeof}(modctx-\/>patterndata));}
\DoxyCodeLine{1484         modctx-\/>tablepos = 0;}
\DoxyCodeLine{1485         modctx-\/>patternpos = 0;}
\DoxyCodeLine{1486         modctx-\/>patterndelay  = 0;}
\DoxyCodeLine{1487         modctx-\/>jump\_loop\_effect = 0;}
\DoxyCodeLine{1488         modctx-\/>bpm = 0;}
\DoxyCodeLine{1489         modctx-\/>patternticks = 0;}
\DoxyCodeLine{1490         modctx-\/>patterntickse = 0;}
\DoxyCodeLine{1491         modctx-\/>patternticksaim = 0;}
\DoxyCodeLine{1492         modctx-\/>sampleticksconst = 0;}
\DoxyCodeLine{1493         modctx-\/>samplenb = 0;}
\DoxyCodeLine{1494         memclear(modctx-\/>channels, 0, \textcolor{keyword}{sizeof}(modctx-\/>channels));}
\DoxyCodeLine{1495         modctx-\/>number\_of\_channels = 0;}
\DoxyCodeLine{1496         modctx-\/>mod\_loaded = 0;}
\DoxyCodeLine{1497         modctx-\/>last\_r\_sample = 0;}
\DoxyCodeLine{1498         modctx-\/>last\_l\_sample = 0;}
\DoxyCodeLine{1499         }
\DoxyCodeLine{1500         \textcolor{keywordflow}{return} jar\_mod\_init(modctx);}
\DoxyCodeLine{1501     \}}
\DoxyCodeLine{1502     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1503 \}}
\DoxyCodeLine{1504 }
\DoxyCodeLine{1505 \textcolor{keywordtype}{void} jar\_mod\_unload( \mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx)}
\DoxyCodeLine{1506 \{}
\DoxyCodeLine{1507     \textcolor{keywordflow}{if}(modctx)}
\DoxyCodeLine{1508     \{}
\DoxyCodeLine{1509         \textcolor{keywordflow}{if}(modctx-\/>modfile)}
\DoxyCodeLine{1510         \{}
\DoxyCodeLine{1511             JARMOD\_FREE(modctx-\/>modfile);}
\DoxyCodeLine{1512             modctx-\/>modfile = 0;}
\DoxyCodeLine{1513             modctx-\/>modfilesize = 0;}
\DoxyCodeLine{1514             modctx-\/>loopcount = 0;}
\DoxyCodeLine{1515         \}}
\DoxyCodeLine{1516         jar\_mod\_reset(modctx);}
\DoxyCodeLine{1517     \}}
\DoxyCodeLine{1518 \}}
\DoxyCodeLine{1519 }
\DoxyCodeLine{1520 mulong jar\_mod\_load\_file(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx, \textcolor{keyword}{const} \textcolor{keywordtype}{char}* filename)}
\DoxyCodeLine{1521 \{}
\DoxyCodeLine{1522     mulong fsize = 0;}
\DoxyCodeLine{1523     \textcolor{keywordflow}{if}(modctx-\/>modfile)}
\DoxyCodeLine{1524     \{}
\DoxyCodeLine{1525         JARMOD\_FREE(modctx-\/>modfile);}
\DoxyCodeLine{1526         modctx-\/>modfile = 0;}
\DoxyCodeLine{1527     \}}
\DoxyCodeLine{1528     }
\DoxyCodeLine{1529     FILE *f = fopen(filename, \textcolor{stringliteral}{"{}rb"{}});}
\DoxyCodeLine{1530     \textcolor{keywordflow}{if}(f)}
\DoxyCodeLine{1531     \{}
\DoxyCodeLine{1532         fseek(f,0,SEEK\_END);}
\DoxyCodeLine{1533         fsize = ftell(f);}
\DoxyCodeLine{1534         fseek(f,0,SEEK\_SET);}
\DoxyCodeLine{1535         }
\DoxyCodeLine{1536         \textcolor{keywordflow}{if}(fsize \&\& fsize < 32*1024*1024)}
\DoxyCodeLine{1537         \{}
\DoxyCodeLine{1538             modctx-\/>modfile = JARMOD\_MALLOC(fsize);}
\DoxyCodeLine{1539             modctx-\/>modfilesize = fsize;}
\DoxyCodeLine{1540             memset(modctx-\/>modfile, 0, fsize);}
\DoxyCodeLine{1541             fread(modctx-\/>modfile, fsize, 1, f);}
\DoxyCodeLine{1542             fclose(f);}
\DoxyCodeLine{1543             }
\DoxyCodeLine{1544             \textcolor{keywordflow}{if}(!jar\_mod\_load(modctx, (\textcolor{keywordtype}{void}*)modctx-\/>modfile, fsize)) fsize = 0;}
\DoxyCodeLine{1545         \} \textcolor{keywordflow}{else} fsize = 0;}
\DoxyCodeLine{1546     \}}
\DoxyCodeLine{1547     \textcolor{keywordflow}{return} fsize;}
\DoxyCodeLine{1548 \}}
\DoxyCodeLine{1549 }
\DoxyCodeLine{1550 mulong jar\_mod\_current\_samples(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * modctx)}
\DoxyCodeLine{1551 \{}
\DoxyCodeLine{1552     \textcolor{keywordflow}{if}(modctx)}
\DoxyCodeLine{1553         \textcolor{keywordflow}{return} modctx-\/>samplenb;}
\DoxyCodeLine{1554     }
\DoxyCodeLine{1555     \textcolor{keywordflow}{return} 0;}
\DoxyCodeLine{1556 \}}
\DoxyCodeLine{1557 }
\DoxyCodeLine{1558 \textcolor{comment}{// Works, however it is very slow, this data should be cached to ensure it is run only once per file}}
\DoxyCodeLine{1559 mulong jar\_mod\_max\_samples(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * ctx)}
\DoxyCodeLine{1560 \{}
\DoxyCodeLine{1561     mint buff[2];}
\DoxyCodeLine{1562     mulong len;}
\DoxyCodeLine{1563     mulong lastcount = ctx-\/>loopcount;}
\DoxyCodeLine{1564     }
\DoxyCodeLine{1565     \textcolor{keywordflow}{while}(ctx-\/>loopcount <= lastcount)}
\DoxyCodeLine{1566         jar\_mod\_fillbuffer(ctx, buff, 1, 0);}
\DoxyCodeLine{1567     }
\DoxyCodeLine{1568     len = ctx-\/>samplenb;}
\DoxyCodeLine{1569     jar\_mod\_seek\_start(ctx);}
\DoxyCodeLine{1570     }
\DoxyCodeLine{1571     \textcolor{keywordflow}{return} len;}
\DoxyCodeLine{1572 \}}
\DoxyCodeLine{1573 }
\DoxyCodeLine{1574 \textcolor{comment}{// move seek\_val to sample index, 0 -\/> jar\_mod\_max\_samples is the range}}
\DoxyCodeLine{1575 \textcolor{keywordtype}{void} jar\_mod\_seek\_start(\mbox{\hyperlink{structjar__mod__context__t}{jar\_mod\_context\_t}} * ctx)}
\DoxyCodeLine{1576 \{}
\DoxyCodeLine{1577     \textcolor{keywordflow}{if}(ctx \&\& ctx-\/>modfile)}
\DoxyCodeLine{1578     \{}
\DoxyCodeLine{1579         muchar* ftmp = ctx-\/>modfile;}
\DoxyCodeLine{1580         mulong stmp = ctx-\/>modfilesize;}
\DoxyCodeLine{1581         muint lcnt = ctx-\/>loopcount;}
\DoxyCodeLine{1582         }
\DoxyCodeLine{1583         \textcolor{keywordflow}{if}(jar\_mod\_reset(ctx))\{}
\DoxyCodeLine{1584             jar\_mod\_load(ctx, ftmp, stmp);}
\DoxyCodeLine{1585             ctx-\/>modfile = ftmp;}
\DoxyCodeLine{1586             ctx-\/>modfilesize = stmp;}
\DoxyCodeLine{1587             ctx-\/>loopcount = lcnt;}
\DoxyCodeLine{1588         \}}
\DoxyCodeLine{1589     \}}
\DoxyCodeLine{1590 \}}
\DoxyCodeLine{1591 }
\DoxyCodeLine{1592 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// end of JAR\_MOD\_IMPLEMENTATION}}
\DoxyCodeLine{1593 \textcolor{comment}{//-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/-\/}}
\DoxyCodeLine{1594 }
\DoxyCodeLine{1595 }
\DoxyCodeLine{1596 \textcolor{preprocessor}{\#endif }\textcolor{comment}{//end of header file}}

\end{DoxyCode}
