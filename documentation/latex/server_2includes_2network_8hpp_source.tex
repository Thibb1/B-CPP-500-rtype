\hypertarget{server_2includes_2network_8hpp_source}{}\doxysection{network.\+hpp}
\label{server_2includes_2network_8hpp_source}\index{server/includes/network.hpp@{server/includes/network.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 }
\DoxyCodeLine{3 \textcolor{preprocessor}{\#include "{}bullet.hpp"{}}}
\DoxyCodeLine{4 \textcolor{preprocessor}{\#include "{}enemy.hpp"{}}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}player.hpp"{}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include "{}utils.hpp"{}}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <set>}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{keyword}{using namespace }asio::ip;}
\DoxyCodeLine{10 \textcolor{keyword}{using namespace }std::chrono;}
\DoxyCodeLine{11 }
\DoxyCodeLine{12 \textcolor{keyword}{namespace }std \{}
\DoxyCodeLine{13 \textcolor{keyword}{template} <>}
\DoxyCodeLine{14 \textcolor{keyword}{struct }hash<udp::endpoint> \{}
\DoxyCodeLine{15     std::size\_t operator()(\textcolor{keyword}{const} udp::endpoint \&endpoint) \textcolor{keyword}{const} \textcolor{keyword}{noexcept} \{}
\DoxyCodeLine{16         std::size\_t h1 = std::hash<std::string>()(endpoint.address().to\_string());}
\DoxyCodeLine{17         std::size\_t h2 = std::hash<unsigned short>()(endpoint.port());}
\DoxyCodeLine{18         \textcolor{keywordflow}{return} h1 \string^ (h2 << 1);}
\DoxyCodeLine{19     \}}
\DoxyCodeLine{20 \};}
\DoxyCodeLine{21 \} \textcolor{comment}{// namespace std}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{comment}{// udp server that can handle multiple clients}}
\DoxyCodeLine{24 \textcolor{keyword}{class }\mbox{\hyperlink{classUdpServer}{UdpServer}} \{}
\DoxyCodeLine{25   \textcolor{keyword}{private}:}
\DoxyCodeLine{26     asio::io\_context \_io\_context;}
\DoxyCodeLine{27     udp::socket \_socket;}
\DoxyCodeLine{28     std::unordered\_map<udp::endpoint, Player> \_clients;}
\DoxyCodeLine{29     std::set<int> \_ids;}
\DoxyCodeLine{30     udp::endpoint \_sender\_endpoint;}
\DoxyCodeLine{31     std::array<char, 1024> \_buffer\{\};}
\DoxyCodeLine{32     std::thread \_timer;}
\DoxyCodeLine{33     std::thread \_simulation;}
\DoxyCodeLine{34     \textcolor{comment}{// mutex for socket endpoint}}
\DoxyCodeLine{35     std::mutex \_socketMutex;}
\DoxyCodeLine{36     \textcolor{comment}{// bullets}}
\DoxyCodeLine{37     std::vector<Bullet> \_bullets;}
\DoxyCodeLine{38     \textcolor{comment}{// enemies}}
\DoxyCodeLine{39     std::vector<Enemy> \_enemies;}
\DoxyCodeLine{40     std::set<int> \_enemyIds;}
\DoxyCodeLine{41     \textcolor{comment}{// timer for enemy spawn}}
\DoxyCodeLine{42     std::chrono::time\_point<std::chrono::system\_clock> \_enemySpawnTimer;}
\DoxyCodeLine{43     \textcolor{comment}{// frame time}}
\DoxyCodeLine{44     std::chrono::time\_point<std::chrono::system\_clock> \_lastFrame;}
\DoxyCodeLine{45     \textcolor{comment}{// stop variable}}
\DoxyCodeLine{46     std::atomic<bool> \_stopServer;}
\DoxyCodeLine{47 }
\DoxyCodeLine{48   \textcolor{keyword}{public}:}
\DoxyCodeLine{49     \mbox{\hyperlink{classUdpServer}{UdpServer}}() : \_socket(\_io\_context, udp::endpoint(udp::v4(), 12345)), \_stopServer(\textcolor{keyword}{false}) \{}
\DoxyCodeLine{50         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i <= 4; i++)}
\DoxyCodeLine{51             \_ids.insert(i);}
\DoxyCodeLine{52         \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 1; i <= 10; i++)}
\DoxyCodeLine{53             \_enemyIds.insert(i);}
\DoxyCodeLine{54     \}}
\DoxyCodeLine{55 }
\DoxyCodeLine{56     \mbox{\hyperlink{classUdpServer_aef1871384fbc46ef425242be4474af3a}{\string~UdpServer}}();}
\DoxyCodeLine{57 }
\DoxyCodeLine{58     \textcolor{comment}{// start the server}}
\DoxyCodeLine{59     \textcolor{keywordtype}{void} \mbox{\hyperlink{classUdpServer_aa7b6f2b19d137506a14562d5c2c397c1}{start}}();}
\DoxyCodeLine{60 }
\DoxyCodeLine{61     \textcolor{comment}{// handle request from client}}
\DoxyCodeLine{62     \textcolor{keywordtype}{void} \mbox{\hyperlink{classUdpServer_a35f568c4a13872deb36c835a74f30379}{handleRequest}}(std::error\_code ec, std::size\_t bytes\_recvd);}
\DoxyCodeLine{63 }
\DoxyCodeLine{64     \textcolor{comment}{// send response to client}}
\DoxyCodeLine{65     \textcolor{keywordtype}{void} \mbox{\hyperlink{classUdpServer_a56444f6b9bc0339fd479ad5ca1742c3b}{sendResponse}}(\textcolor{keyword}{const} udp::endpoint \&endpoint, \textcolor{keyword}{const} std::string \&msg);}
\DoxyCodeLine{66 }
\DoxyCodeLine{67     \textcolor{comment}{// receive request from client}}
\DoxyCodeLine{68     \textcolor{keywordtype}{void} \mbox{\hyperlink{classUdpServer_a7db14c4e019caf26cd82ea03e3bc50a4}{receiveRequest}}();}
\DoxyCodeLine{69 }
\DoxyCodeLine{70     \textcolor{comment}{// check if client still alive}}
\DoxyCodeLine{71     \textcolor{keywordtype}{void} \mbox{\hyperlink{classUdpServer_aab2f1441f7e6b14aacebcd7c7695794f}{checkAlive}}();}
\DoxyCodeLine{72 }
\DoxyCodeLine{73     \textcolor{comment}{// send message to all clients}}
\DoxyCodeLine{74     \textcolor{keywordtype}{void} \mbox{\hyperlink{classUdpServer_a54a103d336e4c606f6e7a268ee155523}{sendAll}}(\textcolor{keyword}{const} std::string \&msg, \textcolor{keywordtype}{bool} includeSender = \textcolor{keyword}{true});}
\DoxyCodeLine{75 }
\DoxyCodeLine{76     \textcolor{comment}{// remove client from server}}
\DoxyCodeLine{77     \textcolor{keywordtype}{void} \mbox{\hyperlink{classUdpServer_a0b672214da5f2386483a646a8d989a0d}{removeClient}}(\textcolor{keyword}{const} udp::endpoint \&endpoint, \textcolor{keywordtype}{bool} erase = \textcolor{keyword}{true});}
\DoxyCodeLine{78 }
\DoxyCodeLine{79     \textcolor{comment}{// simulate game}}
\DoxyCodeLine{80     \textcolor{keywordtype}{void} \mbox{\hyperlink{classUdpServer_a75f8d1e912ea72571e07106912d67184}{simulate}}();}
\DoxyCodeLine{81 \};}

\end{DoxyCode}
